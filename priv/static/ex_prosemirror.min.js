var LiveView=(()=>{var gr=Object.create;var re=Object.defineProperty,yr=Object.defineProperties,wr=Object.getOwnPropertyDescriptor,Mr=Object.getOwnPropertyDescriptors,kr=Object.getOwnPropertyNames,mt=Object.getOwnPropertySymbols,br=Object.getPrototypeOf,vt=Object.prototype.hasOwnProperty,xr=Object.prototype.propertyIsEnumerable;var gt=(r,e,t)=>e in r?re(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,E=(r,e)=>{for(var t in e||(e={}))vt.call(e,t)&&gt(r,t,e[t]);if(mt)for(var t of mt(e))xr.call(e,t)&&gt(r,t,e[t]);return r},_=(r,e)=>yr(r,Mr(e)),yt=r=>re(r,"__esModule",{value:!0});var A=r=>{if(typeof require!="undefined")return require(r);throw new Error('Dynamic require of "'+r+'" is not supported')};var wt=(r,e)=>{yt(r);for(var t in e)re(r,t,{get:e[t],enumerable:!0})},Sr=(r,e,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of kr(e))!vt.call(r,n)&&n!=="default"&&re(r,n,{get:()=>e[n],enumerable:!(t=wr(e,n))||t.enumerable});return r},T=r=>Sr(yt(re(r!=null?gr(br(r)):{},"default",r&&r.__esModule&&"default"in r?{get:()=>r.default,enumerable:!0}:{value:r,enumerable:!0})),r);var An={};wt(An,{ExEditorView:()=>te,ExProsemirrorHooks:()=>pt,baseKeymap:()=>Qe,blocks:()=>ir,createSchema:()=>X,default:()=>Ae,generateSchemaMarks:()=>Ne,generateSchemablocks:()=>Oe,hardBreakKeymap:()=>hr,icons:()=>Se,insertPlaceholder:()=>me,keymap:()=>ct,marks:()=>nr,menu:()=>Ce,placeholderPlugin:()=>ne,replacePlaceholder:()=>Fe});var st=T(A("prosemirror-model")),sr=T(A("prosemirror-state")),lr=T(A("prosemirror-view"));var Mt=T(A("prosemirror-state")),de=T(A("prosemirror-view")),ne=new Mt.Plugin({state:{init(){return de.DecorationSet.empty},apply(r,e){e=e.map(r.mapping,r.doc);let t=r.getMeta(this);if(t&&t.add){let n=document.createElement("placeholder"),o=de.Decoration.widget(t.add.pos,n,{id:t.add.id});e=e.add(r.doc,[o])}else t&&t.remove&&(e=e.remove(e.find(null,null,n=>n.id==t.remove.id)));return e}},props:{decorations(r){return this.getState(r)}}});function me(r,{nodeType:e}){let t={},n=r.editorView.state.tr;n.selection.empty||n.deleteSelection(),r.editorNode.addEventListener("replacePlaceholder",function(i){Fe(r,i)}),n.setMeta(ne,{add:{id:t,pos:n.selection.from}}),r.editorView.dispatch(n);let o={detail:{nodeType:e,id:t,tr:n}};r.editorNode.dispatchEvent(new CustomEvent("insertPlaceholder",o))}function Fe(r,{detail:e}){let t=Cr(r.editorView.state,e.id);t!=null&&Ir({node:e.callback(r.editorView.state.schema.nodes),id:e.id,pos:t,exEditorView:r})}function Ir({exEditorView:r,id:e,pos:t,node:n}){r.editorView.dispatch(r.editorView.state.tr.replaceWith(t,t,n).setMeta(ne,{remove:{id:e}}))}function Cr(r,e){let n=ne.getState(r).find(null,null,o=>o.id==e);return n.length?n[0].from:null}var ar=T(A("prosemirror-model"));var Ee=T(A("prosemirror-schema-basic"));var Ce={};wt(Ce,{cmdItem:()=>nt,generateColorsMenu:()=>ot,generateFontFamilyMenu:()=>it,generateHTMLItem:()=>$t,generateHeadingItem:()=>Zt,generateMarkItem:()=>$,generateMediaMenu:()=>er,generateMultiMarkItem:()=>at,generateParagraphItem:()=>Yt,markActive:()=>rr,markItem:()=>tr,menuHelper:()=>ee,multiMarkItem:()=>Ie});function R(){var r=arguments[0];typeof r=="string"&&(r=document.createElement(r));var e=1,t=arguments[1];if(t&&typeof t=="object"&&t.nodeType==null&&!Array.isArray(t)){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var o=t[n];typeof o=="string"?r.setAttribute(n,o):o!=null&&(r[n]=o)}e++}for(;e<arguments.length;e++)kt(r,arguments[e]);return r}function kt(r,e){if(typeof e=="string")r.appendChild(document.createTextNode(e));else if(e!=null)if(e.nodeType!=null)r.appendChild(e);else if(Array.isArray(e))for(var t=0;t<e.length;t++)kt(r,e[t]);else throw new RangeError("Unsupported child node: "+e)}var d=T(A("prosemirror-model")),bt=65535,xt=Math.pow(2,16);function Er(r,e){return r+e*xt}function St(r){return r&bt}function Nr(r){return(r-(r&bt))/xt}var qe=function(e,t,n){t===void 0&&(t=!1),n===void 0&&(n=null),this.pos=e,this.deleted=t,this.recover=n},x=function r(e,t){if(t===void 0&&(t=!1),!e.length&&r.empty)return r.empty;this.ranges=e,this.inverted=t};x.prototype.recover=function(e){var t=0,n=St(e);if(!this.inverted)for(var o=0;o<n;o++)t+=this.ranges[o*3+2]-this.ranges[o*3+1];return this.ranges[n*3]+t+Nr(e)};x.prototype.mapResult=function(e,t){return t===void 0&&(t=1),this._map(e,t,!1)};x.prototype.map=function(e,t){return t===void 0&&(t=1),this._map(e,t,!0)};x.prototype._map=function(e,t,n){for(var o=0,i=this.inverted?2:1,a=this.inverted?1:2,s=0;s<this.ranges.length;s+=3){var l=this.ranges[s]-(this.inverted?o:0);if(l>e)break;var p=this.ranges[s+i],f=this.ranges[s+a],u=l+p;if(e<=u){var c=p?e==l?-1:e==u?1:t:t,h=l+o+(c<0?0:f);if(n)return h;var m=e==(t<0?l:u)?null:Er(s/3,e-l);return new qe(h,t<0?e!=l:e!=u,m)}o+=f-p}return n?e+o:new qe(e+o)};x.prototype.touches=function(e,t){for(var n=0,o=St(t),i=this.inverted?2:1,a=this.inverted?1:2,s=0;s<this.ranges.length;s+=3){var l=this.ranges[s]-(this.inverted?n:0);if(l>e)break;var p=this.ranges[s+i],f=l+p;if(e<=f&&s==o*3)return!0;n+=this.ranges[s+a]-p}return!1};x.prototype.forEach=function(e){for(var t=this.inverted?2:1,n=this.inverted?1:2,o=0,i=0;o<this.ranges.length;o+=3){var a=this.ranges[o],s=a-(this.inverted?i:0),l=a+(this.inverted?0:i),p=this.ranges[o+t],f=this.ranges[o+n];e(s,s+p,l,l+f),i+=f-p}};x.prototype.invert=function(){return new x(this.ranges,!this.inverted)};x.prototype.toString=function(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)};x.offset=function(e){return e==0?x.empty:new x(e<0?[0,-e,0]:[0,0,e])};x.empty=new x([]);var S=function(e,t,n,o){this.maps=e||[],this.from=n||0,this.to=o==null?this.maps.length:o,this.mirror=t};S.prototype.slice=function(e,t){return e===void 0&&(e=0),t===void 0&&(t=this.maps.length),new S(this.maps,this.mirror,e,t)};S.prototype.copy=function(){return new S(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)};S.prototype.appendMap=function(e,t){this.to=this.maps.push(e),t!=null&&this.setMirror(this.maps.length-1,t)};S.prototype.appendMapping=function(e){for(var t=0,n=this.maps.length;t<e.maps.length;t++){var o=e.getMirror(t);this.appendMap(e.maps[t],o!=null&&o<t?n+o:null)}};S.prototype.getMirror=function(e){if(this.mirror){for(var t=0;t<this.mirror.length;t++)if(this.mirror[t]==e)return this.mirror[t+(t%2?-1:1)]}};S.prototype.setMirror=function(e,t){this.mirror||(this.mirror=[]),this.mirror.push(e,t)};S.prototype.appendMappingInverted=function(e){for(var t=e.maps.length-1,n=this.maps.length+e.maps.length;t>=0;t--){var o=e.getMirror(t);this.appendMap(e.maps[t].invert(),o!=null&&o>t?n-o-1:null)}};S.prototype.invert=function(){var e=new S;return e.appendMappingInverted(this),e};S.prototype.map=function(e,t){if(t===void 0&&(t=1),this.mirror)return this._map(e,t,!0);for(var n=this.from;n<this.to;n++)e=this.maps[n].map(e,t);return e};S.prototype.mapResult=function(e,t){return t===void 0&&(t=1),this._map(e,t,!1)};S.prototype._map=function(e,t,n){for(var o=!1,i=this.from;i<this.to;i++){var a=this.maps[i],s=a.mapResult(e,t);if(s.recover!=null){var l=this.getMirror(i);if(l!=null&&l>i&&l<this.to){i=l,e=this.maps[l].recover(s.recover);continue}}s.deleted&&(o=!0),e=s.pos}return n?e:new qe(e,o)};function Z(r){var e=Error.call(this,r);return e.__proto__=Z.prototype,e}Z.prototype=Object.create(Error.prototype);Z.prototype.constructor=Z;Z.prototype.name="TransformError";var k=function(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new S},Be={before:{configurable:!0},docChanged:{configurable:!0}};Be.before.get=function(){return this.docs.length?this.docs[0]:this.doc};k.prototype.step=function(e){var t=this.maybeStep(e);if(t.failed)throw new Z(t.failed);return this};k.prototype.maybeStep=function(e){var t=e.apply(this.doc);return t.failed||this.addStep(e,t.doc),t};Be.docChanged.get=function(){return this.steps.length>0};k.prototype.addStep=function(e,t){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=t};Object.defineProperties(k.prototype,Be);function ve(){throw new Error("Override me")}var Pe=Object.create(null),N=function(){};N.prototype.apply=function(e){return ve()};N.prototype.getMap=function(){return x.empty};N.prototype.invert=function(e){return ve()};N.prototype.map=function(e){return ve()};N.prototype.merge=function(e){return null};N.prototype.toJSON=function(){return ve()};N.fromJSON=function(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");var n=Pe[t.stepType];if(!n)throw new RangeError("No step type "+t.stepType+" defined");return n.fromJSON(e,t)};N.jsonID=function(e,t){if(e in Pe)throw new RangeError("Duplicate use of step JSON ID "+e);return Pe[e]=t,t.prototype.jsonID=e,t};var z=function(e,t){this.doc=e,this.failed=t};z.ok=function(e){return new z(e,null)};z.fail=function(e){return new z(null,e)};z.fromReplace=function(e,t,n,o){try{return z.ok(e.replace(t,n,o))}catch(i){if(i instanceof d.ReplaceError)return z.fail(i.message);throw i}};var G=function(r){function e(t,n,o,i){r.call(this),this.from=t,this.to=n,this.slice=o,this.structure=!!i}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.apply=function(n){return this.structure&&_e(n,this.from,this.to)?z.fail("Structure replace would overwrite content"):z.fromReplace(n,this.from,this.to,this.slice)},e.prototype.getMap=function(){return new x([this.from,this.to-this.from,this.slice.size])},e.prototype.invert=function(n){return new e(this.from,this.from+this.slice.size,n.slice(this.from,this.to))},e.prototype.map=function(n){var o=n.mapResult(this.from,1),i=n.mapResult(this.to,-1);return o.deleted&&i.deleted?null:new e(o.pos,Math.max(o.pos,i.pos),this.slice)},e.prototype.merge=function(n){if(!(n instanceof e)||n.structure||this.structure)return null;if(this.from+this.slice.size==n.from&&!this.slice.openEnd&&!n.slice.openStart){var o=this.slice.size+n.slice.size==0?d.Slice.empty:new d.Slice(this.slice.content.append(n.slice.content),this.slice.openStart,n.slice.openEnd);return new e(this.from,this.to+(n.to-n.from),o,this.structure)}else if(n.to==this.from&&!this.slice.openStart&&!n.slice.openEnd){var i=this.slice.size+n.slice.size==0?d.Slice.empty:new d.Slice(n.slice.content.append(this.slice.content),n.slice.openStart,this.slice.openEnd);return new e(n.from,this.to,i,this.structure)}else return null},e.prototype.toJSON=function(){var n={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(n.slice=this.slice.toJSON()),this.structure&&(n.structure=!0),n},e.fromJSON=function(n,o){if(typeof o.from!="number"||typeof o.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new e(o.from,o.to,d.Slice.fromJSON(n,o.slice),!!o.structure)},e}(N);N.jsonID("replace",G);var W=function(r){function e(t,n,o,i,a,s,l){r.call(this),this.from=t,this.to=n,this.gapFrom=o,this.gapTo=i,this.slice=a,this.insert=s,this.structure=!!l}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.apply=function(n){if(this.structure&&(_e(n,this.from,this.gapFrom)||_e(n,this.gapTo,this.to)))return z.fail("Structure gap-replace would overwrite content");var o=n.slice(this.gapFrom,this.gapTo);if(o.openStart||o.openEnd)return z.fail("Gap is not a flat range");var i=this.slice.insertAt(this.insert,o.content);return i?z.fromReplace(n,this.from,this.to,i):z.fail("Content does not fit in gap")},e.prototype.getMap=function(){return new x([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])},e.prototype.invert=function(n){var o=this.gapTo-this.gapFrom;return new e(this.from,this.from+this.slice.size+o,this.from+this.insert,this.from+this.insert+o,n.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)},e.prototype.map=function(n){var o=n.mapResult(this.from,1),i=n.mapResult(this.to,-1),a=n.map(this.gapFrom,-1),s=n.map(this.gapTo,1);return o.deleted&&i.deleted||a<o.pos||s>i.pos?null:new e(o.pos,i.pos,a,s,this.slice,this.insert,this.structure)},e.prototype.toJSON=function(){var n={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(n.slice=this.slice.toJSON()),this.structure&&(n.structure=!0),n},e.fromJSON=function(n,o){if(typeof o.from!="number"||typeof o.to!="number"||typeof o.gapFrom!="number"||typeof o.gapTo!="number"||typeof o.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new e(o.from,o.to,o.gapFrom,o.gapTo,d.Slice.fromJSON(n,o.slice),o.insert,!!o.structure)},e}(N);N.jsonID("replaceAround",W);function _e(r,e,t){for(var n=r.resolve(e),o=t-e,i=n.depth;o>0&&i>0&&n.indexAfter(i)==n.node(i).childCount;)i--,o--;if(o>0)for(var a=n.node(i).maybeChild(n.indexAfter(i));o>0;){if(!a||a.isLeaf)return!0;a=a.firstChild,o--}return!1}function Or(r,e,t){return(e==0||r.canReplace(e,r.childCount))&&(t==r.childCount||r.canReplace(0,t))}function oe(r){for(var e=r.parent,t=e.content.cutByIndex(r.startIndex,r.endIndex),n=r.depth;;--n){var o=r.$from.node(n),i=r.$from.index(n),a=r.$to.indexAfter(n);if(n<r.depth&&o.canReplace(i,a,t))return n;if(n==0||o.type.spec.isolating||!Or(o,i,a))break}}k.prototype.lift=function(r,e){for(var t=r.$from,n=r.$to,o=r.depth,i=t.before(o+1),a=n.after(o+1),s=i,l=a,p=d.Fragment.empty,f=0,u=o,c=!1;u>e;u--)c||t.index(u)>0?(c=!0,p=d.Fragment.from(t.node(u).copy(p)),f++):s--;for(var h=d.Fragment.empty,m=0,v=o,g=!1;v>e;v--)g||n.after(v+1)<n.end(v)?(g=!0,h=d.Fragment.from(n.node(v).copy(h)),m++):l++;return this.step(new W(s,l,i,a,new d.Slice(p.append(h),f,m),p.size-f,!0))};k.prototype.wrap=function(r,e){for(var t=d.Fragment.empty,n=e.length-1;n>=0;n--){if(t.size){var o=e[n].type.contentMatch.matchFragment(t);if(!o||!o.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}t=d.Fragment.from(e[n].type.create(e[n].attrs,t))}var i=r.start,a=r.end;return this.step(new W(i,a,i,a,new d.Slice(t,0,0),e.length,!0))};k.prototype.setBlockType=function(r,e,t,n){var o=this;if(e===void 0&&(e=r),!t.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");var i=this.steps.length;return this.doc.nodesBetween(r,e,function(a,s){if(a.isTextblock&&!a.hasMarkup(t,n)&&Ar(o.doc,o.mapping.slice(i).map(s),t)){o.clearIncompatible(o.mapping.slice(i).map(s,1),t);var l=o.mapping.slice(i),p=l.map(s,1),f=l.map(s+a.nodeSize,1);return o.step(new W(p,f,p+1,f-1,new d.Slice(d.Fragment.from(t.create(n,null,a.marks)),0,0),1,!0)),!1}}),this};function Ar(r,e,t){var n=r.resolve(e),o=n.index();return n.parent.canReplaceWith(o,o+1,t)}k.prototype.setNodeMarkup=function(r,e,t,n){var o=this.doc.nodeAt(r);if(!o)throw new RangeError("No node at given position");e||(e=o.type);var i=e.create(t,null,n||o.marks);if(o.isLeaf)return this.replaceWith(r,r+o.nodeSize,i);if(!e.validContent(o.content))throw new RangeError("Invalid content for node type "+e.name);return this.step(new W(r,r+o.nodeSize,r+1,r+o.nodeSize-1,new d.Slice(d.Fragment.from(i),0,0),1,!0))};function ie(r,e,t,n){t===void 0&&(t=1);var o=r.resolve(e),i=o.depth-t,a=n&&n[n.length-1]||o.parent;if(i<0||o.parent.type.spec.isolating||!o.parent.canReplace(o.index(),o.parent.childCount)||!a.type.validContent(o.parent.content.cutByIndex(o.index(),o.parent.childCount)))return!1;for(var s=o.depth-1,l=t-2;s>i;s--,l--){var p=o.node(s),f=o.index(s);if(p.type.spec.isolating)return!1;var u=p.content.cutByIndex(f,p.childCount),c=n&&n[l]||p;if(c!=p&&(u=u.replaceChild(0,c.type.create(c.attrs))),!p.canReplace(f+1,p.childCount)||!c.type.validContent(u))return!1}var h=o.indexAfter(i),m=n&&n[0];return o.node(i).canReplaceWith(h,h,m?m.type:o.node(i+1).type)}k.prototype.split=function(r,e,t){e===void 0&&(e=1);for(var n=this.doc.resolve(r),o=d.Fragment.empty,i=d.Fragment.empty,a=n.depth,s=n.depth-e,l=e-1;a>s;a--,l--){o=d.Fragment.from(n.node(a).copy(o));var p=t&&t[l];i=d.Fragment.from(p?p.type.create(p.attrs,i):n.node(a).copy(i))}return this.step(new G(r,r,new d.Slice(o.append(i),e,e),!0))};function ge(r,e){var t=r.resolve(e),n=t.index();return It(t.nodeBefore,t.nodeAfter)&&t.parent.canReplace(n,n+1)}function It(r,e){return r&&e&&!r.isLeaf&&r.canAppend(e)}function Ct(r,e,t){t===void 0&&(t=-1);for(var n=r.resolve(e),o=n.depth;;o--){var i=void 0,a=void 0,s=n.index(o);if(o==n.depth?(i=n.nodeBefore,a=n.nodeAfter):t>0?(i=n.node(o+1),s++,a=n.node(o).maybeChild(s)):(i=n.node(o).maybeChild(s-1),a=n.node(o+1)),i&&!i.isTextblock&&It(i,a)&&n.node(o).canReplace(s,s+1))return e;if(o==0)break;e=t<0?n.before(o):n.after(o)}}k.prototype.join=function(r,e){e===void 0&&(e=1);var t=new G(r-e,r+e,d.Slice.empty,!0);return this.step(t)};function Tr(r,e,t){var n=r.resolve(e);if(n.parent.canReplaceWith(n.index(),n.index(),t))return e;if(n.parentOffset==0)for(var o=n.depth-1;o>=0;o--){var i=n.index(o);if(n.node(o).canReplaceWith(i,i,t))return n.before(o+1);if(i>0)return null}if(n.parentOffset==n.parent.content.size)for(var a=n.depth-1;a>=0;a--){var s=n.indexAfter(a);if(n.node(a).canReplaceWith(s,s,t))return n.after(a+1);if(s<n.node(a).childCount)return null}}function De(r,e,t){for(var n=[],o=0;o<r.childCount;o++){var i=r.child(o);i.content.size&&(i=i.copy(De(i.content,e,i))),i.isInline&&(i=e(i,t,o)),n.push(i)}return d.Fragment.fromArray(n)}var Le=function(r){function e(t,n,o){r.call(this),this.from=t,this.to=n,this.mark=o}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.apply=function(n){var o=this,i=n.slice(this.from,this.to),a=n.resolve(this.from),s=a.node(a.sharedDepth(this.to)),l=new d.Slice(De(i.content,function(p,f){return!p.isAtom||!f.type.allowsMarkType(o.mark.type)?p:p.mark(o.mark.addToSet(p.marks))},s),i.openStart,i.openEnd);return z.fromReplace(n,this.from,this.to,l)},e.prototype.invert=function(){return new ae(this.from,this.to,this.mark)},e.prototype.map=function(n){var o=n.mapResult(this.from,1),i=n.mapResult(this.to,-1);return o.deleted&&i.deleted||o.pos>=i.pos?null:new e(o.pos,i.pos,this.mark)},e.prototype.merge=function(n){if(n instanceof e&&n.mark.eq(this.mark)&&this.from<=n.to&&this.to>=n.from)return new e(Math.min(this.from,n.from),Math.max(this.to,n.to),this.mark)},e.prototype.toJSON=function(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},e.fromJSON=function(n,o){if(typeof o.from!="number"||typeof o.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new e(o.from,o.to,n.markFromJSON(o.mark))},e}(N);N.jsonID("addMark",Le);var ae=function(r){function e(t,n,o){r.call(this),this.from=t,this.to=n,this.mark=o}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.apply=function(n){var o=this,i=n.slice(this.from,this.to),a=new d.Slice(De(i.content,function(s){return s.mark(o.mark.removeFromSet(s.marks))}),i.openStart,i.openEnd);return z.fromReplace(n,this.from,this.to,a)},e.prototype.invert=function(){return new Le(this.from,this.to,this.mark)},e.prototype.map=function(n){var o=n.mapResult(this.from,1),i=n.mapResult(this.to,-1);return o.deleted&&i.deleted||o.pos>=i.pos?null:new e(o.pos,i.pos,this.mark)},e.prototype.merge=function(n){if(n instanceof e&&n.mark.eq(this.mark)&&this.from<=n.to&&this.to>=n.from)return new e(Math.min(this.from,n.from),Math.max(this.to,n.to),this.mark)},e.prototype.toJSON=function(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},e.fromJSON=function(n,o){if(typeof o.from!="number"||typeof o.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new e(o.from,o.to,n.markFromJSON(o.mark))},e}(N);N.jsonID("removeMark",ae);k.prototype.addMark=function(r,e,t){var n=this,o=[],i=[],a=null,s=null;return this.doc.nodesBetween(r,e,function(l,p,f){if(!!l.isInline){var u=l.marks;if(!t.isInSet(u)&&f.type.allowsMarkType(t.type)){for(var c=Math.max(p,r),h=Math.min(p+l.nodeSize,e),m=t.addToSet(u),v=0;v<u.length;v++)u[v].isInSet(m)||(a&&a.to==c&&a.mark.eq(u[v])?a.to=h:o.push(a=new ae(c,h,u[v])));s&&s.to==c?s.to=h:i.push(s=new Le(c,h,t))}}}),o.forEach(function(l){return n.step(l)}),i.forEach(function(l){return n.step(l)}),this};k.prototype.removeMark=function(r,e,t){var n=this;t===void 0&&(t=null);var o=[],i=0;return this.doc.nodesBetween(r,e,function(a,s){if(!!a.isInline){i++;var l=null;if(t instanceof d.MarkType)for(var p=a.marks,f;f=t.isInSet(p);)(l||(l=[])).push(f),p=f.removeFromSet(p);else t?t.isInSet(a.marks)&&(l=[t]):l=a.marks;if(l&&l.length)for(var u=Math.min(s+a.nodeSize,e),c=0;c<l.length;c++){for(var h=l[c],m=void 0,v=0;v<o.length;v++){var g=o[v];g.step==i-1&&h.eq(o[v].style)&&(m=g)}m?(m.to=u,m.step=i):o.push({style:h,from:Math.max(s,r),to:u,step:i})}}}),o.forEach(function(a){return n.step(new ae(a.from,a.to,a.style))}),this};k.prototype.clearIncompatible=function(r,e,t){t===void 0&&(t=e.contentMatch);for(var n=this.doc.nodeAt(r),o=[],i=r+1,a=0;a<n.childCount;a++){var s=n.child(a),l=i+s.nodeSize,p=t.matchType(s.type,s.attrs);if(!p)o.push(new G(i,l,d.Slice.empty));else{t=p;for(var f=0;f<s.marks.length;f++)e.allowsMarkType(s.marks[f].type)||this.step(new ae(i,l,s.marks[f]))}i=l}if(!t.validEnd){var u=t.fillBefore(d.Fragment.empty,!0);this.replace(i,i,new d.Slice(u,0,0))}for(var c=o.length-1;c>=0;c--)this.step(o[c]);return this};function ye(r,e,t,n){if(t===void 0&&(t=e),n===void 0&&(n=d.Slice.empty),e==t&&!n.size)return null;var o=r.resolve(e),i=r.resolve(t);return Et(o,i,n)?new G(e,t,n):new D(o,i,n).fit()}k.prototype.replace=function(r,e,t){e===void 0&&(e=r),t===void 0&&(t=d.Slice.empty);var n=ye(this.doc,r,e,t);return n&&this.step(n),this};k.prototype.replaceWith=function(r,e,t){return this.replace(r,e,new d.Slice(d.Fragment.from(t),0,0))};k.prototype.delete=function(r,e){return this.replace(r,e,d.Slice.empty)};k.prototype.insert=function(r,e){return this.replaceWith(r,r,e)};function Et(r,e,t){return!t.openStart&&!t.openEnd&&r.start()==e.start()&&r.parent.canReplace(r.index(),e.index(),t.content)}var D=function(e,t,n){this.$to=t,this.$from=e,this.unplaced=n,this.frontier=[];for(var o=0;o<=e.depth;o++){var i=e.node(o);this.frontier.push({type:i.type,match:i.contentMatchAt(e.indexAfter(o))})}this.placed=d.Fragment.empty;for(var a=e.depth;a>0;a--)this.placed=d.Fragment.from(e.node(a).copy(this.placed))},Nt={depth:{configurable:!0}};Nt.depth.get=function(){return this.frontier.length-1};D.prototype.fit=function(){for(;this.unplaced.size;){var e=this.findFittable();e?this.placeNodes(e):this.openMore()||this.dropNode()}var t=this.mustMoveInline(),n=this.placed.size-this.depth-this.$from.depth,o=this.$from,i=this.close(t<0?this.$to:o.doc.resolve(t));if(!i)return null;for(var a=this.placed,s=o.depth,l=i.depth;s&&l&&a.childCount==1;)a=a.firstChild.content,s--,l--;var p=new d.Slice(a,s,l);if(t>-1)return new W(o.pos,t,this.$to.pos,this.$to.end(),p,n);if(p.size||o.pos!=this.$to.pos)return new G(o.pos,i.pos,p)};D.prototype.findFittable=function(){for(var e=1;e<=2;e++)for(var t=this.unplaced.openStart;t>=0;t--){var n=void 0,o=void 0;t?(o=He(this.unplaced.content,t-1).firstChild,n=o.content):n=this.unplaced.content;for(var i=n.firstChild,a=this.depth;a>=0;a--){var s=this.frontier[a],l=s.type,p=s.match,f=void 0,u=void 0;if(e==1&&(i?p.matchType(i.type)||(u=p.fillBefore(d.Fragment.from(i),!1)):l.compatibleContent(o.type)))return{sliceDepth:t,frontierDepth:a,parent:o,inject:u};if(e==2&&i&&(f=p.findWrapping(i.type)))return{sliceDepth:t,frontierDepth:a,parent:o,wrap:f};if(o&&p.matchType(o.type))break}}};D.prototype.openMore=function(){var e=this.unplaced,t=e.content,n=e.openStart,o=e.openEnd,i=He(t,n);return!i.childCount||i.firstChild.isLeaf?!1:(this.unplaced=new d.Slice(t,n+1,Math.max(o,i.size+n>=t.size-o?n+1:0)),!0)};D.prototype.dropNode=function(){var e=this.unplaced,t=e.content,n=e.openStart,o=e.openEnd,i=He(t,n);if(i.childCount<=1&&n>0){var a=t.size-n<=n+i.size;this.unplaced=new d.Slice(se(t,n-1,1),n-1,a?n-1:o)}else this.unplaced=new d.Slice(se(t,n,1),n,o)};D.prototype.placeNodes=function(e){for(var t=e.sliceDepth,n=e.frontierDepth,o=e.parent,i=e.inject,a=e.wrap;this.depth>n;)this.closeFrontierNode();if(a)for(var s=0;s<a.length;s++)this.openFrontierNode(a[s]);var l=this.unplaced,p=o?o.content:l.content,f=l.openStart-t,u=0,c=[],h=this.frontier[n],m=h.match,v=h.type;if(i){for(var g=0;g<i.childCount;g++)c.push(i.child(g));m=m.matchFragment(i)}for(var y=p.size+t-(l.content.size-l.openEnd);u<p.childCount;){var M=p.child(u),b=m.matchType(M.type);if(!b)break;u++,(u>1||f==0||M.content.size)&&(m=b,c.push(Ot(M.mark(v.allowedMarks(M.marks)),u==1?f:0,u==p.childCount?y:-1)))}var O=u==p.childCount;O||(y=-1),this.placed=le(this.placed,n,d.Fragment.from(c)),this.frontier[n].match=m,O&&y<0&&o&&o.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(var F=0,L=p;F<y;F++){var q=L.lastChild;this.frontier.push({type:q.type,match:q.contentMatchAt(q.childCount)}),L=q.content}this.unplaced=O?t==0?d.Slice.empty:new d.Slice(se(l.content,t-1,1),t-1,y<0?l.openEnd:t-1):new d.Slice(se(l.content,t,u),l.openStart,l.openEnd)};D.prototype.mustMoveInline=function(){if(!this.$to.parent.isTextblock)return-1;var e=this.frontier[this.depth],t;if(!e.type.isTextblock||!Ve(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;for(var n=this.$to,o=n.depth,i=this.$to.after(o);o>1&&i==this.$to.end(--o);)++i;return i};D.prototype.findCloseLevel=function(e){e:for(var t=Math.min(this.depth,e.depth);t>=0;t--){var n=this.frontier[t],o=n.match,i=n.type,a=t<e.depth&&e.end(t+1)==e.pos+(e.depth-(t+1)),s=Ve(e,t,i,o,a);if(!!s){for(var l=t-1;l>=0;l--){var p=this.frontier[l],f=p.match,u=p.type,c=Ve(e,l,u,f,!0);if(!c||c.childCount)continue e}return{depth:t,fit:s,move:a?e.doc.resolve(e.after(t+1)):e}}}};D.prototype.close=function(e){var t=this.findCloseLevel(e);if(!t)return null;for(;this.depth>t.depth;)this.closeFrontierNode();t.fit.childCount&&(this.placed=le(this.placed,t.depth,t.fit)),e=t.move;for(var n=t.depth+1;n<=e.depth;n++){var o=e.node(n),i=o.type.contentMatch.fillBefore(o.content,!0,e.index(n));this.openFrontierNode(o.type,o.attrs,i)}return e};D.prototype.openFrontierNode=function(e,t,n){var o=this.frontier[this.depth];o.match=o.match.matchType(e),this.placed=le(this.placed,this.depth,d.Fragment.from(e.create(t,n))),this.frontier.push({type:e,match:e.contentMatch})};D.prototype.closeFrontierNode=function(){var e=this.frontier.pop(),t=e.match.fillBefore(d.Fragment.empty,!0);t.childCount&&(this.placed=le(this.placed,this.frontier.length,t))};Object.defineProperties(D.prototype,Nt);function se(r,e,t){return e==0?r.cutByIndex(t):r.replaceChild(0,r.firstChild.copy(se(r.firstChild.content,e-1,t)))}function le(r,e,t){return e==0?r.append(t):r.replaceChild(r.childCount-1,r.lastChild.copy(le(r.lastChild.content,e-1,t)))}function He(r,e){for(var t=0;t<e;t++)r=r.firstChild.content;return r}function Ot(r,e,t){if(e<=0)return r;var n=r.content;return e>1&&(n=n.replaceChild(0,Ot(n.firstChild,e-1,n.childCount==1?t-1:0))),e>0&&(n=r.type.contentMatch.fillBefore(n).append(n),t<=0&&(n=n.append(r.type.contentMatch.matchFragment(n).fillBefore(d.Fragment.empty,!0)))),r.copy(n)}function Ve(r,e,t,n,o){var i=r.node(e),a=o?r.indexAfter(e):r.index(e);if(a==i.childCount&&!t.compatibleContent(i.type))return null;var s=n.fillBefore(i.content,!0,a);return s&&!Rr(t,i.content,a)?s:null}function Rr(r,e,t){for(var n=t;n<e.childCount;n++)if(!r.allowsMarks(e.child(n).marks))return!0;return!1}function zr(r){return r.spec.defining||r.spec.definingForContent}k.prototype.replaceRange=function(r,e,t){if(!t.size)return this.deleteRange(r,e);var n=this.doc.resolve(r),o=this.doc.resolve(e);if(Et(n,o,t))return this.step(new G(r,e,t));var i=Tt(n,this.doc.resolve(e));i[i.length-1]==0&&i.pop();var a=-(n.depth+1);i.unshift(a);for(var s=n.depth,l=n.pos-1;s>0;s--,l--){var p=n.node(s).type.spec;if(p.defining||p.definingAsContext||p.isolating)break;i.indexOf(s)>-1?a=s:n.before(s)==l&&i.splice(1,0,-s)}for(var f=i.indexOf(a),u=[],c=t.openStart,h=t.content,m=0;;m++){var v=h.firstChild;if(u.push(v),m==t.openStart)break;h=v.content}for(var g=c-1;g>=0;g--){var y=u[g].type,M=zr(y);if(M&&n.node(f).type!=y)c=g;else if(M||!y.isTextblock)break}for(var b=t.openStart;b>=0;b--){var O=(b+c+1)%(t.openStart+1),F=u[O];if(!!F)for(var L=0;L<i.length;L++){var q=i[(L+f)%i.length],ht=!0;q<0&&(ht=!1,q=-q);var mr=n.node(q-1),dt=n.index(q-1);if(mr.canReplaceWith(dt,dt,F.type,F.marks))return this.replace(n.before(q),ht?o.after(q):e,new d.Slice(At(t.content,0,t.openStart,O),O,t.openEnd))}}for(var vr=this.steps.length,Re=i.length-1;Re>=0&&(this.replace(r,e,t),!(this.steps.length>vr));Re--){var ze=i[Re];ze<0||(r=n.before(ze),e=o.after(ze))}return this};function At(r,e,t,n,o){if(e<t){var i=r.firstChild;r=r.replaceChild(0,i.copy(At(i.content,e+1,t,n,i)))}if(e>n){var a=o.contentMatchAt(0),s=a.fillBefore(r).append(r);r=s.append(a.matchFragment(s).fillBefore(d.Fragment.empty,!0))}return r}k.prototype.replaceRangeWith=function(r,e,t){if(!t.isInline&&r==e&&this.doc.resolve(r).parent.content.size){var n=Tr(this.doc,r,t.type);n!=null&&(r=e=n)}return this.replaceRange(r,e,new d.Slice(d.Fragment.from(t),0,0))};k.prototype.deleteRange=function(r,e){for(var t=this.doc.resolve(r),n=this.doc.resolve(e),o=Tt(t,n),i=0;i<o.length;i++){var a=o[i],s=i==o.length-1;if(s&&a==0||t.node(a).type.contentMatch.validEnd)return this.delete(t.start(a),n.end(a));if(a>0&&(s||t.node(a-1).canReplace(t.index(a-1),n.indexAfter(a-1))))return this.delete(t.before(a),n.after(a))}for(var l=1;l<=t.depth&&l<=n.depth;l++)if(r-t.start(l)==t.depth-l&&e>t.end(l)&&n.end(l)-e!=n.depth-l)return this.delete(t.before(l),e);return this.delete(r,e)};function Tt(r,e){for(var t=[],n=Math.min(r.depth,e.depth),o=n;o>=0;o--){var i=r.start(o);if(i<r.pos-(r.depth-o)||e.end(o)>e.pos+(e.depth-o)||r.node(o).type.spec.isolating||e.node(o).type.spec.isolating)break;(i==e.start(o)||o==r.depth&&o==e.depth&&r.parent.inlineContent&&e.parent.inlineContent&&o&&e.start(o-1)==i-1)&&t.push(o)}return t}var H=T(A("prosemirror-model")),w=T(A("prosemirror-state"));function Rt(r,e){return r.selection.empty?!1:(e&&e(r.tr.deleteSelection().scrollIntoView()),!0)}function Fr(r,e,t){var n=r.selection,o=n.$cursor;if(!o||(t?!t.endOfTextblock("backward",r):o.parentOffset>0))return!1;var i=zt(o);if(!i){var a=o.blockRange(),s=a&&oe(a);return s==null?!1:(e&&e(r.tr.lift(a,s).scrollIntoView()),!0)}var l=i.nodeBefore;if(!l.type.spec.isolating&&qt(r,i,e))return!0;if(o.parent.content.size==0&&(Y(l,"end")||w.NodeSelection.isSelectable(l))){var p=ye(r.doc,o.before(),o.after(),H.Slice.empty);if(p.slice.size<p.to-p.from){if(e){var f=r.tr.step(p);f.setSelection(Y(l,"end")?w.Selection.findFrom(f.doc.resolve(f.mapping.map(i.pos,-1)),-1):w.NodeSelection.create(f.doc,i.pos-l.nodeSize)),e(f.scrollIntoView())}return!0}}return l.isAtom&&i.depth==o.depth-1?(e&&e(r.tr.delete(i.pos-l.nodeSize,i.pos).scrollIntoView()),!0):!1}function Y(r,e,t){for(;r;r=e=="start"?r.firstChild:r.lastChild){if(r.isTextblock)return!0;if(t&&r.childCount!=1)return!1}return!1}function qr(r,e,t){var n=r.selection,o=n.$head,i=n.empty,a=o;if(!i)return!1;if(o.parent.isTextblock){if(t?!t.endOfTextblock("backward",r):o.parentOffset>0)return!1;a=zt(o)}var s=a&&a.nodeBefore;return!s||!w.NodeSelection.isSelectable(s)?!1:(e&&e(r.tr.setSelection(w.NodeSelection.create(r.doc,a.pos-s.nodeSize)).scrollIntoView()),!0)}function zt(r){if(!r.parent.type.spec.isolating)for(var e=r.depth-1;e>=0;e--){if(r.index(e)>0)return r.doc.resolve(r.before(e+1));if(r.node(e).type.spec.isolating)break}return null}function Br(r,e,t){var n=r.selection,o=n.$cursor;if(!o||(t?!t.endOfTextblock("forward",r):o.parentOffset<o.parent.content.size))return!1;var i=Ft(o);if(!i)return!1;var a=i.nodeAfter;if(qt(r,i,e))return!0;if(o.parent.content.size==0&&(Y(a,"start")||w.NodeSelection.isSelectable(a))){var s=ye(r.doc,o.before(),o.after(),H.Slice.empty);if(s.slice.size<s.to-s.from){if(e){var l=r.tr.step(s);l.setSelection(Y(a,"start")?w.Selection.findFrom(l.doc.resolve(l.mapping.map(i.pos)),1):w.NodeSelection.create(l.doc,l.mapping.map(i.pos))),e(l.scrollIntoView())}return!0}}return a.isAtom&&i.depth==o.depth-1?(e&&e(r.tr.delete(i.pos,i.pos+a.nodeSize).scrollIntoView()),!0):!1}function Pr(r,e,t){var n=r.selection,o=n.$head,i=n.empty,a=o;if(!i)return!1;if(o.parent.isTextblock){if(t?!t.endOfTextblock("forward",r):o.parentOffset<o.parent.content.size)return!1;a=Ft(o)}var s=a&&a.nodeAfter;return!s||!w.NodeSelection.isSelectable(s)?!1:(e&&e(r.tr.setSelection(w.NodeSelection.create(r.doc,a.pos)).scrollIntoView()),!0)}function Ft(r){if(!r.parent.type.spec.isolating)for(var e=r.depth-1;e>=0;e--){var t=r.node(e);if(r.index(e)+1<t.childCount)return r.doc.resolve(r.after(e+1));if(t.type.spec.isolating)break}return null}function Je(r,e){var t=r.selection,n=t instanceof w.NodeSelection,o;if(n){if(t.node.isTextblock||!ge(r.doc,t.from))return!1;o=t.from}else if(o=Ct(r.doc,t.from,-1),o==null)return!1;if(e){var i=r.tr.join(o);n&&i.setSelection(w.NodeSelection.create(i.doc,o-r.doc.resolve(o).nodeBefore.nodeSize)),e(i.scrollIntoView())}return!0}function We(r,e){var t=r.selection,n=t.$from,o=t.$to,i=n.blockRange(o),a=i&&oe(i);return a==null?!1:(e&&e(r.tr.lift(i,a).scrollIntoView()),!0)}function _r(r,e){var t=r.selection,n=t.$head,o=t.$anchor;return!n.parent.type.spec.code||!n.sameParent(o)?!1:(e&&e(r.tr.insertText(`
`).scrollIntoView()),!0)}function Ke(r){for(var e=0;e<r.edgeCount;e++){var t=r.edge(e),n=t.type;if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}function Ue(r,e){var t=r.selection,n=t.$head,o=t.$anchor;if(!n.parent.type.spec.code||!n.sameParent(o))return!1;var i=n.node(-1),a=n.indexAfter(-1),s=Ke(i.contentMatchAt(a));if(!i.canReplaceWith(a,a,s))return!1;if(e){var l=n.after(),p=r.tr.replaceWith(l,l,s.createAndFill());p.setSelection(w.Selection.near(p.doc.resolve(l),1)),e(p.scrollIntoView())}return!0}function Dr(r,e){var t=r.selection,n=t.$from,o=t.$to;if(t instanceof w.AllSelection||n.parent.inlineContent||o.parent.inlineContent)return!1;var i=Ke(o.parent.contentMatchAt(o.indexAfter()));if(!i||!i.isTextblock)return!1;if(e){var a=(!n.parentOffset&&o.index()<o.parent.childCount?n:o).pos,s=r.tr.insert(a,i.createAndFill());s.setSelection(w.TextSelection.create(s.doc,a+1)),e(s.scrollIntoView())}return!0}function Lr(r,e){var t=r.selection,n=t.$cursor;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){var o=n.before();if(ie(r.doc,o))return e&&e(r.tr.split(o).scrollIntoView()),!0}var i=n.blockRange(),a=i&&oe(i);return a==null?!1:(e&&e(r.tr.lift(i,a).scrollIntoView()),!0)}function Hr(r,e){var t=r.selection,n=t.$from,o=t.$to;if(r.selection instanceof w.NodeSelection&&r.selection.node.isBlock)return!n.parentOffset||!ie(r.doc,n.pos)?!1:(e&&e(r.tr.split(n.pos).scrollIntoView()),!0);if(!n.parent.isBlock)return!1;if(e){var i=o.parentOffset==o.parent.content.size,a=r.tr;(r.selection instanceof w.TextSelection||r.selection instanceof w.AllSelection)&&a.deleteSelection();var s=n.depth==0?null:Ke(n.node(-1).contentMatchAt(n.indexAfter(-1))),l=i&&s?[{type:s}]:null,p=ie(a.doc,a.mapping.map(n.pos),1,l);if(!l&&!p&&ie(a.doc,a.mapping.map(n.pos),1,s&&[{type:s}])&&(l=[{type:s}],p=!0),p&&(a.split(a.mapping.map(n.pos),1,l),!i&&!n.parentOffset&&n.parent.type!=s)){var f=a.mapping.map(n.before()),u=a.doc.resolve(f);n.node(-1).canReplaceWith(u.index(),u.index()+1,s)&&a.setNodeMarkup(a.mapping.map(n.before()),s)}e(a.scrollIntoView())}return!0}function Ge(r,e){var t=r.selection,n=t.$from,o=t.to,i,a=n.sharedDepth(o);return a==0?!1:(i=n.before(a),e&&e(r.tr.setSelection(w.NodeSelection.create(r.doc,i))),!0)}function Vr(r,e){return e&&e(r.tr.setSelection(new w.AllSelection(r.doc))),!0}function Jr(r,e,t){var n=e.nodeBefore,o=e.nodeAfter,i=e.index();return!n||!o||!n.type.compatibleContent(o.type)?!1:!n.content.size&&e.parent.canReplace(i-1,i)?(t&&t(r.tr.delete(e.pos-n.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(i,i+1)||!(o.isTextblock||ge(r.doc,e.pos))?!1:(t&&t(r.tr.clearIncompatible(e.pos,n.type,n.contentMatchAt(n.childCount)).join(e.pos).scrollIntoView()),!0)}function qt(r,e,t){var n=e.nodeBefore,o=e.nodeAfter,i,a;if(n.type.spec.isolating||o.type.spec.isolating)return!1;if(Jr(r,e,t))return!0;var s=e.parent.canReplace(e.index(),e.index()+1);if(s&&(i=(a=n.contentMatchAt(n.childCount)).findWrapping(o.type))&&a.matchType(i[0]||o.type).validEnd){if(t){for(var l=e.pos+o.nodeSize,p=H.Fragment.empty,f=i.length-1;f>=0;f--)p=H.Fragment.from(i[f].create(null,p));p=H.Fragment.from(n.copy(p));var u=r.tr.step(new W(e.pos-1,l,e.pos,l,new H.Slice(p,1,0),i.length,!0)),c=l+2*i.length;ge(u.doc,c)&&u.join(c),t(u.scrollIntoView())}return!0}var h=w.Selection.findFrom(e,1),m=h&&h.$from.blockRange(h.$to),v=m&&oe(m);if(v!=null&&v>=e.depth)return t&&t(r.tr.lift(m,v).scrollIntoView()),!0;if(s&&Y(o,"start",!0)&&Y(n,"end")){for(var g=n,y=[];y.push(g),!g.isTextblock;)g=g.lastChild;for(var M=o,b=1;!M.isTextblock;M=M.firstChild)b++;if(g.canReplace(g.childCount,g.childCount,M.content)){if(t){for(var O=H.Fragment.empty,F=y.length-1;F>=0;F--)O=H.Fragment.from(y[F].copy(O));var L=r.tr.step(new W(e.pos-y.length,e.pos+o.nodeSize,e.pos+b,e.pos+o.nodeSize-b,new H.Slice(O,y.length,0),0,!0));t(L.scrollIntoView())}return!0}}return!1}function Bt(r){return function(e,t){for(var n=e.selection,o=r<0?n.$from:n.$to,i=o.depth;o.node(i).isInline;){if(!i)return!1;i--}return o.node(i).isTextblock?(t&&t(e.tr.setSelection(w.TextSelection.create(e.doc,r<0?o.start(i):o.end(i)))),!0):!1}}var Wr=Bt(-1),Kr=Bt(1);function Pt(r,e){return function(t,n){var o=t.selection,i=o.from,a=o.to,s=!1;return t.doc.nodesBetween(i,a,function(l,p){if(s)return!1;if(!(!l.isTextblock||l.hasMarkup(r,e)))if(l.type==r)s=!0;else{var f=t.doc.resolve(p),u=f.index();s=f.parent.canReplaceWith(u,u+1,r)}}),s?(n&&n(t.tr.setBlockType(i,a,r,e).scrollIntoView()),!0):!1}}function Ur(r,e,t){for(var n=function(a){var s=e[a],l=s.$from,p=s.$to,f=l.depth==0?r.type.allowsMarkType(t):!1;if(r.nodesBetween(l.pos,p.pos,function(u){if(f)return!1;f=u.inlineContent&&u.type.allowsMarkType(t)}),f)return{v:!0}},o=0;o<e.length;o++){var i=n(o);if(i)return i.v}return!1}function _t(r,e){return function(t,n){var o=t.selection,i=o.empty,a=o.$cursor,s=o.ranges;if(i&&!a||!Ur(t.doc,s,r))return!1;if(n)if(a)r.isInSet(t.storedMarks||a.marks())?n(t.tr.removeStoredMark(r)):n(t.tr.addStoredMark(r.create(e)));else{for(var l=!1,p=t.tr,f=0;!l&&f<s.length;f++){var u=s[f],c=u.$from,h=u.$to;l=t.doc.rangeHasMark(c.pos,h.pos,r)}for(var m=0;m<s.length;m++){var v=s[m],g=v.$from,y=v.$to;if(l)p.removeMark(g.pos,y.pos,r);else{var M=g.pos,b=y.pos,O=g.nodeAfter,F=y.nodeBefore,L=O&&O.isText?/^\s*/.exec(O.text)[0].length:0,q=F&&F.isText?/\s*$/.exec(F.text)[0].length:0;M+L<b&&(M+=L,b-=q),p.addMark(M,b,r.create(e))}}n(p.scrollIntoView())}return!0}}function pe(){for(var r=[],e=arguments.length;e--;)r[e]=arguments[e];return function(t,n,o){for(var i=0;i<r.length;i++)if(r[i](t,n,o))return!0;return!1}}var je=pe(Rt,Fr,qr),Dt=pe(Rt,Br,Pr),K={Enter:pe(_r,Dr,Lr,Hr),"Mod-Enter":Ue,Backspace:je,"Mod-Backspace":je,"Shift-Backspace":je,Delete:Dt,"Mod-Delete":Dt,"Mod-a":Vr},Lt={"Ctrl-h":K.Backspace,"Alt-Backspace":K["Mod-Backspace"],"Ctrl-d":K.Delete,"Ctrl-Alt-Backspace":K["Mod-Delete"],"Alt-Delete":K["Mod-Delete"],"Alt-d":K["Mod-Delete"],"Ctrl-a":Wr,"Ctrl-e":Kr};for(var Ht in K)Lt[Ht]=K[Ht];var Gr=typeof navigator!="undefined"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os!="undefined"?os.platform()=="darwin":!1,Qe=Gr?Lt:K;var we=200,I=function(){};I.prototype.append=function(e){return e.length?(e=I.from(e),!this.length&&e||e.length<we&&this.leafAppend(e)||this.length<we&&e.leafPrepend(this)||this.appendInner(e)):this};I.prototype.prepend=function(e){return e.length?I.from(e).append(this):this};I.prototype.appendInner=function(e){return new jr(this,e)};I.prototype.slice=function(e,t){return e===void 0&&(e=0),t===void 0&&(t=this.length),e>=t?I.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,t))};I.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};I.prototype.forEach=function(e,t,n){t===void 0&&(t=0),n===void 0&&(n=this.length),t<=n?this.forEachInner(e,t,n,0):this.forEachInvertedInner(e,t,n,0)};I.prototype.map=function(e,t,n){t===void 0&&(t=0),n===void 0&&(n=this.length);var o=[];return this.forEach(function(i,a){return o.push(e(i,a))},t,n),o};I.from=function(e){return e instanceof I?e:e&&e.length?new Vt(e):I.empty};var Vt=function(r){function e(n){r.call(this),this.values=n}r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e;var t={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(o,i){return o==0&&i==this.length?this:new e(this.values.slice(o,i))},e.prototype.getInner=function(o){return this.values[o]},e.prototype.forEachInner=function(o,i,a,s){for(var l=i;l<a;l++)if(o(this.values[l],s+l)===!1)return!1},e.prototype.forEachInvertedInner=function(o,i,a,s){for(var l=i-1;l>=a;l--)if(o(this.values[l],s+l)===!1)return!1},e.prototype.leafAppend=function(o){if(this.length+o.length<=we)return new e(this.values.concat(o.flatten()))},e.prototype.leafPrepend=function(o){if(this.length+o.length<=we)return new e(o.flatten().concat(this.values))},t.length.get=function(){return this.values.length},t.depth.get=function(){return 0},Object.defineProperties(e.prototype,t),e}(I);I.empty=new Vt([]);var jr=function(r){function e(t,n){r.call(this),this.left=t,this.right=n,this.length=t.length+n.length,this.depth=Math.max(t.depth,n.depth)+1}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(n){return n<this.left.length?this.left.get(n):this.right.get(n-this.left.length)},e.prototype.forEachInner=function(n,o,i,a){var s=this.left.length;if(o<s&&this.left.forEachInner(n,o,Math.min(i,s),a)===!1||i>s&&this.right.forEachInner(n,Math.max(o-s,0),Math.min(this.length,i)-s,a+s)===!1)return!1},e.prototype.forEachInvertedInner=function(n,o,i,a){var s=this.left.length;if(o>s&&this.right.forEachInvertedInner(n,o-s,Math.max(i,s)-s,a+s)===!1||i<s&&this.left.forEachInvertedInner(n,Math.min(o,s),i,a)===!1)return!1},e.prototype.sliceInner=function(n,o){if(n==0&&o==this.length)return this;var i=this.left.length;return o<=i?this.left.slice(n,o):n>=i?this.right.slice(n-i,o-i):this.left.slice(n,i).append(this.right.slice(0,o-i))},e.prototype.leafAppend=function(n){var o=this.right.leafAppend(n);if(o)return new e(this.left,o)},e.prototype.leafPrepend=function(n){var o=this.left.leafPrepend(n);if(o)return new e(o,this.right)},e.prototype.appendInner=function(n){return this.left.depth>=Math.max(this.right.depth,n.depth)+1?new e(this.left,new e(this.right,n)):new e(this,n)},e}(I),Qr=I,Xe=Qr;var Me=T(A("prosemirror-state")),Xr=500,B=function(e,t){this.items=e,this.eventCount=t};B.prototype.popEvent=function(e,t){var n=this;if(this.eventCount==0)return null;for(var o=this.items.length;;o--){var i=this.items.get(o-1);if(i.selection){--o;break}}var a,s;t&&(a=this.remapping(o,this.items.length),s=a.maps.length);var l=e.tr,p,f,u=[],c=[];return this.items.forEach(function(h,m){if(!h.step){a||(a=n.remapping(o,m+1),s=a.maps.length),s--,c.push(h);return}if(a){c.push(new J(h.map));var v=h.step.map(a.slice(s)),g;v&&l.maybeStep(v).doc&&(g=l.mapping.maps[l.mapping.maps.length-1],u.push(new J(g,null,null,u.length+c.length))),s--,g&&a.appendMap(g,s)}else l.maybeStep(h.step);if(h.selection)return p=a?h.selection.map(a.slice(s)):h.selection,f=new B(n.items.slice(0,o).append(c.reverse().concat(u)),n.eventCount-1),!1},this.items.length,0),{remaining:f,transform:l,selection:p}};B.prototype.addTransform=function(e,t,n,o){for(var i=[],a=this.eventCount,s=this.items,l=!o&&s.length?s.get(s.length-1):null,p=0;p<e.steps.length;p++){var f=e.steps[p].invert(e.docs[p]),u=new J(e.mapping.maps[p],f,t),c=void 0;(c=l&&l.merge(u))&&(u=c,p?i.pop():s=s.slice(0,s.length-1)),i.push(u),t&&(a++,t=null),o||(l=u)}var h=a-n.depth;return h>$r&&(s=Zr(s,h),a-=h),new B(s.append(i),a)};B.prototype.remapping=function(e,t){var n=new S;return this.items.forEach(function(o,i){var a=o.mirrorOffset!=null&&i-o.mirrorOffset>=e?n.maps.length-o.mirrorOffset:null;n.appendMap(o.map,a)},e,t),n};B.prototype.addMaps=function(e){return this.eventCount==0?this:new B(this.items.append(e.map(function(t){return new J(t)})),this.eventCount)};B.prototype.rebased=function(e,t){if(!this.eventCount)return this;var n=[],o=Math.max(0,this.items.length-t),i=e.mapping,a=e.steps.length,s=this.eventCount;this.items.forEach(function(h){h.selection&&s--},o);var l=t;this.items.forEach(function(h){var m=i.getMirror(--l);if(m!=null){a=Math.min(a,m);var v=i.maps[m];if(h.step){var g=e.steps[m].invert(e.docs[m]),y=h.selection&&h.selection.map(i.slice(l+1,m));y&&s++,n.push(new J(v,g,y))}else n.push(new J(v))}},o);for(var p=[],f=t;f<a;f++)p.push(new J(i.maps[f]));var u=this.items.slice(0,o).append(p).append(n),c=new B(u,s);return c.emptyItemCount()>Xr&&(c=c.compress(this.items.length-n.length)),c};B.prototype.emptyItemCount=function(){var e=0;return this.items.forEach(function(t){t.step||e++}),e};B.prototype.compress=function(e){e===void 0&&(e=this.items.length);var t=this.remapping(0,e),n=t.maps.length,o=[],i=0;return this.items.forEach(function(a,s){if(s>=e)o.push(a),a.selection&&i++;else if(a.step){var l=a.step.map(t.slice(n)),p=l&&l.getMap();if(n--,p&&t.appendMap(p,n),l){var f=a.selection&&a.selection.map(t.slice(n));f&&i++;var u=new J(p.invert(),l,f),c,h=o.length-1;(c=o.length&&o[h].merge(u))?o[h]=c:o.push(u)}}else a.map&&n--},this.items.length,0),new B(Xe.from(o.reverse()),i)};B.empty=new B(Xe.empty,0);function Zr(r,e){var t;return r.forEach(function(n,o){if(n.selection&&e--==0)return t=o,!1}),r.slice(t)}var J=function(e,t,n,o){this.map=e,this.step=t,this.selection=n,this.mirrorOffset=o};J.prototype.merge=function(e){if(this.step&&e.step&&!e.selection){var t=e.step.merge(this.step);if(t)return new J(t.getMap().invert(),t,this.selection)}};var Yr=function(e,t,n,o){this.done=e,this.undone=t,this.prevRanges=n,this.prevTime=o},$r=20;function Jt(r,e,t,n){var o=en(e),i=ke.get(e).spec.config,a=(n?r.undone:r.done).popEvent(e,o);if(!!a){var s=a.selection.resolve(a.transform.doc),l=(n?r.done:r.undone).addTransform(a.transform,e.selection.getBookmark(),i,o),p=new Yr(n?l:a.remaining,n?a.remaining:l,null,0);t(a.transform.setSelection(s).setMeta(ke,{redo:n,historyState:p}).scrollIntoView())}}var Ze=!1,Wt=null;function en(r){var e=r.plugins;if(Wt!=e){Ze=!1,Wt=e;for(var t=0;t<e.length;t++)if(e[t].spec.historyPreserveItems){Ze=!0;break}}return Ze}var ke=new Me.PluginKey("history"),Hn=new Me.PluginKey("closeHistory");function Ye(r,e){var t=ke.getState(r);return!t||t.done.eventCount==0?!1:(e&&Jt(t,r,e,!1),!0)}function $e(r,e){var t=ke.getState(r);return!t||t.undone.eventCount==0?!1:(e&&Jt(t,r,e,!0),!0)}var tn=T(A("prosemirror-state")),fe="http://www.w3.org/2000/svg",rn="http://www.w3.org/1999/xlink",et="ProseMirror-icon";function nn(r){for(var e=0,t=0;t<r.length;t++)e=(e<<5)-e+r.charCodeAt(t)|0;return e}function on(r){var e=document.createElement("div");if(e.className=et,r.path){var t="pm-icon-"+nn(r.path).toString(16);document.getElementById(t)||an(t,r);var n=e.appendChild(document.createElementNS(fe,"svg"));n.style.width=r.width/r.height+"em";var o=n.appendChild(document.createElementNS(fe,"use"));o.setAttributeNS(rn,"href",/([^#]*)/.exec(document.location)[1]+"#"+t)}else r.dom?e.appendChild(r.dom.cloneNode(!0)):(e.appendChild(document.createElement("span")).textContent=r.text||"",r.css&&(e.firstChild.style.cssText=r.css));return e}function an(r,e){var t=document.getElementById(et+"-collection");t||(t=document.createElementNS(fe,"svg"),t.id=et+"-collection",t.style.display="none",document.body.insertBefore(t,document.body.firstChild));var n=document.createElementNS(fe,"symbol");n.id=r,n.setAttribute("viewBox","0 0 "+e.width+" "+e.height);var o=n.appendChild(document.createElementNS(fe,"path"));o.setAttribute("d",e.path),t.appendChild(n)}var P="ProseMirror-menu",V=function(e){this.spec=e};V.prototype.render=function(e){var t=this.spec,n=t.render?t.render(e):t.icon?on(t.icon):t.label?R("div",null,ue(e,t.label)):null;if(!n)throw new RangeError("MenuItem without icon or label property");if(t.title){var o=typeof t.title=="function"?t.title(e.state):t.title;n.setAttribute("title",ue(e,o))}t.class&&n.classList.add(t.class),t.css&&(n.style.cssText+=t.css),n.addEventListener("mousedown",function(a){a.preventDefault(),n.classList.contains(P+"-disabled")||t.run(e.state,e.dispatch,e,a)});function i(a){if(t.select){var s=t.select(a);if(n.style.display=s?"":"none",!s)return!1}var l=!0;if(t.enable&&(l=t.enable(a)||!1,rt(n,P+"-disabled",!l)),t.active){var p=l&&t.active(a)||!1;rt(n,P+"-active",p)}return!0}return{dom:n,update:i}};function ue(r,e){return r._props.translate?r._props.translate(e):e}var ce={time:0,node:null};function Kt(r){ce.time=Date.now(),ce.node=r.target}function Ut(r){return Date.now()-100<ce.time&&ce.node&&r.contains(ce.node)}var he=function(e,t){this.options=t||{},this.content=Array.isArray(e)?e:[e]};he.prototype.render=function(e){var t=this,n=Gt(this.content,e),o=R("div",{class:P+"-dropdown "+(this.options.class||""),style:this.options.css},ue(e,this.options.label));this.options.title&&o.setAttribute("title",ue(e,this.options.title));var i=R("div",{class:P+"-dropdown-wrap"},o),a=null,s=null,l=function(){a&&a.close()&&(a=null,window.removeEventListener("mousedown",s))};o.addEventListener("mousedown",function(f){f.preventDefault(),Kt(f),a?l():(a=t.expand(i,n.dom),window.addEventListener("mousedown",s=function(){Ut(i)||l()}))});function p(f){var u=n.update(f);return i.style.display=u?"":"none",u}return{dom:i,update:p}};he.prototype.expand=function(e,t){var n=R("div",{class:P+"-dropdown-menu "+(this.options.class||"")},t),o=!1;function i(){if(!o)return o=!0,e.removeChild(n),!0}return e.appendChild(n),{close:i,node:n}};function Gt(r,e){for(var t=[],n=[],o=0;o<r.length;o++){var i=r[o].render(e),a=i.dom,s=i.update;t.push(R("div",{class:P+"-dropdown-item"},a)),n.push(s)}return{dom:t,update:jt(n,t)}}function jt(r,e){return function(t){for(var n=!1,o=0;o<r.length;o++){var i=r[o](t);e[o].style.display=i?"":"none",i&&(n=!0)}return n}}var sn=function(e,t){this.options=t||{},this.content=Array.isArray(e)?e:[e]};sn.prototype.render=function(e){var t=Gt(this.content,e),n=R("div",{class:P+"-submenu-label"},ue(e,this.options.label)),o=R("div",{class:P+"-submenu-wrap"},n,R("div",{class:P+"-submenu"},t.dom)),i=null;n.addEventListener("mousedown",function(s){s.preventDefault(),Kt(s),rt(o,P+"-submenu-wrap-active"),i||window.addEventListener("mousedown",i=function(){Ut(o)||(o.classList.remove(P+"-submenu-wrap-active"),window.removeEventListener("mousedown",i),i=null)})});function a(s){var l=t.update(s);return o.style.display=l?"":"none",l}return{dom:o,update:a}};function ln(r,e){for(var t=document.createDocumentFragment(),n=[],o=[],i=0;i<e.length;i++){for(var a=e[i],s=[],l=[],p=0;p<a.length;p++){var f=a[p].render(r),u=f.dom,c=f.update,h=R("span",{class:P+"item"},u);t.appendChild(h),l.push(h),s.push(c)}s.length&&(n.push(jt(s,l)),i<e.length-1&&o.push(t.appendChild(pn())))}function m(v){for(var g=!1,y=!1,M=0;M<n.length;M++){var b=n[M](v);M&&(o[M-1].style.display=y&&b?"":"none"),y=b,b&&(g=!0)}return g}return{dom:t,update:m}}function pn(){return R("span",{class:P+"separator"})}var j={join:{width:800,height:900,path:"M0 75h800v125h-800z M0 825h800v-125h-800z M250 400h100v-100h100v100h100v100h-100v100h-100v-100h-100z"},lift:{width:1024,height:1024,path:"M219 310v329q0 7-5 12t-12 5q-8 0-13-5l-164-164q-5-5-5-13t5-13l164-164q5-5 13-5 7 0 12 5t5 12zM1024 749v109q0 7-5 12t-12 5h-987q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h987q7 0 12 5t5 12zM1024 530v109q0 7-5 12t-12 5h-621q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h621q7 0 12 5t5 12zM1024 310v109q0 7-5 12t-12 5h-621q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h621q7 0 12 5t5 12zM1024 91v109q0 7-5 12t-12 5h-987q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h987q7 0 12 5t5 12z"},selectParentNode:{text:"\u2B1A",css:"font-weight: bold"},undo:{width:1024,height:1024,path:"M761 1024c113-206 132-520-313-509v253l-384-384 384-384v248c534-13 594 472 313 775z"},redo:{width:1024,height:1024,path:"M576 248v-248l384 384-384 384v-253c-446-10-427 303-313 509-280-303-221-789 313-775z"},strong:{width:805,height:1024,path:"M317 869q42 18 80 18 214 0 214-191 0-65-23-102-15-25-35-42t-38-26-46-14-48-6-54-1q-41 0-57 5 0 30-0 90t-0 90q0 4-0 38t-0 55 2 47 6 38zM309 442q24 4 62 4 46 0 81-7t62-25 42-51 14-81q0-40-16-70t-45-46-61-24-70-8q-28 0-74 7 0 28 2 86t2 86q0 15-0 45t-0 45q0 26 0 39zM0 950l1-53q8-2 48-9t60-15q4-6 7-15t4-19 3-18 1-21 0-19v-37q0-561-12-585-2-4-12-8t-25-6-28-4-27-2-17-1l-2-47q56-1 194-6t213-5q13 0 39 0t38 0q40 0 78 7t73 24 61 40 42 59 16 78q0 29-9 54t-22 41-36 32-41 25-48 22q88 20 146 76t58 141q0 57-20 102t-53 74-78 48-93 27-100 8q-25 0-75-1t-75-1q-60 0-175 6t-132 6z"},em:{width:585,height:1024,path:"M0 949l9-48q3-1 46-12t63-21q16-20 23-57 0-4 35-165t65-310 29-169v-14q-13-7-31-10t-39-4-33-3l10-58q18 1 68 3t85 4 68 1q27 0 56-1t69-4 56-3q-2 22-10 50-17 5-58 16t-62 19q-4 10-8 24t-5 22-4 26-3 24q-15 84-50 239t-44 203q-1 5-7 33t-11 51-9 47-3 32l0 10q9 2 105 17-1 25-9 56-6 0-18 0t-18 0q-16 0-49-5t-49-5q-78-1-117-1-29 0-81 5t-69 6z"},code:{width:896,height:1024,path:"M608 192l-96 96 224 224-224 224 96 96 288-320-288-320zM288 192l-288 320 288 320 96-96-224-224 224-224-96-96z"},link:{width:951,height:1024,path:"M832 694q0-22-16-38l-118-118q-16-16-38-16-24 0-41 18 1 1 10 10t12 12 8 10 7 14 2 15q0 22-16 38t-38 16q-8 0-15-2t-14-7-10-8-12-12-10-10q-18 17-18 41 0 22 16 38l117 118q15 15 38 15 22 0 38-14l84-83q16-16 16-38zM430 292q0-22-16-38l-117-118q-16-16-38-16-22 0-38 15l-84 83q-16 16-16 38 0 22 16 38l118 118q15 15 38 15 24 0 41-17-1-1-10-10t-12-12-8-10-7-14-2-15q0-22 16-38t38-16q8 0 15 2t14 7 10 8 12 12 10 10q18-17 18-41zM941 694q0 68-48 116l-84 83q-47 47-116 47-69 0-116-48l-117-118q-47-47-47-116 0-70 50-119l-50-50q-49 50-118 50-68 0-116-48l-118-118q-48-48-48-116t48-116l84-83q47-47 116-47 69 0 116 48l117 118q47 47 47 116 0 70-50 119l50 50q49-50 118-50 68 0 116 48l118 118q48 48 48 116z"},bulletList:{width:768,height:896,path:"M0 512h128v-128h-128v128zM0 256h128v-128h-128v128zM0 768h128v-128h-128v128zM256 512h512v-128h-512v128zM256 256h512v-128h-512v128zM256 768h512v-128h-512v128z"},orderedList:{width:768,height:896,path:"M320 512h448v-128h-448v128zM320 768h448v-128h-448v128zM320 128v128h448v-128h-448zM79 384h78v-256h-36l-85 23v50l43-2v185zM189 590c0-36-12-78-96-78-33 0-64 6-83 16l1 66c21-10 42-15 67-15s32 11 32 28c0 26-30 58-110 112v50h192v-67l-91 2c49-30 87-66 87-113l1-1z"},blockquote:{width:640,height:896,path:"M0 448v256h256v-256h-128c0 0 0-128 128-128v-128c0 0-256 0-256 256zM640 320v-128c0 0-256 0-256 256v256h256v-256h-128c0 0 0-128 128-128z"}},Gn=new V({title:"Join with above block",run:Je,select:function(r){return Je(r)},icon:j.join}),jn=new V({title:"Lift out of enclosing block",run:We,select:function(r){return We(r)},icon:j.lift}),Qn=new V({title:"Select parent node",run:Ge,select:function(r){return Ge(r)},icon:j.selectParentNode}),Xn=new V({title:"Undo last change",run:Ye,enable:function(r){return Ye(r)},icon:j.undo}),Zn=new V({title:"Redo last undone change",run:$e,enable:function(r){return $e(r)},icon:j.redo});function tt(r,e){var t=Pt(r,e.attrs),n={run:t,enable:function(a){return t(a)},active:function(a){var s=a.selection,l=s.$from,p=s.to,f=s.node;return f?f.hasMarkup(r,e.attrs):p<=l.end()&&l.parent.hasMarkup(r,e.attrs)}};for(var o in e)n[o]=e[o];return new V(n)}function rt(r,e,t){t?r.classList.add(e):r.classList.remove(e)}var be="ProseMirror-menubar";function fn(){if(typeof navigator=="undefined")return!1;var r=navigator.userAgent;return!/Edge\/\d/.test(r)&&/AppleWebKit/.test(r)&&/Mobile\/\w+/.test(r)}var xe=function(e,t){var n=this;this.editorView=e,this.options=t,this.wrapper=R("div",{class:be+"-wrapper"}),this.menu=this.wrapper.appendChild(R("div",{class:be})),this.menu.className=be,this.spacer=null,e.dom.parentNode.replaceChild(this.wrapper,e.dom),this.wrapper.appendChild(e.dom),this.maxHeight=0,this.widthForMaxHeight=0,this.floating=!1;var o=ln(this.editorView,this.options.content),i=o.dom,a=o.update;if(this.contentUpdate=a,this.menu.appendChild(i),this.update(),t.floating&&!fn()){this.updateFloat();var s=hn(this.wrapper);this.scrollFunc=function(l){var p=n.editorView.root;(p.body||p).contains(n.wrapper)?n.updateFloat(l.target.getBoundingClientRect&&l.target):s.forEach(function(f){return f.removeEventListener("scroll",n.scrollFunc)})},s.forEach(function(l){return l.addEventListener("scroll",n.scrollFunc)})}};xe.prototype.update=function(){this.contentUpdate(this.editorView.state),this.floating?this.updateScrollCursor():(this.menu.offsetWidth!=this.widthForMaxHeight&&(this.widthForMaxHeight=this.menu.offsetWidth,this.maxHeight=0),this.menu.offsetHeight>this.maxHeight&&(this.maxHeight=this.menu.offsetHeight,this.menu.style.minHeight=this.maxHeight+"px"))};xe.prototype.updateScrollCursor=function(){var e=this.editorView.root.getSelection();if(!!e.focusNode){var t=e.getRangeAt(0).getClientRects(),n=t[un(e)?0:t.length-1];if(!!n){var o=this.menu.getBoundingClientRect();if(n.top<o.bottom&&n.bottom>o.top){var i=cn(this.wrapper);i&&(i.scrollTop-=o.bottom-n.top)}}}};xe.prototype.updateFloat=function(e){var t=this.wrapper,n=t.getBoundingClientRect(),o=e?Math.max(0,e.getBoundingClientRect().top):0;if(this.floating)if(n.top>=o||n.bottom<this.menu.offsetHeight+10)this.floating=!1,this.menu.style.position=this.menu.style.left=this.menu.style.top=this.menu.style.width="",this.menu.style.display="",this.spacer.parentNode.removeChild(this.spacer),this.spacer=null;else{var i=(t.offsetWidth-t.clientWidth)/2;this.menu.style.left=n.left+i+"px",this.menu.style.display=n.top>window.innerHeight?"none":"",e&&(this.menu.style.top=o+"px")}else if(n.top<o&&n.bottom>=this.menu.offsetHeight+10){this.floating=!0;var a=this.menu.getBoundingClientRect();this.menu.style.left=a.left+"px",this.menu.style.width=a.width+"px",e&&(this.menu.style.top=o+"px"),this.menu.style.position="fixed",this.spacer=R("div",{class:be+"-spacer",style:"height: "+a.height+"px"}),t.insertBefore(this.spacer,this.menu)}};xe.prototype.destroy=function(){this.wrapper.parentNode&&this.wrapper.parentNode.replaceChild(this.editorView.dom,this.wrapper)};function un(r){return r.anchorNode==r.focusNode?r.anchorOffset>r.focusOffset:r.anchorNode.compareDocumentPosition(r.focusNode)==Node.DOCUMENT_POSITION_FOLLOWING}function cn(r){for(var e=r.parentNode;e;e=e.parentNode)if(e.scrollHeight>e.clientHeight)return e}function hn(r){for(var e=[window],t=r.parentNode;t;t=t.parentNode)e.push(t);return e}var Se=_(E({},j),{strikethrough:{width:22,height:22,path:"M15.6 8.5c-.5-.7-1-1.1-1.3-1.3c-.6-.4-1.3-.6-2-.6c-2.7 0-2.8 1.7-2.8 2.1c0 1.6 1.8 2 3.2 2.3c4.4.9 4.6 2.8 4.6 3.9c0 1.4-.7 4.1-5 4.1A6.2 6.2 0 017 16.4l1.5-1.1c.4.6 1.6 2 3.7 2c1.6 0 2.5-.4 3-1.2c.4-.8.3-2-.8-2.6c-.7-.4-1.6-.7-2.9-1c-1-.2-3.9-.8-3.9-3.6C7.6 6 10.3 5 12.4 5c2.9 0 4.2 1.6 4.7 2.4l-1.5 1.1zM5 11h14a1 1 0 010 2H5a1 1 0 010-2z"},underline:{width:22,height:20,path:"M16 5c.6 0 1 .4 1 1v5.5a4 4 0 01-.4 1.8l-1 1.4a5.3 5.3 0 01-5.5 1a5 5 0 01-1.6-1c-.5-.4-.8-.9-1.1-1.4a4 4 0 01-.4-1.8V6c0-.6.4-1 1-1s1 .4 1 1v5.5c0 .3 0 .6.2 1l.6.7a3.3 3.3 0 002.2.8a3.4 3.4 0 002.2-.8c.3-.2.4-.5.6-.8l.2-.9V6c0-.6.4-1 1-1zM8 17h8c.6 0 1 .4 1 1s-.4 1-1 1H8a1 1 0 010-2z"}});function Qt(r,e){return function(t,n){let{empty:o,$cursor:i,ranges:a}=t.selection;if(o&&!i)return!1;if(n)if(i)r.isInSet(t.storedMarks||i.marks())&&n(t.tr.removeStoredMark(r)),e&&n(t.tr.addStoredMark(r.create(e)));else{let s=!1,l=t.tr;for(let p=0;!s&&p<a.length;p++){let{$from:f,$to:u}=a[p];s=t.doc.rangeHasMark(f.pos,u.pos,r)}for(let p=0;p<a.length;p++){let{$from:f,$to:u}=a[p],c=f.pos,h=u.pos,m=f.nodeAfter,v=u.nodeBefore,g=m&&m.isText?/^\s*/.exec(m.text)[0].length:0,y=v&&v.isText?/\s*$/.exec(v.text)[0].length:0;c+g<h&&(c+=g,h-=y),e?l.addMark(c,h,r.create(e)):l.removeMark(c,h,r)}n(l.scrollIntoView())}return!0}}var Xt=(r,e)=>{let t={};return r.map(n=>{e[n.type]&&(t[n.type]=_(E({},e[n.type]),{config:n}))}),t};function dn({name:r,spec:{title:e}}){return e||r}var Zt=r=>r.nodes.heading?r.nodes.heading.spec.config.values.map(e=>tt(r.nodes.heading,{title:"Header "+e,label:"Header "+e,attrs:{level:e}})):[],Yt=r=>r.nodes.paragraph?[tt(r.nodes.paragraph,{title:"paragraph",label:"paragraph"})]:[],$t=r=>r.nodes.html?[new V({title:"Insert HTML code",label:"HTML",enable(){return!0},run(e,t,n){n.dom.parentNode.parentNode.dispatchEvent(new CustomEvent("exProsemirrorInsertPlaceholder",{detail:{nodeType:"html"}}))}})]:[],er=r=>r.nodes.image?[new V({title:"Insert image",label:"Image",enable(){return!0},run(e,t,n){n.dom.parentNode.parentNode.dispatchEvent(new CustomEvent("exProsemirrorInsertPlaceholder",{detail:{nodeType:"image"}}))}})]:[],$=r=>e=>{if(!e.marks[r])return[];let t=e.marks[r],n=t.spec.icon||Se[r];return[tr(e.marks[r],{title:dn(t),icon:n})]};function tr(r,e){let t={active(n){return rr(n,r)},enable:!0};for(let n in e)t[n]=e[n];return nt(_t(r),t)}function nt(r,e){let t={label:e.title,run:r};for(let n in e)t[n]=e[n];return(!e.enable||e.enable===!0)&&!e.select&&(t[e.enable?"enable":"select"]=n=>r(n)),new V(t)}function rr(r,e){let{from:t,$from:n,to:o,empty:i}=r.selection;return i?e.isInSet(r.storedMarks||n.marks()):r.doc.rangeHasMark(t,o,e)}var ot=r=>{let e=at(r,"color");return[new he(e,{label:"Color"})]},it=r=>{let e=at(r,"font_family");return[new he(e,{label:"Font"})]},at=(r,e)=>{if(!r.marks[e])return[];let t=[Ie(r.marks[e],{title:"default"})],n=r.marks[e].spec.config.values;if(Array.isArray(n))for(let o of n){let i=[];i[e]=o,t.push(Ie(r.marks[e],{title:o},i))}else for(let[o,i]of Object.entries(n)){let a=[];a[e]=i,t.push(Ie(r.marks[e],{title:o},a))}return t};function Ie(r,e,t){return nt(Qt(r,t),E({enable:!0},e))}var ee={generateParagraphItem:Yt,generateHeadingItem:Zt,generateHTMLItem:$t,generateMediaMenu:er};var nr={strong:_(E({},Ee.marks.strong),{generateMenuItem:$("strong")}),em:_(E({},Ee.marks.em),{generateMenuItem:$("em")}),link:E({},Ee.marks.link),strikethrough:{toDOM(){return["del",0]},parseDOM:[{tag:"del"}],generateMenuItem:$("strikethrough")},underline:{toDOM(){return["span",{style:"text-decoration: underline"},0]},parseDOM:[{tag:"span"}],generateMenuItem:$("underline")},color:{title:"Color",label:"Color",attrs:{color:{}},toDOM(r){return["span",{style:"color: "+r.attrs.color},0]},parseDOM:[{tag:"span",getAttrs(r){return{color:r.style.color}}}],generateMenuItem:ot},font_family:{title:"Font",label:"Font",attrs:{font_family:{}},toDOM(r){return["span",{style:"font-family: "+r.attrs.font_family},0]},parseDOM:[{tag:"span",getAttrs(r){return{font_family:r.style["font-family"]}}}],generateMenuItem:it}},Ne=({marksSelection:r,marks:e})=>Xt(r,e);var Q=T(A("prosemirror-schema-basic"));function mn(r,e){return e?{content:"block?"}:r.doc}var or=(r,e,t)=>{let n={text:e.text,doc:mn(e,t)};return r.map(o=>{e[o.type]&&(n[o.type]=_(E({},e[o.type]),{config:o}))}),n};var vn=_(E({},Q.nodes.paragraph),{generateMenuItem:ee.generateParagraphItem}),gn=_(E({},Q.nodes.heading),{generateMenuItem:ee.generateHeadingItem}),yn={inline:!0,attrs:{html:{default:null}},group:"inline",draggable:!1,parseDOM:[{tag:"div[html]",getAttrs(r){return{html:r.getAttribute("html")}}}],toDOM(r){let{html:e}=r.attrs,t=document.createElement("div");return t.innerHTML=e,t},generateMenuItem:ee.generateHTMLItem},wn=_(E({},Q.nodes.image),{inline:!1,group:"block",generateMenuItem:ee.generateMediaMenu}),ir={doc:Q.nodes.doc,text:Q.nodes.text,hard_break:Q.nodes.hard_break,paragraph:vn,heading:gn,image:wn,html:yn},Oe=({blocksSelection:r,blocks:e,inline:t})=>or(r,e,t);var X=r=>new ar.Schema({nodes:Oe(r),marks:Ne(r)});var te=class{constructor(e,t){this.editorNode=e,this.target=e.dataset.target+"_plain",this.editorView=new lr.EditorView(e,{state:this.initializeEditorState(t),dispatchTransaction:n=>{this.dispatchTransaction(n)}}),this.addListeners()}initializeEditorState({blocks:e,marks:t,plugins:n}){let o={marksSelection:JSON.parse(this.editorNode.dataset.marks),blocksSelection:JSON.parse(this.editorNode.dataset.blocks),inline:JSON.parse(this.editorNode.dataset.inline),blocks:e,marks:t},i=X(o);return n=n(i).map((a,s)=>(a.key.startsWith("plugin$")&&(a.key="plugin$"+s),a)),sr.EditorState.create({doc:this.getDoc(i),plugins:n})}getDoc(e){let t=document.querySelector(this.target).value;if(t.length>0)try{return e.nodeFromJSON(JSON.parse(t))}catch(n){return st.DOMParser.fromSchema(e).parse("")}else return st.DOMParser.fromSchema(e).parse("")}addListeners(){let e=this;this.editorNode.addEventListener("exProsemirrorInsertPlaceholder",({detail:t})=>{me(e,{nodeType:t.nodeType})})}dispatchTransaction(e){let t=this.editorView.state.apply(e),n=t.doc.toJSON(),o=document.querySelector(this.target);o.value=JSON.stringify(n),o.dispatchEvent(new CustomEvent("change",{detail:JSON.parse(o.value)})),this.editorView.updateState(t)}};var lt=T(A("prosemirror-example-setup"));var pt={};pt.MountProseMirror={mounted(){Ae.init(this.el,{schemaFunc:X,pluginFunc:lt.exampleSetup})},updated(){Ae.init(this.el,{schemaFunc:X,pluginFunc:lt.exampleSetup})}};var U={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",229:"q"},Te={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"',229:"Q"},pr=typeof navigator!="undefined"&&/Chrome\/(\d+)/.exec(navigator.userAgent),Mn=typeof navigator!="undefined"&&/Apple Computer/.test(navigator.vendor),kn=typeof navigator!="undefined"&&/Gecko\/\d+/.test(navigator.userAgent),fr=typeof navigator!="undefined"&&/Mac/.test(navigator.platform),bn=typeof navigator!="undefined"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),xn=pr&&(fr||+pr[1]<57)||kn&&fr;for(var C=0;C<10;C++)U[48+C]=U[96+C]=String(C);for(var C=1;C<=24;C++)U[C+111]="F"+C;for(var C=65;C<=90;C++)U[C]=String.fromCharCode(C+32),Te[C]=String.fromCharCode(C);for(var ft in U)Te.hasOwnProperty(ft)||(Te[ft]=U[ft]);function ur(r){var e=xn&&(r.ctrlKey||r.altKey||r.metaKey)||(Mn||bn)&&r.shiftKey&&r.key&&r.key.length==1,t=!e&&r.key||(r.shiftKey?Te:U)[r.keyCode]||r.key||"Unidentified";return t=="Esc"&&(t="Escape"),t=="Del"&&(t="Delete"),t=="Left"&&(t="ArrowLeft"),t=="Up"&&(t="ArrowUp"),t=="Right"&&(t="ArrowRight"),t=="Down"&&(t="ArrowDown"),t}var cr=T(A("prosemirror-state")),Sn=typeof navigator!="undefined"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):!1;function In(r){var e=r.split(/-(?!$)/),t=e[e.length-1];t=="Space"&&(t=" ");for(var n,o,i,a,s=0;s<e.length-1;s++){var l=e[s];if(/^(cmd|meta|m)$/i.test(l))a=!0;else if(/^a(lt)?$/i.test(l))n=!0;else if(/^(c|ctrl|control)$/i.test(l))o=!0;else if(/^s(hift)?$/i.test(l))i=!0;else if(/^mod$/i.test(l))Sn?a=!0:o=!0;else throw new Error("Unrecognized modifier name: "+l)}return n&&(t="Alt-"+t),o&&(t="Ctrl-"+t),a&&(t="Meta-"+t),i&&(t="Shift-"+t),t}function Cn(r){var e=Object.create(null);for(var t in r)e[In(t)]=r[t];return e}function ut(r,e,t){return e.altKey&&(r="Alt-"+r),e.ctrlKey&&(r="Ctrl-"+r),e.metaKey&&(r="Meta-"+r),t!==!1&&e.shiftKey&&(r="Shift-"+r),r}function ct(r){return new cr.Plugin({props:{handleKeyDown:En(r)}})}function En(r){var e=Cn(r);return function(t,n){var o=ur(n),i=o.length==1&&o!=" ",a,s=e[ut(o,n,!i)];if(s&&s(t.state,t.dispatch,t))return!0;if(i&&(n.shiftKey||n.altKey||n.metaKey||o.charCodeAt(0)>127)&&(a=U[n.keyCode])&&a!=o){var l=e[ut(a,n,!0)];if(l&&l(t.state,t.dispatch,t))return!0}else if(i&&n.shiftKey){var p=e[ut(o,n,!0)];if(p&&p(t.state,t.dispatch,t))return!0}return!1}}function Nn(r,e){let t=r.schema.nodes.hard_break;e(r.tr.replaceSelectionWith(t.create()).scrollIntoView())}var hr={"Shift-Enter":pe(Ue,Nn)};var On=document.querySelectorAll(".ex-prosemirror"),dr=class{setBlocks(e){return this.blocks=e,this}setMarks(e){return this.marks=e,this}setPlugins(e){return this.plugins=e,this}initAll(){Array.from(On).forEach(e=>{this.init(e)})}init(e){if(e instanceof HTMLElement){e.innerHTML="";let t=this.plugins||[];return new te(e,{blocks:this.blocks,marks:this.marks,plugins:t})}return null}},Ae=new dr;return An;})();
