var LiveView=(()=>{var on=Object.defineProperty,Oa=Object.defineProperties;var wa=Object.getOwnPropertyDescriptors;var Mo=Object.getOwnPropertySymbols;var Na=Object.prototype.hasOwnProperty,Da=Object.prototype.propertyIsEnumerable;var Co=(r,e,t)=>e in r?on(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ee=(r,e)=>{for(var t in e||(e={}))Na.call(e,t)&&Co(r,t,e[t]);if(Mo)for(var t of Mo(e))Da.call(e,t)&&Co(r,t,e[t]);return r},he=(r,e)=>Oa(r,wa(e)),Ta=r=>on(r,"__esModule",{value:!0});var Ze=(r,e)=>{Ta(r);for(var t in e)on(r,t,{get:e[t],enumerable:!0})};var Qu={};Ze(Qu,{ExEditorView:()=>It,ExProsemirrorHooks:()=>ko,baseKeymap:()=>rr,blocks:()=>ea,createSchema:()=>pt,default:()=>rn,generateSchemaMarks:()=>Ur,generateSchemablocks:()=>Gr,hardBreakKeymap:()=>Ca,icons:()=>Wr,insertPlaceholder:()=>_r,keymap:()=>At,marks:()=>Zs,menu:()=>Kr,placeholderPlugin:()=>Yt,prosemirrorExampleSetup:()=>tn,prosemirrorModel:()=>yr,prosemirrorSchemaBasic:()=>Vr,prosemirrorState:()=>Or,prosemirrorView:()=>Br,replacePlaceholder:()=>eo});var yr={};Ze(yr,{ContentMatch:()=>U,DOMParser:()=>se,DOMSerializer:()=>L,Fragment:()=>m,Mark:()=>w,MarkType:()=>Te,Node:()=>D,NodeRange:()=>tt,NodeType:()=>re,ReplaceError:()=>ge,ResolvedPos:()=>z,Schema:()=>Oe,Slice:()=>k});function te(r){this.content=r}te.prototype={constructor:te,find:function(r){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===r)return e;return-1},get:function(r){var e=this.find(r);return e==-1?void 0:this.content[e+1]},update:function(r,e,t){var n=t&&t!=r?this.remove(t):this,o=n.find(r),i=n.content.slice();return o==-1?i.push(t||r,e):(i[o+1]=e,t&&(i[o]=t)),new te(i)},remove:function(r){var e=this.find(r);if(e==-1)return this;var t=this.content.slice();return t.splice(e,2),new te(t)},addToStart:function(r,e){return new te([r,e].concat(this.remove(r).content))},addToEnd:function(r,e){var t=this.remove(r).content.slice();return t.push(r,e),new te(t)},addBefore:function(r,e,t){var n=this.remove(e),o=n.content.slice(),i=n.find(r);return o.splice(i==-1?o.length:i,0,e,t),new te(o)},forEach:function(r){for(var e=0;e<this.content.length;e+=2)r(this.content[e],this.content[e+1])},prepend:function(r){return r=te.from(r),r.size?new te(r.content.concat(this.subtract(r).content)):this},append:function(r){return r=te.from(r),r.size?new te(this.subtract(r).content.concat(r.content)):this},subtract:function(r){var e=this;r=te.from(r);for(var t=0;t<r.content.length;t+=2)e=e.remove(r.content[t]);return e},get size(){return this.content.length>>1}};te.from=function(r){if(r instanceof te)return r;var e=[];if(r)for(var t in r)e.push(t,r[t]);return new te(e)};var Ea=te,sn=Ea;function xo(r,e,t){for(var n=0;;n++){if(n==r.childCount||n==e.childCount)return r.childCount==e.childCount?null:t;var o=r.child(n),i=e.child(n);if(o==i){t+=o.nodeSize;continue}if(!o.sameMarkup(i))return t;if(o.isText&&o.text!=i.text){for(var s=0;o.text[s]==i.text[s];s++)t++;return t}if(o.content.size||i.content.size){var a=xo(o.content,i.content,t+1);if(a!=null)return a}t+=o.nodeSize}}function Oo(r,e,t,n){for(var o=r.childCount,i=e.childCount;;){if(o==0||i==0)return o==i?null:{a:t,b:n};var s=r.child(--o),a=e.child(--i),l=s.nodeSize;if(s==a){t-=l,n-=l;continue}if(!s.sameMarkup(a))return{a:t,b:n};if(s.isText&&s.text!=a.text){for(var f=0,u=Math.min(s.text.length,a.text.length);f<u&&s.text[s.text.length-f-1]==a.text[a.text.length-f-1];)f++,t--,n--;return{a:t,b:n}}if(s.content.size||a.content.size){var c=Oo(s.content,a.content,t-1,n-1);if(c)return c}t-=l,n-=l}}var m=function(e,t){if(this.content=e,this.size=t||0,t==null)for(var n=0;n<e.length;n++)this.size+=e[n].nodeSize},ur={firstChild:{configurable:!0},lastChild:{configurable:!0},childCount:{configurable:!0}};m.prototype.nodesBetween=function(e,t,n,o,i){o===void 0&&(o=0);for(var s=0,a=0;a<t;s++){var l=this.content[s],f=a+l.nodeSize;if(f>e&&n(l,o+a,i,s)!==!1&&l.content.size){var u=a+1;l.nodesBetween(Math.max(0,e-u),Math.min(l.content.size,t-u),n,o+u)}a=f}};m.prototype.descendants=function(e){this.nodesBetween(0,this.size,e)};m.prototype.textBetween=function(e,t,n,o){var i="",s=!0;return this.nodesBetween(e,t,function(a,l){a.isText?(i+=a.text.slice(Math.max(e,l)-l,t-l),s=!n):a.isLeaf&&o?(i+=typeof o=="function"?o(a):o,s=!n):!s&&a.isBlock&&(i+=n,s=!0)},0),i};m.prototype.append=function(e){if(!e.size)return this;if(!this.size)return e;var t=this.lastChild,n=e.firstChild,o=this.content.slice(),i=0;for(t.isText&&t.sameMarkup(n)&&(o[o.length-1]=t.withText(t.text+n.text),i=1);i<e.content.length;i++)o.push(e.content[i]);return new m(o,this.size+e.size)};m.prototype.cut=function(e,t){if(t==null&&(t=this.size),e==0&&t==this.size)return this;var n=[],o=0;if(t>e)for(var i=0,s=0;s<t;i++){var a=this.content[i],l=s+a.nodeSize;l>e&&((s<e||l>t)&&(a.isText?a=a.cut(Math.max(0,e-s),Math.min(a.text.length,t-s)):a=a.cut(Math.max(0,e-s-1),Math.min(a.content.size,t-s-1))),n.push(a),o+=a.nodeSize),s=l}return new m(n,o)};m.prototype.cutByIndex=function(e,t){return e==t?m.empty:e==0&&t==this.content.length?this:new m(this.content.slice(e,t))};m.prototype.replaceChild=function(e,t){var n=this.content[e];if(n==t)return this;var o=this.content.slice(),i=this.size+t.nodeSize-n.nodeSize;return o[e]=t,new m(o,i)};m.prototype.addToStart=function(e){return new m([e].concat(this.content),this.size+e.nodeSize)};m.prototype.addToEnd=function(e){return new m(this.content.concat(e),this.size+e.nodeSize)};m.prototype.eq=function(e){if(this.content.length!=e.content.length)return!1;for(var t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0};ur.firstChild.get=function(){return this.content.length?this.content[0]:null};ur.lastChild.get=function(){return this.content.length?this.content[this.content.length-1]:null};ur.childCount.get=function(){return this.content.length};m.prototype.child=function(e){var t=this.content[e];if(!t)throw new RangeError("Index "+e+" out of range for "+this);return t};m.prototype.maybeChild=function(e){return this.content[e]};m.prototype.forEach=function(e){for(var t=0,n=0;t<this.content.length;t++){var o=this.content[t];e(o,n,t),n+=o.nodeSize}};m.prototype.findDiffStart=function(e,t){return t===void 0&&(t=0),xo(this,e,t)};m.prototype.findDiffEnd=function(e,t,n){return t===void 0&&(t=this.size),n===void 0&&(n=e.size),Oo(this,e,t,n)};m.prototype.findIndex=function(e,t){if(t===void 0&&(t=-1),e==0)return cr(0,e);if(e==this.size)return cr(this.content.length,e);if(e>this.size||e<0)throw new RangeError("Position "+e+" outside of fragment ("+this+")");for(var n=0,o=0;;n++){var i=this.child(n),s=o+i.nodeSize;if(s>=e)return s==e||t>0?cr(n+1,s):cr(n,o);o=s}};m.prototype.toString=function(){return"<"+this.toStringInner()+">"};m.prototype.toStringInner=function(){return this.content.join(", ")};m.prototype.toJSON=function(){return this.content.length?this.content.map(function(e){return e.toJSON()}):null};m.fromJSON=function(e,t){if(!t)return m.empty;if(!Array.isArray(t))throw new RangeError("Invalid input for Fragment.fromJSON");return new m(t.map(e.nodeFromJSON))};m.fromArray=function(e){if(!e.length)return m.empty;for(var t,n=0,o=0;o<e.length;o++){var i=e[o];n+=i.nodeSize,o&&i.isText&&e[o-1].sameMarkup(i)?(t||(t=e.slice(0,o)),t[t.length-1]=i.withText(t[t.length-1].text+i.text)):t&&t.push(i)}return new m(t||e,n)};m.from=function(e){if(!e)return m.empty;if(e instanceof m)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new m([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))};Object.defineProperties(m.prototype,ur);var an={index:0,offset:0};function cr(r,e){return an.index=r,an.offset=e,an}m.empty=new m([],0);function pr(r,e){if(r===e)return!0;if(!(r&&typeof r=="object")||!(e&&typeof e=="object"))return!1;var t=Array.isArray(r);if(Array.isArray(e)!=t)return!1;if(t){if(r.length!=e.length)return!1;for(var n=0;n<r.length;n++)if(!pr(r[n],e[n]))return!1}else{for(var o in r)if(!(o in e)||!pr(r[o],e[o]))return!1;for(var i in e)if(!(i in r))return!1}return!0}var w=function(e,t){this.type=e,this.attrs=t};w.prototype.addToSet=function(e){for(var t,n=!1,o=0;o<e.length;o++){var i=e[o];if(this.eq(i))return e;if(this.type.excludes(i.type))t||(t=e.slice(0,o));else{if(i.type.excludes(this.type))return e;!n&&i.type.rank>this.type.rank&&(t||(t=e.slice(0,o)),t.push(this),n=!0),t&&t.push(i)}}return t||(t=e.slice()),n||t.push(this),t};w.prototype.removeFromSet=function(e){for(var t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e};w.prototype.isInSet=function(e){for(var t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1};w.prototype.eq=function(e){return this==e||this.type==e.type&&pr(this.attrs,e.attrs)};w.prototype.toJSON=function(){var e={type:this.type.name};for(var t in this.attrs){e.attrs=this.attrs;break}return e};w.fromJSON=function(e,t){if(!t)throw new RangeError("Invalid input for Mark.fromJSON");var n=e.marks[t.type];if(!n)throw new RangeError("There is no mark type "+t.type+" in this schema");return n.create(t.attrs)};w.sameSet=function(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(var n=0;n<e.length;n++)if(!e[n].eq(t[n]))return!1;return!0};w.setFrom=function(e){if(!e||e.length==0)return w.none;if(e instanceof w)return[e];var t=e.slice();return t.sort(function(n,o){return n.type.rank-o.type.rank}),t};w.none=[];function ge(r){var e=Error.call(this,r);return e.__proto__=ge.prototype,e}ge.prototype=Object.create(Error.prototype);ge.prototype.constructor=ge;ge.prototype.name="ReplaceError";var k=function(e,t,n){this.content=e,this.openStart=t,this.openEnd=n},wo={size:{configurable:!0}};wo.size.get=function(){return this.content.size-this.openStart-this.openEnd};k.prototype.insertAt=function(e,t){var n=Do(this.content,e+this.openStart,t,null);return n&&new k(n,this.openStart,this.openEnd)};k.prototype.removeBetween=function(e,t){return new k(No(this.content,e+this.openStart,t+this.openStart),this.openStart,this.openEnd)};k.prototype.eq=function(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd};k.prototype.toString=function(){return this.content+"("+this.openStart+","+this.openEnd+")"};k.prototype.toJSON=function(){if(!this.content.size)return null;var e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e};k.fromJSON=function(e,t){if(!t)return k.empty;var n=t.openStart||0,o=t.openEnd||0;if(typeof n!="number"||typeof o!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new k(m.fromJSON(e,t.content),n,o)};k.maxOpen=function(e,t){t===void 0&&(t=!0);for(var n=0,o=0,i=e.firstChild;i&&!i.isLeaf&&(t||!i.type.spec.isolating);i=i.firstChild)n++;for(var s=e.lastChild;s&&!s.isLeaf&&(t||!s.type.spec.isolating);s=s.lastChild)o++;return new k(e,n,o)};Object.defineProperties(k.prototype,wo);function No(r,e,t){var n=r.findIndex(e),o=n.index,i=n.offset,s=r.maybeChild(o),a=r.findIndex(t),l=a.index,f=a.offset;if(i==e||s.isText){if(f!=t&&!r.child(l).isText)throw new RangeError("Removing non-flat range");return r.cut(0,e).append(r.cut(t))}if(o!=l)throw new RangeError("Removing non-flat range");return r.replaceChild(o,s.copy(No(s.content,e-i-1,t-i-1)))}function Do(r,e,t,n){var o=r.findIndex(e),i=o.index,s=o.offset,a=r.maybeChild(i);if(s==e||a.isText)return n&&!n.canReplace(i,i,t)?null:r.cut(0,e).append(t).append(r.cut(e));var l=Do(a.content,e-s-1,t);return l&&r.replaceChild(i,a.copy(l))}k.empty=new k(m.empty,0,0);function Ia(r,e,t){if(t.openStart>r.depth)throw new ge("Inserted content deeper than insertion position");if(r.depth-t.openStart!=e.depth-t.openEnd)throw new ge("Inconsistent open depths");return To(r,e,t,0)}function To(r,e,t,n){var o=r.index(n),i=r.node(n);if(o==e.index(n)&&n<r.depth-t.openStart){var s=To(r,e,t,n+1);return i.copy(i.content.replaceChild(o,s))}else if(t.content.size)if(!t.openStart&&!t.openEnd&&r.depth==n&&e.depth==n){var a=r.parent,l=a.content;return et(a,l.cut(0,r.parentOffset).append(t.content).append(l.cut(e.parentOffset)))}else{var f=Aa(t,r),u=f.start,c=f.end;return et(i,Io(r,u,c,e,n))}else return et(i,hr(r,e,n))}function Eo(r,e){if(!e.type.compatibleContent(r.type))throw new ge("Cannot join "+e.type.name+" onto "+r.type.name)}function ln(r,e,t){var n=r.node(t);return Eo(n,e.node(t)),n}function $e(r,e){var t=e.length-1;t>=0&&r.isText&&r.sameMarkup(e[t])?e[t]=r.withText(e[t].text+r.text):e.push(r)}function Rt(r,e,t,n){var o=(e||r).node(t),i=0,s=e?e.index(t):o.childCount;r&&(i=r.index(t),r.depth>t?i++:r.textOffset&&($e(r.nodeAfter,n),i++));for(var a=i;a<s;a++)$e(o.child(a),n);e&&e.depth==t&&e.textOffset&&$e(e.nodeBefore,n)}function et(r,e){if(!r.type.validContent(e))throw new ge("Invalid content for node "+r.type.name);return r.copy(e)}function Io(r,e,t,n,o){var i=r.depth>o&&ln(r,e,o+1),s=n.depth>o&&ln(t,n,o+1),a=[];return Rt(null,r,o,a),i&&s&&e.index(o)==t.index(o)?(Eo(i,s),$e(et(i,Io(r,e,t,n,o+1)),a)):(i&&$e(et(i,hr(r,e,o+1)),a),Rt(e,t,o,a),s&&$e(et(s,hr(t,n,o+1)),a)),Rt(n,null,o,a),new m(a)}function hr(r,e,t){var n=[];if(Rt(null,r,t,n),r.depth>t){var o=ln(r,e,t+1);$e(et(o,hr(r,e,t+1)),n)}return Rt(e,null,t,n),new m(n)}function Aa(r,e){for(var t=e.depth-r.openStart,n=e.node(t),o=n.copy(r.content),i=t-1;i>=0;i--)o=e.node(i).copy(m.from(o));return{start:o.resolveNoCache(r.openStart+t),end:o.resolveNoCache(o.content.size-r.openEnd-t)}}var z=function(e,t,n){this.pos=e,this.path=t,this.depth=t.length/3-1,this.parentOffset=n},ht={parent:{configurable:!0},doc:{configurable:!0},textOffset:{configurable:!0},nodeAfter:{configurable:!0},nodeBefore:{configurable:!0}};z.prototype.resolveDepth=function(e){return e==null?this.depth:e<0?this.depth+e:e};ht.parent.get=function(){return this.node(this.depth)};ht.doc.get=function(){return this.node(0)};z.prototype.node=function(e){return this.path[this.resolveDepth(e)*3]};z.prototype.index=function(e){return this.path[this.resolveDepth(e)*3+1]};z.prototype.indexAfter=function(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)};z.prototype.start=function(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1};z.prototype.end=function(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size};z.prototype.before=function(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]};z.prototype.after=function(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize};ht.textOffset.get=function(){return this.pos-this.path[this.path.length-1]};ht.nodeAfter.get=function(){var r=this.parent,e=this.index(this.depth);if(e==r.childCount)return null;var t=this.pos-this.path[this.path.length-1],n=r.child(e);return t?r.child(e).cut(t):n};ht.nodeBefore.get=function(){var r=this.index(this.depth),e=this.pos-this.path[this.path.length-1];return e?this.parent.child(r).cut(0,e):r==0?null:this.parent.child(r-1)};z.prototype.posAtIndex=function(e,t){t=this.resolveDepth(t);for(var n=this.path[t*3],o=t==0?0:this.path[t*3-1]+1,i=0;i<e;i++)o+=n.child(i).nodeSize;return o};z.prototype.marks=function(){var e=this.parent,t=this.index();if(e.content.size==0)return w.none;if(this.textOffset)return e.child(t).marks;var n=e.maybeChild(t-1),o=e.maybeChild(t);if(!n){var i=n;n=o,o=i}for(var s=n.marks,a=0;a<s.length;a++)s[a].type.spec.inclusive===!1&&(!o||!s[a].isInSet(o.marks))&&(s=s[a--].removeFromSet(s));return s};z.prototype.marksAcross=function(e){var t=this.parent.maybeChild(this.index());if(!t||!t.isInline)return null;for(var n=t.marks,o=e.parent.maybeChild(e.index()),i=0;i<n.length;i++)n[i].type.spec.inclusive===!1&&(!o||!n[i].isInSet(o.marks))&&(n=n[i--].removeFromSet(n));return n};z.prototype.sharedDepth=function(e){for(var t=this.depth;t>0;t--)if(this.start(t)<=e&&this.end(t)>=e)return t;return 0};z.prototype.blockRange=function(e,t){if(e===void 0&&(e=this),e.pos<this.pos)return e.blockRange(this);for(var n=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);n>=0;n--)if(e.pos<=this.end(n)&&(!t||t(this.node(n))))return new tt(this,e,n)};z.prototype.sameParent=function(e){return this.pos-this.parentOffset==e.pos-e.parentOffset};z.prototype.max=function(e){return e.pos>this.pos?e:this};z.prototype.min=function(e){return e.pos<this.pos?e:this};z.prototype.toString=function(){for(var e="",t=1;t<=this.depth;t++)e+=(e?"/":"")+this.node(t).type.name+"_"+this.index(t-1);return e+":"+this.parentOffset};z.resolve=function(e,t){if(!(t>=0&&t<=e.content.size))throw new RangeError("Position "+t+" out of range");for(var n=[],o=0,i=t,s=e;;){var a=s.content.findIndex(i),l=a.index,f=a.offset,u=i-f;if(n.push(s,l,o+f),!u||(s=s.child(l),s.isText))break;i=u-1,o+=f+1}return new z(t,n,i)};z.resolveCached=function(e,t){for(var n=0;n<fn.length;n++){var o=fn[n];if(o.pos==t&&o.doc==e)return o}var i=fn[un]=z.resolve(e,t);return un=(un+1)%Ra,i};Object.defineProperties(z.prototype,ht);var fn=[],un=0,Ra=12,tt=function(e,t,n){this.$from=e,this.$to=t,this.depth=n},dt={start:{configurable:!0},end:{configurable:!0},parent:{configurable:!0},startIndex:{configurable:!0},endIndex:{configurable:!0}};dt.start.get=function(){return this.$from.before(this.depth+1)};dt.end.get=function(){return this.$to.after(this.depth+1)};dt.parent.get=function(){return this.$from.node(this.depth)};dt.startIndex.get=function(){return this.$from.index(this.depth)};dt.endIndex.get=function(){return this.$to.indexAfter(this.depth)};Object.defineProperties(tt.prototype,dt);var Pa=Object.create(null),D=function(e,t,n,o){this.type=e,this.attrs=t,this.content=n||m.empty,this.marks=o||w.none},de={nodeSize:{configurable:!0},childCount:{configurable:!0},textContent:{configurable:!0},firstChild:{configurable:!0},lastChild:{configurable:!0},isBlock:{configurable:!0},isTextblock:{configurable:!0},inlineContent:{configurable:!0},isInline:{configurable:!0},isText:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0}};de.nodeSize.get=function(){return this.isLeaf?1:2+this.content.size};de.childCount.get=function(){return this.content.childCount};D.prototype.child=function(e){return this.content.child(e)};D.prototype.maybeChild=function(e){return this.content.maybeChild(e)};D.prototype.forEach=function(e){this.content.forEach(e)};D.prototype.nodesBetween=function(e,t,n,o){o===void 0&&(o=0),this.content.nodesBetween(e,t,n,o,this)};D.prototype.descendants=function(e){this.nodesBetween(0,this.content.size,e)};de.textContent.get=function(){return this.textBetween(0,this.content.size,"")};D.prototype.textBetween=function(e,t,n,o){return this.content.textBetween(e,t,n,o)};de.firstChild.get=function(){return this.content.firstChild};de.lastChild.get=function(){return this.content.lastChild};D.prototype.eq=function(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)};D.prototype.sameMarkup=function(e){return this.hasMarkup(e.type,e.attrs,e.marks)};D.prototype.hasMarkup=function(e,t,n){return this.type==e&&pr(this.attrs,t||e.defaultAttrs||Pa)&&w.sameSet(this.marks,n||w.none)};D.prototype.copy=function(e){return e===void 0&&(e=null),e==this.content?this:new this.constructor(this.type,this.attrs,e,this.marks)};D.prototype.mark=function(e){return e==this.marks?this:new this.constructor(this.type,this.attrs,this.content,e)};D.prototype.cut=function(e,t){return e==0&&t==this.content.size?this:this.copy(this.content.cut(e,t))};D.prototype.slice=function(e,t,n){if(t===void 0&&(t=this.content.size),n===void 0&&(n=!1),e==t)return k.empty;var o=this.resolve(e),i=this.resolve(t),s=n?0:o.sharedDepth(t),a=o.start(s),l=o.node(s),f=l.content.cut(o.pos-a,i.pos-a);return new k(f,o.depth-s,i.depth-s)};D.prototype.replace=function(e,t,n){return Ia(this.resolve(e),this.resolve(t),n)};D.prototype.nodeAt=function(e){for(var t=this;;){var n=t.content.findIndex(e),o=n.index,i=n.offset;if(t=t.maybeChild(o),!t)return null;if(i==e||t.isText)return t;e-=i+1}};D.prototype.childAfter=function(e){var t=this.content.findIndex(e),n=t.index,o=t.offset;return{node:this.content.maybeChild(n),index:n,offset:o}};D.prototype.childBefore=function(e){if(e==0)return{node:null,index:0,offset:0};var t=this.content.findIndex(e),n=t.index,o=t.offset;if(o<e)return{node:this.content.child(n),index:n,offset:o};var i=this.content.child(n-1);return{node:i,index:n-1,offset:o-i.nodeSize}};D.prototype.resolve=function(e){return z.resolveCached(this,e)};D.prototype.resolveNoCache=function(e){return z.resolve(this,e)};D.prototype.rangeHasMark=function(e,t,n){var o=!1;return t>e&&this.nodesBetween(e,t,function(i){return n.isInSet(i.marks)&&(o=!0),!o}),o};de.isBlock.get=function(){return this.type.isBlock};de.isTextblock.get=function(){return this.type.isTextblock};de.inlineContent.get=function(){return this.type.inlineContent};de.isInline.get=function(){return this.type.isInline};de.isText.get=function(){return this.type.isText};de.isLeaf.get=function(){return this.type.isLeaf};de.isAtom.get=function(){return this.type.isAtom};D.prototype.toString=function(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);var e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),Ao(this.marks,e)};D.prototype.contentMatchAt=function(e){var t=this.type.contentMatch.matchFragment(this.content,0,e);if(!t)throw new Error("Called contentMatchAt on a node with invalid content");return t};D.prototype.canReplace=function(e,t,n,o,i){n===void 0&&(n=m.empty),o===void 0&&(o=0),i===void 0&&(i=n.childCount);var s=this.contentMatchAt(e).matchFragment(n,o,i),a=s&&s.matchFragment(this.content,t);if(!a||!a.validEnd)return!1;for(var l=o;l<i;l++)if(!this.type.allowsMarks(n.child(l).marks))return!1;return!0};D.prototype.canReplaceWith=function(e,t,n,o){if(o&&!this.type.allowsMarks(o))return!1;var i=this.contentMatchAt(e).matchType(n),s=i&&i.matchFragment(this.content,t);return s?s.validEnd:!1};D.prototype.canAppend=function(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)};D.prototype.check=function(){if(!this.type.validContent(this.content))throw new RangeError("Invalid content for node "+this.type.name+": "+this.content.toString().slice(0,50));for(var e=w.none,t=0;t<this.marks.length;t++)e=this.marks[t].addToSet(e);if(!w.sameSet(e,this.marks))throw new RangeError("Invalid collection of marks for node "+this.type.name+": "+this.marks.map(function(n){return n.type.name}));this.content.forEach(function(n){return n.check()})};D.prototype.toJSON=function(){var e={type:this.type.name};for(var t in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(function(n){return n.toJSON()})),e};D.fromJSON=function(e,t){if(!t)throw new RangeError("Invalid input for Node.fromJSON");var n=null;if(t.marks){if(!Array.isArray(t.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=t.marks.map(e.markFromJSON)}if(t.type=="text"){if(typeof t.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(t.text,n)}var o=m.fromJSON(e,t.content);return e.nodeType(t.type).create(t.attrs,o,n)};Object.defineProperties(D.prototype,de);var za=function(r){function e(n,o,i,s){if(r.call(this,n,o,null,s),!i)throw new RangeError("Empty text nodes are not allowed");this.text=i}r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e;var t={textContent:{configurable:!0},nodeSize:{configurable:!0}};return e.prototype.toString=function(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):Ao(this.marks,JSON.stringify(this.text))},t.textContent.get=function(){return this.text},e.prototype.textBetween=function(o,i){return this.text.slice(o,i)},t.nodeSize.get=function(){return this.text.length},e.prototype.mark=function(o){return o==this.marks?this:new e(this.type,this.attrs,this.text,o)},e.prototype.withText=function(o){return o==this.text?this:new e(this.type,this.attrs,o,this.marks)},e.prototype.cut=function(o,i){return o===void 0&&(o=0),i===void 0&&(i=this.text.length),o==0&&i==this.text.length?this:this.withText(this.text.slice(o,i))},e.prototype.eq=function(o){return this.sameMarkup(o)&&this.text==o.text},e.prototype.toJSON=function(){var o=r.prototype.toJSON.call(this);return o.text=this.text,o},Object.defineProperties(e.prototype,t),e}(D);function Ao(r,e){for(var t=r.length-1;t>=0;t--)e=r[t].type.name+"("+e+")";return e}var U=function(e){this.validEnd=e,this.next=[],this.wrapCache=[]},dr={inlineContent:{configurable:!0},defaultType:{configurable:!0},edgeCount:{configurable:!0}};U.parse=function(e,t){var n=new mr(e,t);if(n.next==null)return U.empty;var o=Po(n);n.next&&n.err("Unexpected trailing text");var i=Ja(La(o));return Wa(i,n),i};U.prototype.matchType=function(e){for(var t=0;t<this.next.length;t+=2)if(this.next[t]==e)return this.next[t+1];return null};U.prototype.matchFragment=function(e,t,n){t===void 0&&(t=0),n===void 0&&(n=e.childCount);for(var o=this,i=t;o&&i<n;i++)o=o.matchType(e.child(i).type);return o};dr.inlineContent.get=function(){var r=this.next[0];return r?r.isInline:!1};dr.defaultType.get=function(){for(var r=0;r<this.next.length;r+=2){var e=this.next[r];if(!(e.isText||e.hasRequiredAttrs()))return e}};U.prototype.compatible=function(e){for(var t=0;t<this.next.length;t+=2)for(var n=0;n<e.next.length;n+=2)if(this.next[t]==e.next[n])return!0;return!1};U.prototype.fillBefore=function(e,t,n){t===void 0&&(t=!1),n===void 0&&(n=0);var o=[this];function i(s,a){var l=s.matchFragment(e,n);if(l&&(!t||l.validEnd))return m.from(a.map(function(h){return h.createAndFill()}));for(var f=0;f<s.next.length;f+=2){var u=s.next[f],c=s.next[f+1];if(!(u.isText||u.hasRequiredAttrs())&&o.indexOf(c)==-1){o.push(c);var p=i(c,a.concat(u));if(p)return p}}}return i(this,[])};U.prototype.findWrapping=function(e){for(var t=0;t<this.wrapCache.length;t+=2)if(this.wrapCache[t]==e)return this.wrapCache[t+1];var n=this.computeWrapping(e);return this.wrapCache.push(e,n),n};U.prototype.computeWrapping=function(e){for(var t=Object.create(null),n=[{match:this,type:null,via:null}];n.length;){var o=n.shift(),i=o.match;if(i.matchType(e)){for(var s=[],a=o;a.type;a=a.via)s.push(a.type);return s.reverse()}for(var l=0;l<i.next.length;l+=2){var f=i.next[l];!f.isLeaf&&!f.hasRequiredAttrs()&&!(f.name in t)&&(!o.type||i.next[l+1].validEnd)&&(n.push({match:f.contentMatch,type:f,via:o}),t[f.name]=!0)}}};dr.edgeCount.get=function(){return this.next.length>>1};U.prototype.edge=function(e){var t=e<<1;if(t>=this.next.length)throw new RangeError("There's no "+e+"th edge in this content match");return{type:this.next[t],next:this.next[t+1]}};U.prototype.toString=function(){var e=[];function t(n){e.push(n);for(var o=1;o<n.next.length;o+=2)e.indexOf(n.next[o])==-1&&t(n.next[o])}return t(this),e.map(function(n,o){for(var i=o+(n.validEnd?"*":" ")+" ",s=0;s<n.next.length;s+=2)i+=(s?", ":"")+n.next[s].name+"->"+e.indexOf(n.next[s+1]);return i}).join(`
`)};Object.defineProperties(U.prototype,dr);U.empty=new U(!0);var mr=function(e,t){this.string=e,this.nodeTypes=t,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()},Ro={next:{configurable:!0}};Ro.next.get=function(){return this.tokens[this.pos]};mr.prototype.eat=function(e){return this.next==e&&(this.pos++||!0)};mr.prototype.err=function(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")};Object.defineProperties(mr.prototype,Ro);function Po(r){var e=[];do e.push(Fa(r));while(r.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function Fa(r){var e=[];do e.push(Ba(r));while(r.next&&r.next!=")"&&r.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function Ba(r){for(var e=qa(r);;)if(r.eat("+"))e={type:"plus",expr:e};else if(r.eat("*"))e={type:"star",expr:e};else if(r.eat("?"))e={type:"opt",expr:e};else if(r.eat("{"))e=_a(r,e);else break;return e}function zo(r){/\D/.test(r.next)&&r.err("Expected number, got '"+r.next+"'");var e=Number(r.next);return r.pos++,e}function _a(r,e){var t=zo(r),n=t;return r.eat(",")&&(r.next!="}"?n=zo(r):n=-1),r.eat("}")||r.err("Unclosed braced range"),{type:"range",min:t,max:n,expr:e}}function Va(r,e){var t=r.nodeTypes,n=t[e];if(n)return[n];var o=[];for(var i in t){var s=t[i];s.groups.indexOf(e)>-1&&o.push(s)}return o.length==0&&r.err("No node type or group '"+e+"' found"),o}function qa(r){if(r.eat("(")){var e=Po(r);return r.eat(")")||r.err("Missing closing paren"),e}else if(/\W/.test(r.next))r.err("Unexpected token '"+r.next+"'");else{var t=Va(r,r.next).map(function(n){return r.inline==null?r.inline=n.isInline:r.inline!=n.isInline&&r.err("Mixing inline and block content"),{type:"name",value:n}});return r.pos++,t.length==1?t[0]:{type:"choice",exprs:t}}}function La(r){var e=[[]];return o(i(r,0),t()),e;function t(){return e.push([])-1}function n(s,a,l){var f={term:l,to:a};return e[s].push(f),f}function o(s,a){s.forEach(function(l){return l.to=a})}function i(s,a){if(s.type=="choice")return s.exprs.reduce(function(S,y){return S.concat(i(y,a))},[]);if(s.type=="seq")for(var l=0;;l++){var f=i(s.exprs[l],a);if(l==s.exprs.length-1)return f;o(f,a=t())}else if(s.type=="star"){var u=t();return n(a,u),o(i(s.expr,u),u),[n(u)]}else if(s.type=="plus"){var c=t();return o(i(s.expr,a),c),o(i(s.expr,c),c),[n(c)]}else{if(s.type=="opt")return[n(a)].concat(i(s.expr,a));if(s.type=="range"){for(var p=a,h=0;h<s.min;h++){var d=t();o(i(s.expr,p),d),p=d}if(s.max==-1)o(i(s.expr,p),p);else for(var v=s.min;v<s.max;v++){var b=t();n(p,b),o(i(s.expr,p),b),p=b}return[n(p)]}else if(s.type=="name")return[n(a,null,s.value)]}}}function Fo(r,e){return e-r}function Bo(r,e){var t=[];return n(e),t.sort(Fo);function n(o){var i=r[o];if(i.length==1&&!i[0].term)return n(i[0].to);t.push(o);for(var s=0;s<i.length;s++){var a=i[s],l=a.term,f=a.to;!l&&t.indexOf(f)==-1&&n(f)}}}function Ja(r){var e=Object.create(null);return t(Bo(r,0));function t(n){var o=[];n.forEach(function(l){r[l].forEach(function(f){var u=f.term,c=f.to;if(!!u){var p=o.indexOf(u),h=p>-1&&o[p+1];Bo(r,c).forEach(function(d){h||o.push(u,h=[]),h.indexOf(d)==-1&&h.push(d)})}})});for(var i=e[n.join(",")]=new U(n.indexOf(r.length-1)>-1),s=0;s<o.length;s+=2){var a=o[s+1].sort(Fo);i.next.push(o[s],e[a.join(",")]||t(a))}return i}}function Wa(r,e){for(var t=0,n=[r];t<n.length;t++){for(var o=n[t],i=!o.validEnd,s=[],a=0;a<o.next.length;a+=2){var l=o.next[a],f=o.next[a+1];s.push(l.name),i&&!(l.isText||l.hasRequiredAttrs())&&(i=!1),n.indexOf(f)==-1&&n.push(f)}i&&e.err("Only non-generatable nodes ("+s.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function _o(r){var e=Object.create(null);for(var t in r){var n=r[t];if(!n.hasDefault)return null;e[t]=n.default}return e}function Vo(r,e){var t=Object.create(null);for(var n in r){var o=e&&e[n];if(o===void 0){var i=r[n];if(i.hasDefault)o=i.default;else throw new RangeError("No value supplied for attribute "+n)}t[n]=o}return t}function qo(r){var e=Object.create(null);if(r)for(var t in r)e[t]=new Lo(r[t]);return e}var re=function(e,t,n){this.name=e,this.schema=t,this.spec=n,this.groups=n.group?n.group.split(" "):[],this.attrs=qo(n.attrs),this.defaultAttrs=_o(this.attrs),this.contentMatch=null,this.markSet=null,this.inlineContent=null,this.isBlock=!(n.inline||e=="text"),this.isText=e=="text"},mt={isInline:{configurable:!0},isTextblock:{configurable:!0},isLeaf:{configurable:!0},isAtom:{configurable:!0},whitespace:{configurable:!0}};mt.isInline.get=function(){return!this.isBlock};mt.isTextblock.get=function(){return this.isBlock&&this.inlineContent};mt.isLeaf.get=function(){return this.contentMatch==U.empty};mt.isAtom.get=function(){return this.isLeaf||this.spec.atom};mt.whitespace.get=function(){return this.spec.whitespace||(this.spec.code?"pre":"normal")};re.prototype.hasRequiredAttrs=function(){for(var e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1};re.prototype.compatibleContent=function(e){return this==e||this.contentMatch.compatible(e.contentMatch)};re.prototype.computeAttrs=function(e){return!e&&this.defaultAttrs?this.defaultAttrs:Vo(this.attrs,e)};re.prototype.create=function(e,t,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new D(this,this.computeAttrs(e),m.from(t),w.setFrom(n))};re.prototype.createChecked=function(e,t,n){if(t=m.from(t),!this.validContent(t))throw new RangeError("Invalid content for node "+this.name);return new D(this,this.computeAttrs(e),t,w.setFrom(n))};re.prototype.createAndFill=function(e,t,n){if(e=this.computeAttrs(e),t=m.from(t),t.size){var o=this.contentMatch.fillBefore(t);if(!o)return null;t=o.append(t)}var i=this.contentMatch.matchFragment(t).fillBefore(m.empty,!0);return i?new D(this,e,t.append(i),w.setFrom(n)):null};re.prototype.validContent=function(e){var t=this.contentMatch.matchFragment(e);if(!t||!t.validEnd)return!1;for(var n=0;n<e.childCount;n++)if(!this.allowsMarks(e.child(n).marks))return!1;return!0};re.prototype.allowsMarkType=function(e){return this.markSet==null||this.markSet.indexOf(e)>-1};re.prototype.allowsMarks=function(e){if(this.markSet==null)return!0;for(var t=0;t<e.length;t++)if(!this.allowsMarkType(e[t].type))return!1;return!0};re.prototype.allowedMarks=function(e){if(this.markSet==null)return e;for(var t,n=0;n<e.length;n++)this.allowsMarkType(e[n].type)?t&&t.push(e[n]):t||(t=e.slice(0,n));return t?t.length?t:w.empty:e};re.compile=function(e,t){var n=Object.create(null);e.forEach(function(s,a){return n[s]=new re(s,t,a)});var o=t.spec.topNode||"doc";if(!n[o])throw new RangeError("Schema is missing its top node type ('"+o+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(var i in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n};Object.defineProperties(re.prototype,mt);var Lo=function(e){this.hasDefault=Object.prototype.hasOwnProperty.call(e,"default"),this.default=e.default},Jo={isRequired:{configurable:!0}};Jo.isRequired.get=function(){return!this.hasDefault};Object.defineProperties(Lo.prototype,Jo);var Te=function(e,t,n,o){this.name=e,this.schema=n,this.spec=o,this.attrs=qo(o.attrs),this.rank=t,this.excluded=null;var i=_o(this.attrs);this.instance=i&&new w(this,i)};Te.prototype.create=function(e){return!e&&this.instance?this.instance:new w(this,Vo(this.attrs,e))};Te.compile=function(e,t){var n=Object.create(null),o=0;return e.forEach(function(i,s){return n[i]=new Te(i,o++,t,s)}),n};Te.prototype.removeFromSet=function(e){for(var t=0;t<e.length;t++)e[t].type==this&&(e=e.slice(0,t).concat(e.slice(t+1)),t--);return e};Te.prototype.isInSet=function(e){for(var t=0;t<e.length;t++)if(e[t].type==this)return e[t]};Te.prototype.excludes=function(e){return this.excluded.indexOf(e)>-1};var Oe=function(e){this.spec={};for(var t in e)this.spec[t]=e[t];this.spec.nodes=sn.from(e.nodes),this.spec.marks=sn.from(e.marks),this.nodes=re.compile(this.spec.nodes,this),this.marks=Te.compile(this.spec.marks,this);var n=Object.create(null);for(var o in this.nodes){if(o in this.marks)throw new RangeError(o+" can not be both a node and a mark");var i=this.nodes[o],s=i.spec.content||"",a=i.spec.marks;i.contentMatch=n[s]||(n[s]=U.parse(s,this.nodes)),i.inlineContent=i.contentMatch.inlineContent,i.markSet=a=="_"?null:a?Wo(this,a.split(" ")):a==""||!i.inlineContent?[]:null}for(var l in this.marks){var f=this.marks[l],u=f.spec.excludes;f.excluded=u==null?[f]:u==""?[]:Wo(this,u.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached=Object.create(null),this.cached.wrappings=Object.create(null)};Oe.prototype.node=function(e,t,n,o){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof re){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(t,n,o)};Oe.prototype.text=function(e,t){var n=this.nodes.text;return new za(n,n.defaultAttrs,e,w.setFrom(t))};Oe.prototype.mark=function(e,t){return typeof e=="string"&&(e=this.marks[e]),e.create(t)};Oe.prototype.nodeFromJSON=function(e){return D.fromJSON(this,e)};Oe.prototype.markFromJSON=function(e){return w.fromJSON(this,e)};Oe.prototype.nodeType=function(e){var t=this.nodes[e];if(!t)throw new RangeError("Unknown node type: "+e);return t};function Wo(r,e){for(var t=[],n=0;n<e.length;n++){var o=e[n],i=r.marks[o],s=i;if(i)t.push(i);else for(var a in r.marks){var l=r.marks[a];(o=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(o)>-1)&&t.push(s=l)}if(!s)throw new SyntaxError("Unknown mark type: '"+e[n]+"'")}return t}var se=function(e,t){var n=this;this.schema=e,this.rules=t,this.tags=[],this.styles=[],t.forEach(function(o){o.tag?n.tags.push(o):o.style&&n.styles.push(o)}),this.normalizeLists=!this.tags.some(function(o){if(!/^(ul|ol)\b/.test(o.tag)||!o.node)return!1;var i=e.nodes[o.node];return i.contentMatch.matchType(i)})};se.prototype.parse=function(e,t){t===void 0&&(t={});var n=new R(this,t,!1);return n.addAll(e,null,t.from,t.to),n.finish()};se.prototype.parseSlice=function(e,t){t===void 0&&(t={});var n=new R(this,t,!0);return n.addAll(e,null,t.from,t.to),k.maxOpen(n.finish())};se.prototype.matchTag=function(e,t,n){for(var o=n?this.tags.indexOf(n)+1:0;o<this.tags.length;o++){var i=this.tags[o];if(Ua(e,i.tag)&&(i.namespace===void 0||e.namespaceURI==i.namespace)&&(!i.context||t.matchesContext(i.context))){if(i.getAttrs){var s=i.getAttrs(e);if(s===!1)continue;i.attrs=s}return i}}};se.prototype.matchStyle=function(e,t,n,o){for(var i=o?this.styles.indexOf(o)+1:0;i<this.styles.length;i++){var s=this.styles[i];if(!(s.style.indexOf(e)!=0||s.context&&!n.matchesContext(s.context)||s.style.length>e.length&&(s.style.charCodeAt(e.length)!=61||s.style.slice(e.length+1)!=t))){if(s.getAttrs){var a=s.getAttrs(t);if(a===!1)continue;s.attrs=a}return s}}};se.schemaRules=function(e){var t=[];function n(l){for(var f=l.priority==null?50:l.priority,u=0;u<t.length;u++){var c=t[u],p=c.priority==null?50:c.priority;if(p<f)break}t.splice(u,0,l)}var o=function(l){var f=e.marks[l].spec.parseDOM;f&&f.forEach(function(u){n(u=Uo(u)),u.mark=l})};for(var i in e.marks)o(i);var s=function(l){var f=e.nodes[a].spec.parseDOM;f&&f.forEach(function(u){n(u=Uo(u)),u.node=a})};for(var a in e.nodes)s();return t};se.fromSchema=function(e){return e.cached.domParser||(e.cached.domParser=new se(e,se.schemaRules(e)))};var cn={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},Ha={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},Ho={ol:!0,ul:!0},vr=1,gr=2,Pt=4;function Ko(r,e,t){return e!=null?(e?vr:0)|(e==="full"?gr:0):r&&r.whitespace=="pre"?vr|gr:t&~Pt}var ze=function(e,t,n,o,i,s,a){this.type=e,this.attrs=t,this.solid=i,this.match=s||(a&Pt?null:e.contentMatch),this.options=a,this.content=[],this.marks=n,this.activeMarks=w.none,this.pendingMarks=o,this.stashMarks=[]};ze.prototype.findWrapping=function(e){if(!this.match){if(!this.type)return[];var t=this.type.contentMatch.fillBefore(m.from(e));if(t)this.match=this.type.contentMatch.matchFragment(t);else{var n=this.type.contentMatch,o;return(o=n.findWrapping(e.type))?(this.match=n,o):null}}return this.match.findWrapping(e.type)};ze.prototype.finish=function(e){if(!(this.options&vr)){var t=this.content[this.content.length-1],n;t&&t.isText&&(n=/[ \t\r\n\u000c]+$/.exec(t.text))&&(t.text.length==n[0].length?this.content.pop():this.content[this.content.length-1]=t.withText(t.text.slice(0,t.text.length-n[0].length)))}var o=m.from(this.content);return!e&&this.match&&(o=o.append(this.match.fillBefore(m.empty,!0))),this.type?this.type.create(this.attrs,o,this.marks):o};ze.prototype.popFromStashMark=function(e){for(var t=this.stashMarks.length-1;t>=0;t--)if(e.eq(this.stashMarks[t]))return this.stashMarks.splice(t,1)[0]};ze.prototype.applyPending=function(e){for(var t=0,n=this.pendingMarks;t<n.length;t++){var o=n[t];(this.type?this.type.allowsMarkType(o.type):ja(o.type,e))&&!o.isInSet(this.activeMarks)&&(this.activeMarks=o.addToSet(this.activeMarks),this.pendingMarks=o.removeFromSet(this.pendingMarks))}};ze.prototype.inlineContext=function(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!cn.hasOwnProperty(e.parentNode.nodeName.toLowerCase())};var R=function(e,t,n){this.parser=e,this.options=t,this.isOpen=n;var o=t.topNode,i,s=Ko(null,t.preserveWhitespace,0)|(n?Pt:0);o?i=new ze(o.type,o.attrs,w.none,w.none,!0,t.topMatch||o.type.contentMatch,s):n?i=new ze(null,null,w.none,w.none,!0,null,s):i=new ze(e.schema.topNodeType,null,w.none,w.none,!0,null,s),this.nodes=[i],this.open=0,this.find=t.findPositions,this.needsBlock=!1},pn={top:{configurable:!0},currentPos:{configurable:!0}};pn.top.get=function(){return this.nodes[this.open]};R.prototype.addDOM=function(e){if(e.nodeType==3)this.addTextNode(e);else if(e.nodeType==1){var t=e.getAttribute("style"),n=t?this.readStyles(Ga(t)):null,o=this.top;if(n!=null)for(var i=0;i<n.length;i++)this.addPendingMark(n[i]);if(this.addElement(e),n!=null)for(var s=0;s<n.length;s++)this.removePendingMark(n[s],o)}};R.prototype.addTextNode=function(e){var t=e.nodeValue,n=this.top;if(n.options&gr||n.inlineContext(e)||/[^ \t\r\n\u000c]/.test(t)){if(n.options&vr)n.options&gr?t=t.replace(/\r\n?/g,`
`):t=t.replace(/\r?\n|\r/g," ");else if(t=t.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(t)&&this.open==this.nodes.length-1){var o=n.content[n.content.length-1],i=e.previousSibling;(!o||i&&i.nodeName=="BR"||o.isText&&/[ \t\r\n\u000c]$/.test(o.text))&&(t=t.slice(1))}t&&this.insertNode(this.parser.schema.text(t)),this.findInText(e)}else this.findInside(e)};R.prototype.addElement=function(e,t){var n=e.nodeName.toLowerCase(),o;Ho.hasOwnProperty(n)&&this.parser.normalizeLists&&Ka(e);var i=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(o=this.parser.matchTag(e,this,t));if(i?i.ignore:Ha.hasOwnProperty(n))this.findInside(e),this.ignoreFallback(e);else if(!i||i.skip||i.closeParent){i&&i.closeParent?this.open=Math.max(0,this.open-1):i&&i.skip.nodeType&&(e=i.skip);var s,a=this.top,l=this.needsBlock;if(cn.hasOwnProperty(n))s=!0,a.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e);return}this.addAll(e),s&&this.sync(a),this.needsBlock=l}else this.addElementByRule(e,i,i.consuming===!1?o:null)};R.prototype.leafFallback=function(e){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`))};R.prototype.ignoreFallback=function(e){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"))};R.prototype.readStyles=function(e){var t=w.none;e:for(var n=0;n<e.length;n+=2)for(var o=null;;){var i=this.parser.matchStyle(e[n],e[n+1],this,o);if(!i)continue e;if(i.ignore)return null;if(t=this.parser.schema.marks[i.mark].create(i.attrs).addToSet(t),i.consuming===!1)o=i;else break}return t};R.prototype.addElementByRule=function(e,t,n){var o=this,i,s,a,l;t.node?(s=this.parser.schema.nodes[t.node],s.isLeaf?this.insertNode(s.create(t.attrs))||this.leafFallback(e):i=this.enter(s,t.attrs,t.preserveWhitespace)):(a=this.parser.schema.marks[t.mark],l=a.create(t.attrs),this.addPendingMark(l));var f=this.top;if(s&&s.isLeaf)this.findInside(e);else if(n)this.addElement(e,n);else if(t.getContent)this.findInside(e),t.getContent(e,this.parser.schema).forEach(function(c){return o.insertNode(c)});else{var u=t.contentElement;typeof u=="string"?u=e.querySelector(u):typeof u=="function"&&(u=u(e)),u||(u=e),this.findAround(e,u,!0),this.addAll(u,i)}i&&(this.sync(f),this.open--),l&&this.removePendingMark(l,f)};R.prototype.addAll=function(e,t,n,o){for(var i=n||0,s=n?e.childNodes[n]:e.firstChild,a=o==null?null:e.childNodes[o];s!=a;s=s.nextSibling,++i)this.findAtPoint(e,i),this.addDOM(s),t&&cn.hasOwnProperty(s.nodeName.toLowerCase())&&this.sync(t);this.findAtPoint(e,i)};R.prototype.findPlace=function(e){for(var t,n,o=this.open;o>=0;o--){var i=this.nodes[o],s=i.findWrapping(e);if(s&&(!t||t.length>s.length)&&(t=s,n=i,!s.length)||i.solid)break}if(!t)return!1;this.sync(n);for(var a=0;a<t.length;a++)this.enterInner(t[a],null,!1);return!0};R.prototype.insertNode=function(e){if(e.isInline&&this.needsBlock&&!this.top.type){var t=this.textblockFromContext();t&&this.enterInner(t)}if(this.findPlace(e)){this.closeExtra();var n=this.top;n.applyPending(e.type),n.match&&(n.match=n.match.matchType(e.type));for(var o=n.activeMarks,i=0;i<e.marks.length;i++)(!n.type||n.type.allowsMarkType(e.marks[i].type))&&(o=e.marks[i].addToSet(o));return n.content.push(e.mark(o)),!0}return!1};R.prototype.enter=function(e,t,n){var o=this.findPlace(e.create(t));return o&&this.enterInner(e,t,!0,n),o};R.prototype.enterInner=function(e,t,n,o){this.closeExtra();var i=this.top;i.applyPending(e),i.match=i.match&&i.match.matchType(e,t);var s=Ko(e,o,i.options);i.options&Pt&&i.content.length==0&&(s|=Pt),this.nodes.push(new ze(e,t,i.activeMarks,i.pendingMarks,n,null,s)),this.open++};R.prototype.closeExtra=function(e){var t=this.nodes.length-1;if(t>this.open){for(;t>this.open;t--)this.nodes[t-1].content.push(this.nodes[t].finish(e));this.nodes.length=this.open+1}};R.prototype.finish=function(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)};R.prototype.sync=function(e){for(var t=this.open;t>=0;t--)if(this.nodes[t]==e){this.open=t;return}};pn.currentPos.get=function(){this.closeExtra();for(var r=0,e=this.open;e>=0;e--){for(var t=this.nodes[e].content,n=t.length-1;n>=0;n--)r+=t[n].nodeSize;e&&r++}return r};R.prototype.findAtPoint=function(e,t){if(this.find)for(var n=0;n<this.find.length;n++)this.find[n].node==e&&this.find[n].offset==t&&(this.find[n].pos=this.currentPos)};R.prototype.findInside=function(e){if(this.find)for(var t=0;t<this.find.length;t++)this.find[t].pos==null&&e.nodeType==1&&e.contains(this.find[t].node)&&(this.find[t].pos=this.currentPos)};R.prototype.findAround=function(e,t,n){if(e!=t&&this.find){for(var o=0;o<this.find.length;o++)if(this.find[o].pos==null&&e.nodeType==1&&e.contains(this.find[o].node)){var i=t.compareDocumentPosition(this.find[o].node);i&(n?2:4)&&(this.find[o].pos=this.currentPos)}}};R.prototype.findInText=function(e){if(this.find)for(var t=0;t<this.find.length;t++)this.find[t].node==e&&(this.find[t].pos=this.currentPos-(e.nodeValue.length-this.find[t].offset))};R.prototype.matchesContext=function(e){var t=this;if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);var n=e.split("/"),o=this.options.context,i=!this.isOpen&&(!o||o.parent.type==this.nodes[0].type),s=-(o?o.depth+1:0)+(i?0:1),a=function(l,f){for(;l>=0;l--){var u=n[l];if(u==""){if(l==n.length-1||l==0)continue;for(;f>=s;f--)if(a(l-1,f))return!0;return!1}else{var c=f>0||f==0&&i?t.nodes[f].type:o&&f>=s?o.node(f-s).type:null;if(!c||c.name!=u&&c.groups.indexOf(u)==-1)return!1;f--}}return!0};return a(n.length-1,this.open)};R.prototype.textblockFromContext=function(){var e=this.options.context;if(e)for(var t=e.depth;t>=0;t--){var n=e.node(t).contentMatchAt(e.indexAfter(t)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(var o in this.parser.schema.nodes){var i=this.parser.schema.nodes[o];if(i.isTextblock&&i.defaultAttrs)return i}};R.prototype.addPendingMark=function(e){var t=Qa(e,this.top.pendingMarks);t&&this.top.stashMarks.push(t),this.top.pendingMarks=e.addToSet(this.top.pendingMarks)};R.prototype.removePendingMark=function(e,t){for(var n=this.open;n>=0;n--){var o=this.nodes[n],i=o.pendingMarks.lastIndexOf(e);if(i>-1)o.pendingMarks=e.removeFromSet(o.pendingMarks);else{o.activeMarks=e.removeFromSet(o.activeMarks);var s=o.popFromStashMark(e);s&&o.type&&o.type.allowsMarkType(s.type)&&(o.activeMarks=s.addToSet(o.activeMarks))}if(o==t)break}};Object.defineProperties(R.prototype,pn);function Ka(r){for(var e=r.firstChild,t=null;e;e=e.nextSibling){var n=e.nodeType==1?e.nodeName.toLowerCase():null;n&&Ho.hasOwnProperty(n)&&t?(t.appendChild(e),e=t):n=="li"?t=e:n&&(t=null)}}function Ua(r,e){return(r.matches||r.msMatchesSelector||r.webkitMatchesSelector||r.mozMatchesSelector).call(r,e)}function Ga(r){for(var e=/\s*([\w-]+)\s*:\s*([^;]+)/g,t,n=[];t=e.exec(r);)n.push(t[1],t[2].trim());return n}function Uo(r){var e={};for(var t in r)e[t]=r[t];return e}function ja(r,e){var t=e.schema.nodes,n=function(s){var a=t[s];if(!!a.allowsMarkType(r)){var l=[],f=function(u){l.push(u);for(var c=0;c<u.edgeCount;c++){var p=u.edge(c),h=p.type,d=p.next;if(h==e||l.indexOf(d)<0&&f(d))return!0}};if(f(a.contentMatch))return{v:!0}}};for(var o in t){var i=n(o);if(i)return i.v}}function Qa(r,e){for(var t=0;t<e.length;t++)if(r.eq(e[t]))return e[t]}var L=function(e,t){this.nodes=e||{},this.marks=t||{}};L.prototype.serializeFragment=function(e,t,n){var o=this;t===void 0&&(t={}),n||(n=hn(t).createDocumentFragment());var i=n,s=null;return e.forEach(function(a){if(s||a.marks.length){s||(s=[]);for(var l=0,f=0;l<s.length&&f<a.marks.length;){var u=a.marks[f];if(!o.marks[u.type.name]){f++;continue}if(!u.eq(s[l])||u.type.spec.spanning===!1)break;l+=2,f++}for(;l<s.length;)i=s.pop(),s.pop();for(;f<a.marks.length;){var c=a.marks[f++],p=o.serializeMark(c,a.isInline,t);p&&(s.push(c,i),i.appendChild(p.dom),i=p.contentDOM||p.dom)}}i.appendChild(o.serializeNodeInner(a,t))}),n};L.prototype.serializeNodeInner=function(e,t){t===void 0&&(t={});var n=L.renderSpec(hn(t),this.nodes[e.type.name](e)),o=n.dom,i=n.contentDOM;if(i){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");t.onContent?t.onContent(e,i,t):this.serializeFragment(e.content,t,i)}return o};L.prototype.serializeNode=function(e,t){t===void 0&&(t={});for(var n=this.serializeNodeInner(e,t),o=e.marks.length-1;o>=0;o--){var i=this.serializeMark(e.marks[o],e.isInline,t);i&&((i.contentDOM||i.dom).appendChild(n),n=i.dom)}return n};L.prototype.serializeMark=function(e,t,n){n===void 0&&(n={});var o=this.marks[e.type.name];return o&&L.renderSpec(hn(n),o(e,t))};L.renderSpec=function(e,t,n){if(n===void 0&&(n=null),typeof t=="string")return{dom:e.createTextNode(t)};if(t.nodeType!=null)return{dom:t};if(t.dom&&t.dom.nodeType!=null)return t;var o=t[0],i=o.indexOf(" ");i>0&&(n=o.slice(0,i),o=o.slice(i+1));var s=null,a=n?e.createElementNS(n,o):e.createElement(o),l=t[1],f=1;if(l&&typeof l=="object"&&l.nodeType==null&&!Array.isArray(l)){f=2;for(var u in l)if(l[u]!=null){var c=u.indexOf(" ");c>0?a.setAttributeNS(u.slice(0,c),u.slice(c+1),l[u]):a.setAttribute(u,l[u])}}for(var p=f;p<t.length;p++){var h=t[p];if(h===0){if(p<t.length-1||p>f)throw new RangeError("Content hole must be the only child of its parent node");return{dom:a,contentDOM:a}}else{var d=L.renderSpec(e,h,n),v=d.dom,b=d.contentDOM;if(a.appendChild(v),b){if(s)throw new RangeError("Multiple content holes");s=b}}}return{dom:a,contentDOM:s}};L.fromSchema=function(e){return e.cached.domSerializer||(e.cached.domSerializer=new L(this.nodesFromSchema(e),this.marksFromSchema(e)))};L.nodesFromSchema=function(e){var t=Go(e.nodes);return t.text||(t.text=function(n){return n.text}),t};L.marksFromSchema=function(e){return Go(e.marks)};function Go(r){var e={};for(var t in r){var n=r[t].spec.toDOM;n&&(e[t]=n)}return e}function hn(r){return r.document||window.document}var Or={};Ze(Or,{AllSelection:()=>be,EditorState:()=>J,NodeSelection:()=>x,Plugin:()=>W,PluginKey:()=>bt,Selection:()=>N,SelectionRange:()=>oi,TextSelection:()=>I,Transaction:()=>li});var jo=65535,Qo=Math.pow(2,16);function Ya(r,e){return r+e*Qo}function Yo(r){return r&jo}function Xa(r){return(r-(r&jo))/Qo}var dn=function(e,t,n){t===void 0&&(t=!1),n===void 0&&(n=null),this.pos=e,this.deleted=t,this.recover=n},G=function r(e,t){if(t===void 0&&(t=!1),!e.length&&r.empty)return r.empty;this.ranges=e,this.inverted=t};G.prototype.recover=function(e){var t=0,n=Yo(e);if(!this.inverted)for(var o=0;o<n;o++)t+=this.ranges[o*3+2]-this.ranges[o*3+1];return this.ranges[n*3]+t+Xa(e)};G.prototype.mapResult=function(e,t){return t===void 0&&(t=1),this._map(e,t,!1)};G.prototype.map=function(e,t){return t===void 0&&(t=1),this._map(e,t,!0)};G.prototype._map=function(e,t,n){for(var o=0,i=this.inverted?2:1,s=this.inverted?1:2,a=0;a<this.ranges.length;a+=3){var l=this.ranges[a]-(this.inverted?o:0);if(l>e)break;var f=this.ranges[a+i],u=this.ranges[a+s],c=l+f;if(e<=c){var p=f?e==l?-1:e==c?1:t:t,h=l+o+(p<0?0:u);if(n)return h;var d=e==(t<0?l:c)?null:Ya(a/3,e-l);return new dn(h,t<0?e!=l:e!=c,d)}o+=u-f}return n?e+o:new dn(e+o)};G.prototype.touches=function(e,t){for(var n=0,o=Yo(t),i=this.inverted?2:1,s=this.inverted?1:2,a=0;a<this.ranges.length;a+=3){var l=this.ranges[a]-(this.inverted?n:0);if(l>e)break;var f=this.ranges[a+i],u=l+f;if(e<=u&&a==o*3)return!0;n+=this.ranges[a+s]-f}return!1};G.prototype.forEach=function(e){for(var t=this.inverted?2:1,n=this.inverted?1:2,o=0,i=0;o<this.ranges.length;o+=3){var s=this.ranges[o],a=s-(this.inverted?i:0),l=s+(this.inverted?0:i),f=this.ranges[o+t],u=this.ranges[o+n];e(a,a+f,l,l+u),i+=u-f}};G.prototype.invert=function(){return new G(this.ranges,!this.inverted)};G.prototype.toString=function(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)};G.offset=function(e){return e==0?G.empty:new G(e<0?[0,-e,0]:[0,0,e])};G.empty=new G([]);var j=function(e,t,n,o){this.maps=e||[],this.from=n||0,this.to=o==null?this.maps.length:o,this.mirror=t};j.prototype.slice=function(e,t){return e===void 0&&(e=0),t===void 0&&(t=this.maps.length),new j(this.maps,this.mirror,e,t)};j.prototype.copy=function(){return new j(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)};j.prototype.appendMap=function(e,t){this.to=this.maps.push(e),t!=null&&this.setMirror(this.maps.length-1,t)};j.prototype.appendMapping=function(e){for(var t=0,n=this.maps.length;t<e.maps.length;t++){var o=e.getMirror(t);this.appendMap(e.maps[t],o!=null&&o<t?n+o:null)}};j.prototype.getMirror=function(e){if(this.mirror){for(var t=0;t<this.mirror.length;t++)if(this.mirror[t]==e)return this.mirror[t+(t%2?-1:1)]}};j.prototype.setMirror=function(e,t){this.mirror||(this.mirror=[]),this.mirror.push(e,t)};j.prototype.appendMappingInverted=function(e){for(var t=e.maps.length-1,n=this.maps.length+e.maps.length;t>=0;t--){var o=e.getMirror(t);this.appendMap(e.maps[t].invert(),o!=null&&o>t?n-o-1:null)}};j.prototype.invert=function(){var e=new j;return e.appendMappingInverted(this),e};j.prototype.map=function(e,t){if(t===void 0&&(t=1),this.mirror)return this._map(e,t,!0);for(var n=this.from;n<this.to;n++)e=this.maps[n].map(e,t);return e};j.prototype.mapResult=function(e,t){return t===void 0&&(t=1),this._map(e,t,!1)};j.prototype._map=function(e,t,n){for(var o=!1,i=this.from;i<this.to;i++){var s=this.maps[i],a=s.mapResult(e,t);if(a.recover!=null){var l=this.getMirror(i);if(l!=null&&l>i&&l<this.to){i=l,e=this.maps[l].recover(a.recover);continue}}a.deleted&&(o=!0),e=a.pos}return n?e:new dn(e,o)};function vt(r){var e=Error.call(this,r);return e.__proto__=vt.prototype,e}vt.prototype=Object.create(Error.prototype);vt.prototype.constructor=vt;vt.prototype.name="TransformError";var B=function(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new j},mn={before:{configurable:!0},docChanged:{configurable:!0}};mn.before.get=function(){return this.docs.length?this.docs[0]:this.doc};B.prototype.step=function(e){var t=this.maybeStep(e);if(t.failed)throw new vt(t.failed);return this};B.prototype.maybeStep=function(e){var t=e.apply(this.doc);return t.failed||this.addStep(e,t.doc),t};mn.docChanged.get=function(){return this.steps.length>0};B.prototype.addStep=function(e,t){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=t};Object.defineProperties(B.prototype,mn);function br(){throw new Error("Override me")}var vn=Object.create(null),ne=function(){};ne.prototype.apply=function(e){return br()};ne.prototype.getMap=function(){return G.empty};ne.prototype.invert=function(e){return br()};ne.prototype.map=function(e){return br()};ne.prototype.merge=function(e){return null};ne.prototype.toJSON=function(){return br()};ne.fromJSON=function(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");var n=vn[t.stepType];if(!n)throw new RangeError("No step type "+t.stepType+" defined");return n.fromJSON(e,t)};ne.jsonID=function(e,t){if(e in vn)throw new RangeError("Duplicate use of step JSON ID "+e);return vn[e]=t,t.prototype.jsonID=e,t};var ae=function(e,t){this.doc=e,this.failed=t};ae.ok=function(e){return new ae(e,null)};ae.fail=function(e){return new ae(null,e)};ae.fromReplace=function(e,t,n,o){try{return ae.ok(e.replace(t,n,o))}catch(i){if(i instanceof ge)return ae.fail(i.message);throw i}};var Fe=function(r){function e(t,n,o,i){r.call(this),this.from=t,this.to=n,this.slice=o,this.structure=!!i}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.apply=function(n){return this.structure&&gn(n,this.from,this.to)?ae.fail("Structure replace would overwrite content"):ae.fromReplace(n,this.from,this.to,this.slice)},e.prototype.getMap=function(){return new G([this.from,this.to-this.from,this.slice.size])},e.prototype.invert=function(n){return new e(this.from,this.from+this.slice.size,n.slice(this.from,this.to))},e.prototype.map=function(n){var o=n.mapResult(this.from,1),i=n.mapResult(this.to,-1);return o.deleted&&i.deleted?null:new e(o.pos,Math.max(o.pos,i.pos),this.slice)},e.prototype.merge=function(n){if(!(n instanceof e)||n.structure||this.structure)return null;if(this.from+this.slice.size==n.from&&!this.slice.openEnd&&!n.slice.openStart){var o=this.slice.size+n.slice.size==0?k.empty:new k(this.slice.content.append(n.slice.content),this.slice.openStart,n.slice.openEnd);return new e(this.from,this.to+(n.to-n.from),o,this.structure)}else if(n.to==this.from&&!this.slice.openStart&&!n.slice.openEnd){var i=this.slice.size+n.slice.size==0?k.empty:new k(n.slice.content.append(this.slice.content),n.slice.openStart,this.slice.openEnd);return new e(n.from,this.to,i,this.structure)}else return null},e.prototype.toJSON=function(){var n={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(n.slice=this.slice.toJSON()),this.structure&&(n.structure=!0),n},e.fromJSON=function(n,o){if(typeof o.from!="number"||typeof o.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new e(o.from,o.to,k.fromJSON(n,o.slice),!!o.structure)},e}(ne);ne.jsonID("replace",Fe);var oe=function(r){function e(t,n,o,i,s,a,l){r.call(this),this.from=t,this.to=n,this.gapFrom=o,this.gapTo=i,this.slice=s,this.insert=a,this.structure=!!l}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.apply=function(n){if(this.structure&&(gn(n,this.from,this.gapFrom)||gn(n,this.gapTo,this.to)))return ae.fail("Structure gap-replace would overwrite content");var o=n.slice(this.gapFrom,this.gapTo);if(o.openStart||o.openEnd)return ae.fail("Gap is not a flat range");var i=this.slice.insertAt(this.insert,o.content);return i?ae.fromReplace(n,this.from,this.to,i):ae.fail("Content does not fit in gap")},e.prototype.getMap=function(){return new G([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])},e.prototype.invert=function(n){var o=this.gapTo-this.gapFrom;return new e(this.from,this.from+this.slice.size+o,this.from+this.insert,this.from+this.insert+o,n.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)},e.prototype.map=function(n){var o=n.mapResult(this.from,1),i=n.mapResult(this.to,-1),s=n.map(this.gapFrom,-1),a=n.map(this.gapTo,1);return o.deleted&&i.deleted||s<o.pos||a>i.pos?null:new e(o.pos,i.pos,s,a,this.slice,this.insert,this.structure)},e.prototype.toJSON=function(){var n={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(n.slice=this.slice.toJSON()),this.structure&&(n.structure=!0),n},e.fromJSON=function(n,o){if(typeof o.from!="number"||typeof o.to!="number"||typeof o.gapFrom!="number"||typeof o.gapTo!="number"||typeof o.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new e(o.from,o.to,o.gapFrom,o.gapTo,k.fromJSON(n,o.slice),o.insert,!!o.structure)},e}(ne);ne.jsonID("replaceAround",oe);function gn(r,e,t){for(var n=r.resolve(e),o=t-e,i=n.depth;o>0&&i>0&&n.indexAfter(i)==n.node(i).childCount;)i--,o--;if(o>0)for(var s=n.node(i).maybeChild(n.indexAfter(i));o>0;){if(!s||s.isLeaf)return!0;s=s.firstChild,o--}return!1}function Za(r,e,t){return(e==0||r.canReplace(e,r.childCount))&&(t==r.childCount||r.canReplace(0,t))}function rt(r){for(var e=r.parent,t=e.content.cutByIndex(r.startIndex,r.endIndex),n=r.depth;;--n){var o=r.$from.node(n),i=r.$from.index(n),s=r.$to.indexAfter(n);if(n<r.depth&&o.canReplace(i,s,t))return n;if(n==0||o.type.spec.isolating||!Za(o,i,s))break}}B.prototype.lift=function(r,e){for(var t=r.$from,n=r.$to,o=r.depth,i=t.before(o+1),s=n.after(o+1),a=i,l=s,f=m.empty,u=0,c=o,p=!1;c>e;c--)p||t.index(c)>0?(p=!0,f=m.from(t.node(c).copy(f)),u++):a--;for(var h=m.empty,d=0,v=o,b=!1;v>e;v--)b||n.after(v+1)<n.end(v)?(b=!0,h=m.from(n.node(v).copy(h)),d++):l++;return this.step(new oe(a,l,i,s,new k(f.append(h),u,d),f.size-u,!0))};function gt(r,e,t,n){n===void 0&&(n=r);var o=$a(r,e),i=o&&el(n,e);return i?o.map(Xo).concat({type:e,attrs:t}).concat(i.map(Xo)):null}function Xo(r){return{type:r,attrs:null}}function $a(r,e){var t=r.parent,n=r.startIndex,o=r.endIndex,i=t.contentMatchAt(n).findWrapping(e);if(!i)return null;var s=i.length?i[0]:e;return t.canReplaceWith(n,o,s)?i:null}function el(r,e){var t=r.parent,n=r.startIndex,o=r.endIndex,i=t.child(n),s=e.contentMatch.findWrapping(i.type);if(!s)return null;for(var a=s.length?s[s.length-1]:e,l=a.contentMatch,f=n;l&&f<o;f++)l=l.matchType(t.child(f).type);return!l||!l.validEnd?null:s}B.prototype.wrap=function(r,e){for(var t=m.empty,n=e.length-1;n>=0;n--){if(t.size){var o=e[n].type.contentMatch.matchFragment(t);if(!o||!o.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}t=m.from(e[n].type.create(e[n].attrs,t))}var i=r.start,s=r.end;return this.step(new oe(i,s,i,s,new k(t,0,0),e.length,!0))};B.prototype.setBlockType=function(r,e,t,n){var o=this;if(e===void 0&&(e=r),!t.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");var i=this.steps.length;return this.doc.nodesBetween(r,e,function(s,a){if(s.isTextblock&&!s.hasMarkup(t,n)&&tl(o.doc,o.mapping.slice(i).map(a),t)){o.clearIncompatible(o.mapping.slice(i).map(a,1),t);var l=o.mapping.slice(i),f=l.map(a,1),u=l.map(a+s.nodeSize,1);return o.step(new oe(f,u,f+1,u-1,new k(m.from(t.create(n,null,s.marks)),0,0),1,!0)),!1}}),this};function tl(r,e,t){var n=r.resolve(e),o=n.index();return n.parent.canReplaceWith(o,o+1,t)}B.prototype.setNodeMarkup=function(r,e,t,n){var o=this.doc.nodeAt(r);if(!o)throw new RangeError("No node at given position");e||(e=o.type);var i=e.create(t,null,n||o.marks);if(o.isLeaf)return this.replaceWith(r,r+o.nodeSize,i);if(!e.validContent(o.content))throw new RangeError("Invalid content for node type "+e.name);return this.step(new oe(r,r+o.nodeSize,r+1,r+o.nodeSize-1,new k(m.from(i),0,0),1,!0))};function Je(r,e,t,n){t===void 0&&(t=1);var o=r.resolve(e),i=o.depth-t,s=n&&n[n.length-1]||o.parent;if(i<0||o.parent.type.spec.isolating||!o.parent.canReplace(o.index(),o.parent.childCount)||!s.type.validContent(o.parent.content.cutByIndex(o.index(),o.parent.childCount)))return!1;for(var a=o.depth-1,l=t-2;a>i;a--,l--){var f=o.node(a),u=o.index(a);if(f.type.spec.isolating)return!1;var c=f.content.cutByIndex(u,f.childCount),p=n&&n[l]||f;if(p!=f&&(c=c.replaceChild(0,p.type.create(p.attrs))),!f.canReplace(u+1,f.childCount)||!p.type.validContent(c))return!1}var h=o.indexAfter(i),d=n&&n[0];return o.node(i).canReplaceWith(h,h,d?d.type:o.node(i+1).type)}B.prototype.split=function(r,e,t){e===void 0&&(e=1);for(var n=this.doc.resolve(r),o=m.empty,i=m.empty,s=n.depth,a=n.depth-e,l=e-1;s>a;s--,l--){o=m.from(n.node(s).copy(o));var f=t&&t[l];i=m.from(f?f.type.create(f.attrs,i):n.node(s).copy(i))}return this.step(new Fe(r,r,new k(o.append(i),e,e),!0))};function nt(r,e){var t=r.resolve(e),n=t.index();return Zo(t.nodeBefore,t.nodeAfter)&&t.parent.canReplace(n,n+1)}function Zo(r,e){return r&&e&&!r.isLeaf&&r.canAppend(e)}function yn(r,e,t){t===void 0&&(t=-1);for(var n=r.resolve(e),o=n.depth;;o--){var i=void 0,s=void 0,a=n.index(o);if(o==n.depth?(i=n.nodeBefore,s=n.nodeAfter):t>0?(i=n.node(o+1),a++,s=n.node(o).maybeChild(a)):(i=n.node(o).maybeChild(a-1),s=n.node(o+1)),i&&!i.isTextblock&&Zo(i,s)&&n.node(o).canReplace(a,a+1))return e;if(o==0)break;e=t<0?n.before(o):n.after(o)}}B.prototype.join=function(r,e){e===void 0&&(e=1);var t=new Fe(r-e,r+e,k.empty,!0);return this.step(t)};function rl(r,e,t){var n=r.resolve(e);if(n.parent.canReplaceWith(n.index(),n.index(),t))return e;if(n.parentOffset==0)for(var o=n.depth-1;o>=0;o--){var i=n.index(o);if(n.node(o).canReplaceWith(i,i,t))return n.before(o+1);if(i>0)return null}if(n.parentOffset==n.parent.content.size)for(var s=n.depth-1;s>=0;s--){var a=n.indexAfter(s);if(n.node(s).canReplaceWith(a,a,t))return n.after(s+1);if(a<n.node(s).childCount)return null}}function kr(r,e,t){var n=r.resolve(e);if(!t.content.size)return e;for(var o=t.content,i=0;i<t.openStart;i++)o=o.firstChild.content;for(var s=1;s<=(t.openStart==0&&t.size?2:1);s++)for(var a=n.depth;a>=0;a--){var l=a==n.depth?0:n.pos<=(n.start(a+1)+n.end(a+1))/2?-1:1,f=n.index(a)+(l>0?1:0),u=n.node(a),c=!1;if(s==1)c=u.canReplace(f,f,o);else{var p=u.contentMatchAt(f).findWrapping(o.firstChild.type);c=p&&u.canReplaceWith(f,f,p[0])}if(c)return l==0?n.pos:l<0?n.before(a+1):n.after(a+1)}return null}function bn(r,e,t){for(var n=[],o=0;o<r.childCount;o++){var i=r.child(o);i.content.size&&(i=i.copy(bn(i.content,e,i))),i.isInline&&(i=e(i,t,o)),n.push(i)}return m.fromArray(n)}var kn=function(r){function e(t,n,o){r.call(this),this.from=t,this.to=n,this.mark=o}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.apply=function(n){var o=this,i=n.slice(this.from,this.to),s=n.resolve(this.from),a=s.node(s.sharedDepth(this.to)),l=new k(bn(i.content,function(f,u){return!f.isAtom||!u.type.allowsMarkType(o.mark.type)?f:f.mark(o.mark.addToSet(f.marks))},a),i.openStart,i.openEnd);return ae.fromReplace(n,this.from,this.to,l)},e.prototype.invert=function(){return new zt(this.from,this.to,this.mark)},e.prototype.map=function(n){var o=n.mapResult(this.from,1),i=n.mapResult(this.to,-1);return o.deleted&&i.deleted||o.pos>=i.pos?null:new e(o.pos,i.pos,this.mark)},e.prototype.merge=function(n){if(n instanceof e&&n.mark.eq(this.mark)&&this.from<=n.to&&this.to>=n.from)return new e(Math.min(this.from,n.from),Math.max(this.to,n.to),this.mark)},e.prototype.toJSON=function(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},e.fromJSON=function(n,o){if(typeof o.from!="number"||typeof o.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new e(o.from,o.to,n.markFromJSON(o.mark))},e}(ne);ne.jsonID("addMark",kn);var zt=function(r){function e(t,n,o){r.call(this),this.from=t,this.to=n,this.mark=o}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.apply=function(n){var o=this,i=n.slice(this.from,this.to),s=new k(bn(i.content,function(a){return a.mark(o.mark.removeFromSet(a.marks))}),i.openStart,i.openEnd);return ae.fromReplace(n,this.from,this.to,s)},e.prototype.invert=function(){return new kn(this.from,this.to,this.mark)},e.prototype.map=function(n){var o=n.mapResult(this.from,1),i=n.mapResult(this.to,-1);return o.deleted&&i.deleted||o.pos>=i.pos?null:new e(o.pos,i.pos,this.mark)},e.prototype.merge=function(n){if(n instanceof e&&n.mark.eq(this.mark)&&this.from<=n.to&&this.to>=n.from)return new e(Math.min(this.from,n.from),Math.max(this.to,n.to),this.mark)},e.prototype.toJSON=function(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},e.fromJSON=function(n,o){if(typeof o.from!="number"||typeof o.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new e(o.from,o.to,n.markFromJSON(o.mark))},e}(ne);ne.jsonID("removeMark",zt);B.prototype.addMark=function(r,e,t){var n=this,o=[],i=[],s=null,a=null;return this.doc.nodesBetween(r,e,function(l,f,u){if(!!l.isInline){var c=l.marks;if(!t.isInSet(c)&&u.type.allowsMarkType(t.type)){for(var p=Math.max(f,r),h=Math.min(f+l.nodeSize,e),d=t.addToSet(c),v=0;v<c.length;v++)c[v].isInSet(d)||(s&&s.to==p&&s.mark.eq(c[v])?s.to=h:o.push(s=new zt(p,h,c[v])));a&&a.to==p?a.to=h:i.push(a=new kn(p,h,t))}}}),o.forEach(function(l){return n.step(l)}),i.forEach(function(l){return n.step(l)}),this};B.prototype.removeMark=function(r,e,t){var n=this;t===void 0&&(t=null);var o=[],i=0;return this.doc.nodesBetween(r,e,function(s,a){if(!!s.isInline){i++;var l=null;if(t instanceof Te)for(var f=s.marks,u;u=t.isInSet(f);)(l||(l=[])).push(u),f=u.removeFromSet(f);else t?t.isInSet(s.marks)&&(l=[t]):l=s.marks;if(l&&l.length)for(var c=Math.min(a+s.nodeSize,e),p=0;p<l.length;p++){for(var h=l[p],d=void 0,v=0;v<o.length;v++){var b=o[v];b.step==i-1&&h.eq(o[v].style)&&(d=b)}d?(d.to=c,d.step=i):o.push({style:h,from:Math.max(a,r),to:c,step:i})}}}),o.forEach(function(s){return n.step(new zt(s.from,s.to,s.style))}),this};B.prototype.clearIncompatible=function(r,e,t){t===void 0&&(t=e.contentMatch);for(var n=this.doc.nodeAt(r),o=[],i=r+1,s=0;s<n.childCount;s++){var a=n.child(s),l=i+a.nodeSize,f=t.matchType(a.type,a.attrs);if(!f)o.push(new Fe(i,l,k.empty));else{t=f;for(var u=0;u<a.marks.length;u++)e.allowsMarkType(a.marks[u].type)||this.step(new zt(i,l,a.marks[u]))}i=l}if(!t.validEnd){var c=t.fillBefore(m.empty,!0);this.replace(i,i,new k(c,0,0))}for(var p=o.length-1;p>=0;p--)this.step(o[p]);return this};function Sr(r,e,t,n){if(t===void 0&&(t=e),n===void 0&&(n=k.empty),e==t&&!n.size)return null;var o=r.resolve(e),i=r.resolve(t);return $o(o,i,n)?new Fe(e,t,n):new ye(o,i,n).fit()}B.prototype.replace=function(r,e,t){e===void 0&&(e=r),t===void 0&&(t=k.empty);var n=Sr(this.doc,r,e,t);return n&&this.step(n),this};B.prototype.replaceWith=function(r,e,t){return this.replace(r,e,new k(m.from(t),0,0))};B.prototype.delete=function(r,e){return this.replace(r,e,k.empty)};B.prototype.insert=function(r,e){return this.replaceWith(r,r,e)};function $o(r,e,t){return!t.openStart&&!t.openEnd&&r.start()==e.start()&&r.parent.canReplace(r.index(),e.index(),t.content)}var ye=function(e,t,n){this.$to=t,this.$from=e,this.unplaced=n,this.frontier=[];for(var o=0;o<=e.depth;o++){var i=e.node(o);this.frontier.push({type:i.type,match:i.contentMatchAt(e.indexAfter(o))})}this.placed=m.empty;for(var s=e.depth;s>0;s--)this.placed=m.from(e.node(s).copy(this.placed))},ei={depth:{configurable:!0}};ei.depth.get=function(){return this.frontier.length-1};ye.prototype.fit=function(){for(;this.unplaced.size;){var e=this.findFittable();e?this.placeNodes(e):this.openMore()||this.dropNode()}var t=this.mustMoveInline(),n=this.placed.size-this.depth-this.$from.depth,o=this.$from,i=this.close(t<0?this.$to:o.doc.resolve(t));if(!i)return null;for(var s=this.placed,a=o.depth,l=i.depth;a&&l&&s.childCount==1;)s=s.firstChild.content,a--,l--;var f=new k(s,a,l);if(t>-1)return new oe(o.pos,t,this.$to.pos,this.$to.end(),f,n);if(f.size||o.pos!=this.$to.pos)return new Fe(o.pos,i.pos,f)};ye.prototype.findFittable=function(){for(var e=1;e<=2;e++)for(var t=this.unplaced.openStart;t>=0;t--){var n=void 0,o=void 0;t?(o=Sn(this.unplaced.content,t-1).firstChild,n=o.content):n=this.unplaced.content;for(var i=n.firstChild,s=this.depth;s>=0;s--){var a=this.frontier[s],l=a.type,f=a.match,u=void 0,c=void 0;if(e==1&&(i?f.matchType(i.type)||(c=f.fillBefore(m.from(i),!1)):l.compatibleContent(o.type)))return{sliceDepth:t,frontierDepth:s,parent:o,inject:c};if(e==2&&i&&(u=f.findWrapping(i.type)))return{sliceDepth:t,frontierDepth:s,parent:o,wrap:u};if(o&&f.matchType(o.type))break}}};ye.prototype.openMore=function(){var e=this.unplaced,t=e.content,n=e.openStart,o=e.openEnd,i=Sn(t,n);return!i.childCount||i.firstChild.isLeaf?!1:(this.unplaced=new k(t,n+1,Math.max(o,i.size+n>=t.size-o?n+1:0)),!0)};ye.prototype.dropNode=function(){var e=this.unplaced,t=e.content,n=e.openStart,o=e.openEnd,i=Sn(t,n);if(i.childCount<=1&&n>0){var s=t.size-n<=n+i.size;this.unplaced=new k(Ft(t,n-1,1),n-1,s?n-1:o)}else this.unplaced=new k(Ft(t,n,1),n,o)};ye.prototype.placeNodes=function(e){for(var t=e.sliceDepth,n=e.frontierDepth,o=e.parent,i=e.inject,s=e.wrap;this.depth>n;)this.closeFrontierNode();if(s)for(var a=0;a<s.length;a++)this.openFrontierNode(s[a]);var l=this.unplaced,f=o?o.content:l.content,u=l.openStart-t,c=0,p=[],h=this.frontier[n],d=h.match,v=h.type;if(i){for(var b=0;b<i.childCount;b++)p.push(i.child(b));d=d.matchFragment(i)}for(var S=f.size+t-(l.content.size-l.openEnd);c<f.childCount;){var y=f.child(c),O=d.matchType(y.type);if(!O)break;c++,(c>1||u==0||y.content.size)&&(d=O,p.push(ti(y.mark(v.allowedMarks(y.marks)),c==1?u:0,c==f.childCount?S:-1)))}var M=c==f.childCount;M||(S=-1),this.placed=Bt(this.placed,n,m.from(p)),this.frontier[n].match=d,M&&S<0&&o&&o.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(var C=0,T=f;C<S;C++){var P=T.lastChild;this.frontier.push({type:P.type,match:P.contentMatchAt(P.childCount)}),T=P.content}this.unplaced=M?t==0?k.empty:new k(Ft(l.content,t-1,1),t-1,S<0?l.openEnd:t-1):new k(Ft(l.content,t,c),l.openStart,l.openEnd)};ye.prototype.mustMoveInline=function(){if(!this.$to.parent.isTextblock)return-1;var e=this.frontier[this.depth],t;if(!e.type.isTextblock||!Mn(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;for(var n=this.$to,o=n.depth,i=this.$to.after(o);o>1&&i==this.$to.end(--o);)++i;return i};ye.prototype.findCloseLevel=function(e){e:for(var t=Math.min(this.depth,e.depth);t>=0;t--){var n=this.frontier[t],o=n.match,i=n.type,s=t<e.depth&&e.end(t+1)==e.pos+(e.depth-(t+1)),a=Mn(e,t,i,o,s);if(!!a){for(var l=t-1;l>=0;l--){var f=this.frontier[l],u=f.match,c=f.type,p=Mn(e,l,c,u,!0);if(!p||p.childCount)continue e}return{depth:t,fit:a,move:s?e.doc.resolve(e.after(t+1)):e}}}};ye.prototype.close=function(e){var t=this.findCloseLevel(e);if(!t)return null;for(;this.depth>t.depth;)this.closeFrontierNode();t.fit.childCount&&(this.placed=Bt(this.placed,t.depth,t.fit)),e=t.move;for(var n=t.depth+1;n<=e.depth;n++){var o=e.node(n),i=o.type.contentMatch.fillBefore(o.content,!0,e.index(n));this.openFrontierNode(o.type,o.attrs,i)}return e};ye.prototype.openFrontierNode=function(e,t,n){var o=this.frontier[this.depth];o.match=o.match.matchType(e),this.placed=Bt(this.placed,this.depth,m.from(e.create(t,n))),this.frontier.push({type:e,match:e.contentMatch})};ye.prototype.closeFrontierNode=function(){var e=this.frontier.pop(),t=e.match.fillBefore(m.empty,!0);t.childCount&&(this.placed=Bt(this.placed,this.frontier.length,t))};Object.defineProperties(ye.prototype,ei);function Ft(r,e,t){return e==0?r.cutByIndex(t):r.replaceChild(0,r.firstChild.copy(Ft(r.firstChild.content,e-1,t)))}function Bt(r,e,t){return e==0?r.append(t):r.replaceChild(r.childCount-1,r.lastChild.copy(Bt(r.lastChild.content,e-1,t)))}function Sn(r,e){for(var t=0;t<e;t++)r=r.firstChild.content;return r}function ti(r,e,t){if(e<=0)return r;var n=r.content;return e>1&&(n=n.replaceChild(0,ti(n.firstChild,e-1,n.childCount==1?t-1:0))),e>0&&(n=r.type.contentMatch.fillBefore(n).append(n),t<=0&&(n=n.append(r.type.contentMatch.matchFragment(n).fillBefore(m.empty,!0)))),r.copy(n)}function Mn(r,e,t,n,o){var i=r.node(e),s=o?r.indexAfter(e):r.index(e);if(s==i.childCount&&!t.compatibleContent(i.type))return null;var a=n.fillBefore(i.content,!0,s);return a&&!nl(t,i.content,s)?a:null}function nl(r,e,t){for(var n=t;n<e.childCount;n++)if(!r.allowsMarks(e.child(n).marks))return!0;return!1}function ol(r){return r.spec.defining||r.spec.definingForContent}B.prototype.replaceRange=function(r,e,t){if(!t.size)return this.deleteRange(r,e);var n=this.doc.resolve(r),o=this.doc.resolve(e);if($o(n,o,t))return this.step(new Fe(r,e,t));var i=ni(n,this.doc.resolve(e));i[i.length-1]==0&&i.pop();var s=-(n.depth+1);i.unshift(s);for(var a=n.depth,l=n.pos-1;a>0;a--,l--){var f=n.node(a).type.spec;if(f.defining||f.definingAsContext||f.isolating)break;i.indexOf(a)>-1?s=a:n.before(a)==l&&i.splice(1,0,-a)}for(var u=i.indexOf(s),c=[],p=t.openStart,h=t.content,d=0;;d++){var v=h.firstChild;if(c.push(v),d==t.openStart)break;h=v.content}for(var b=p-1;b>=0;b--){var S=c[b].type,y=ol(S);if(y&&n.node(u).type!=S)p=b;else if(y||!S.isTextblock)break}for(var O=t.openStart;O>=0;O--){var M=(O+p+1)%(t.openStart+1),C=c[M];if(!!C)for(var T=0;T<i.length;T++){var P=i[(T+u)%i.length],F=!0;P<0&&(F=!1,P=-P);var H=n.node(P-1),K=n.index(P-1);if(H.canReplaceWith(K,K,C.type,C.marks))return this.replace(n.before(P),F?o.after(P):e,new k(ri(t.content,0,t.openStart,M),M,t.openEnd))}}for(var Pe=this.steps.length,Ce=i.length-1;Ce>=0&&(this.replace(r,e,t),!(this.steps.length>Pe));Ce--){var xe=i[Ce];xe<0||(r=n.before(xe),e=o.after(xe))}return this};function ri(r,e,t,n,o){if(e<t){var i=r.firstChild;r=r.replaceChild(0,i.copy(ri(i.content,e+1,t,n,i)))}if(e>n){var s=o.contentMatchAt(0),a=s.fillBefore(r).append(r);r=a.append(s.matchFragment(a).fillBefore(m.empty,!0))}return r}B.prototype.replaceRangeWith=function(r,e,t){if(!t.isInline&&r==e&&this.doc.resolve(r).parent.content.size){var n=rl(this.doc,r,t.type);n!=null&&(r=e=n)}return this.replaceRange(r,e,new k(m.from(t),0,0))};B.prototype.deleteRange=function(r,e){for(var t=this.doc.resolve(r),n=this.doc.resolve(e),o=ni(t,n),i=0;i<o.length;i++){var s=o[i],a=i==o.length-1;if(a&&s==0||t.node(s).type.contentMatch.validEnd)return this.delete(t.start(s),n.end(s));if(s>0&&(a||t.node(s-1).canReplace(t.index(s-1),n.indexAfter(s-1))))return this.delete(t.before(s),n.after(s))}for(var l=1;l<=t.depth&&l<=n.depth;l++)if(r-t.start(l)==t.depth-l&&e>t.end(l)&&n.end(l)-e!=n.depth-l)return this.delete(t.before(l),e);return this.delete(r,e)};function ni(r,e){for(var t=[],n=Math.min(r.depth,e.depth),o=n;o>=0;o--){var i=r.start(o);if(i<r.pos-(r.depth-o)||e.end(o)>e.pos+(e.depth-o)||r.node(o).type.spec.isolating||e.node(o).type.spec.isolating)break;(i==e.start(o)||o==r.depth&&o==e.depth&&r.parent.inlineContent&&e.parent.inlineContent&&o&&e.start(o-1)==i-1)&&t.push(o)}return t}var Cn=Object.create(null),N=function(e,t,n){this.ranges=n||[new oi(e.min(t),e.max(t))],this.$anchor=e,this.$head=t},We={anchor:{configurable:!0},head:{configurable:!0},from:{configurable:!0},to:{configurable:!0},$from:{configurable:!0},$to:{configurable:!0},empty:{configurable:!0}};We.anchor.get=function(){return this.$anchor.pos};We.head.get=function(){return this.$head.pos};We.from.get=function(){return this.$from.pos};We.to.get=function(){return this.$to.pos};We.$from.get=function(){return this.ranges[0].$from};We.$to.get=function(){return this.ranges[0].$to};We.empty.get=function(){for(var r=this.ranges,e=0;e<r.length;e++)if(r[e].$from.pos!=r[e].$to.pos)return!1;return!0};N.prototype.content=function(){return this.$from.node(0).slice(this.from,this.to,!0)};N.prototype.replace=function(e,t){t===void 0&&(t=k.empty);for(var n=t.content.lastChild,o=null,i=0;i<t.openEnd;i++)o=n,n=n.lastChild;for(var s=e.steps.length,a=this.ranges,l=0;l<a.length;l++){var f=a[l],u=f.$from,c=f.$to,p=e.mapping.slice(s);e.replaceRange(p.map(u.pos),p.map(c.pos),l?k.empty:t),l==0&&ii(e,s,(n?n.isInline:o&&o.isTextblock)?-1:1)}};N.prototype.replaceWith=function(e,t){for(var n=e.steps.length,o=this.ranges,i=0;i<o.length;i++){var s=o[i],a=s.$from,l=s.$to,f=e.mapping.slice(n),u=f.map(a.pos),c=f.map(l.pos);i?e.deleteRange(u,c):(e.replaceRangeWith(u,c,t),ii(e,n,t.isInline?-1:1))}};N.findFrom=function(e,t,n){var o=e.parent.inlineContent?new I(e):yt(e.node(0),e.parent,e.pos,e.index(),t,n);if(o)return o;for(var i=e.depth-1;i>=0;i--){var s=t<0?yt(e.node(0),e.node(i),e.before(i+1),e.index(i),t,n):yt(e.node(0),e.node(i),e.after(i+1),e.index(i)+1,t,n);if(s)return s}};N.near=function(e,t){return t===void 0&&(t=1),this.findFrom(e,t)||this.findFrom(e,-t)||new be(e.node(0))};N.atStart=function(e){return yt(e,e,0,0,1)||new be(e)};N.atEnd=function(e){return yt(e,e,e.content.size,e.childCount,-1)||new be(e)};N.fromJSON=function(e,t){if(!t||!t.type)throw new RangeError("Invalid input for Selection.fromJSON");var n=Cn[t.type];if(!n)throw new RangeError("No selection type "+t.type+" defined");return n.fromJSON(e,t)};N.jsonID=function(e,t){if(e in Cn)throw new RangeError("Duplicate use of selection JSON ID "+e);return Cn[e]=t,t.prototype.jsonID=e,t};N.prototype.getBookmark=function(){return I.between(this.$anchor,this.$head).getBookmark()};Object.defineProperties(N.prototype,We);N.prototype.visible=!0;var oi=function(e,t){this.$from=e,this.$to=t},I=function(r){function e(n,o){o===void 0&&(o=n),r.call(this,n,o)}r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e;var t={$cursor:{configurable:!0}};return t.$cursor.get=function(){return this.$anchor.pos==this.$head.pos?this.$head:null},e.prototype.map=function(o,i){var s=o.resolve(i.map(this.head));if(!s.parent.inlineContent)return r.near(s);var a=o.resolve(i.map(this.anchor));return new e(a.parent.inlineContent?a:s,s)},e.prototype.replace=function(o,i){if(i===void 0&&(i=k.empty),r.prototype.replace.call(this,o,i),i==k.empty){var s=this.$from.marksAcross(this.$to);s&&o.ensureMarks(s)}},e.prototype.eq=function(o){return o instanceof e&&o.anchor==this.anchor&&o.head==this.head},e.prototype.getBookmark=function(){return new _t(this.anchor,this.head)},e.prototype.toJSON=function(){return{type:"text",anchor:this.anchor,head:this.head}},e.fromJSON=function(o,i){if(typeof i.anchor!="number"||typeof i.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new e(o.resolve(i.anchor),o.resolve(i.head))},e.create=function(o,i,s){s===void 0&&(s=i);var a=o.resolve(i);return new this(a,s==i?a:o.resolve(s))},e.between=function(o,i,s){var a=o.pos-i.pos;if((!s||a)&&(s=a>=0?1:-1),!i.parent.inlineContent){var l=r.findFrom(i,s,!0)||r.findFrom(i,-s,!0);if(l)i=l.$head;else return r.near(i,s)}return o.parent.inlineContent||(a==0?o=i:(o=(r.findFrom(o,-s,!0)||r.findFrom(o,s,!0)).$anchor,o.pos<i.pos!=a<0&&(o=i))),new e(o,i)},Object.defineProperties(e.prototype,t),e}(N);N.jsonID("text",I);var _t=function(e,t){this.anchor=e,this.head=t};_t.prototype.map=function(e){return new _t(e.map(this.anchor),e.map(this.head))};_t.prototype.resolve=function(e){return I.between(e.resolve(this.anchor),e.resolve(this.head))};var x=function(r){function e(t){var n=t.nodeAfter,o=t.node(0).resolve(t.pos+n.nodeSize);r.call(this,t,o),this.node=n}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.map=function(n,o){var i=o.mapResult(this.anchor),s=i.deleted,a=i.pos,l=n.resolve(a);return s?r.near(l):new e(l)},e.prototype.content=function(){return new k(m.from(this.node),0,0)},e.prototype.eq=function(n){return n instanceof e&&n.anchor==this.anchor},e.prototype.toJSON=function(){return{type:"node",anchor:this.anchor}},e.prototype.getBookmark=function(){return new Mr(this.anchor)},e.fromJSON=function(n,o){if(typeof o.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new e(n.resolve(o.anchor))},e.create=function(n,o){return new this(n.resolve(o))},e.isSelectable=function(n){return!n.isText&&n.type.spec.selectable!==!1},e}(N);x.prototype.visible=!1;N.jsonID("node",x);var Mr=function(e){this.anchor=e};Mr.prototype.map=function(e){var t=e.mapResult(this.anchor),n=t.deleted,o=t.pos;return n?new _t(o,o):new Mr(o)};Mr.prototype.resolve=function(e){var t=e.resolve(this.anchor),n=t.nodeAfter;return n&&x.isSelectable(n)?new x(t):N.near(t)};var be=function(r){function e(t){r.call(this,t.resolve(0),t.resolve(t.content.size))}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.replace=function(n,o){if(o===void 0&&(o=k.empty),o==k.empty){n.delete(0,n.doc.content.size);var i=r.atStart(n.doc);i.eq(n.selection)||n.setSelection(i)}else r.prototype.replace.call(this,n,o)},e.prototype.toJSON=function(){return{type:"all"}},e.fromJSON=function(n){return new e(n)},e.prototype.map=function(n){return new e(n)},e.prototype.eq=function(n){return n instanceof e},e.prototype.getBookmark=function(){return il},e}(N);N.jsonID("all",be);var il={map:function(){return this},resolve:function(e){return new be(e)}};function yt(r,e,t,n,o,i){if(e.inlineContent)return I.create(r,t);for(var s=n-(o>0?0:1);o>0?s<e.childCount:s>=0;s+=o){var a=e.child(s);if(a.isAtom){if(!i&&x.isSelectable(a))return x.create(r,t-(o<0?a.nodeSize:0))}else{var l=yt(r,a,t+o,o<0?a.childCount:0,o,i);if(l)return l}t+=a.nodeSize*o}}function ii(r,e,t){var n=r.steps.length-1;if(!(n<e)){var o=r.steps[n];if(o instanceof Fe||o instanceof oe){var i=r.mapping.maps[n],s;i.forEach(function(a,l,f,u){s==null&&(s=u)}),r.setSelection(N.near(r.doc.resolve(s),t))}}}var si=1,Cr=2,ai=4,li=function(r){function e(n){r.call(this,n.doc),this.time=Date.now(),this.curSelection=n.selection,this.curSelectionFor=0,this.storedMarks=n.storedMarks,this.updated=0,this.meta=Object.create(null)}r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e;var t={selection:{configurable:!0},selectionSet:{configurable:!0},storedMarksSet:{configurable:!0},isGeneric:{configurable:!0},scrolledIntoView:{configurable:!0}};return t.selection.get=function(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection},e.prototype.setSelection=function(o){if(o.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=o,this.curSelectionFor=this.steps.length,this.updated=(this.updated|si)&~Cr,this.storedMarks=null,this},t.selectionSet.get=function(){return(this.updated&si)>0},e.prototype.setStoredMarks=function(o){return this.storedMarks=o,this.updated|=Cr,this},e.prototype.ensureMarks=function(o){return w.sameSet(this.storedMarks||this.selection.$from.marks(),o)||this.setStoredMarks(o),this},e.prototype.addStoredMark=function(o){return this.ensureMarks(o.addToSet(this.storedMarks||this.selection.$head.marks()))},e.prototype.removeStoredMark=function(o){return this.ensureMarks(o.removeFromSet(this.storedMarks||this.selection.$head.marks()))},t.storedMarksSet.get=function(){return(this.updated&Cr)>0},e.prototype.addStep=function(o,i){r.prototype.addStep.call(this,o,i),this.updated=this.updated&~Cr,this.storedMarks=null},e.prototype.setTime=function(o){return this.time=o,this},e.prototype.replaceSelection=function(o){return this.selection.replace(this,o),this},e.prototype.replaceSelectionWith=function(o,i){var s=this.selection;return i!==!1&&(o=o.mark(this.storedMarks||(s.empty?s.$from.marks():s.$from.marksAcross(s.$to)||w.none))),s.replaceWith(this,o),this},e.prototype.deleteSelection=function(){return this.selection.replace(this),this},e.prototype.insertText=function(o,i,s){s===void 0&&(s=i);var a=this.doc.type.schema;if(i==null)return o?this.replaceSelectionWith(a.text(o),!0):this.deleteSelection();if(!o)return this.deleteRange(i,s);var l=this.storedMarks;if(!l){var f=this.doc.resolve(i);l=s==i?f.marks():f.marksAcross(this.doc.resolve(s))}return this.replaceRangeWith(i,s,a.text(o,l)),this.selection.empty||this.setSelection(N.near(this.selection.$to)),this},e.prototype.setMeta=function(o,i){return this.meta[typeof o=="string"?o:o.key]=i,this},e.prototype.getMeta=function(o){return this.meta[typeof o=="string"?o:o.key]},t.isGeneric.get=function(){for(var n in this.meta)return!1;return!0},e.prototype.scrollIntoView=function(){return this.updated|=ai,this},t.scrolledIntoView.get=function(){return(this.updated&ai)>0},Object.defineProperties(e.prototype,t),e}(B);function fi(r,e){return!e||!r?r:r.bind(e)}var Vt=function(e,t,n){this.name=e,this.init=fi(t.init,n),this.apply=fi(t.apply,n)},sl=[new Vt("doc",{init:function(e){return e.doc||e.schema.topNodeType.createAndFill()},apply:function(e){return e.doc}}),new Vt("selection",{init:function(e,t){return e.selection||N.atStart(t.doc)},apply:function(e){return e.selection}}),new Vt("storedMarks",{init:function(e){return e.storedMarks||null},apply:function(e,t,n,o){return o.selection.$cursor?e.storedMarks:null}}),new Vt("scrollToSelection",{init:function(){return 0},apply:function(e,t){return e.scrolledIntoView?t+1:t}})],xn=function(e,t){var n=this;this.schema=e,this.fields=sl.concat(),this.plugins=[],this.pluginsByKey=Object.create(null),t&&t.forEach(function(o){if(n.pluginsByKey[o.key])throw new RangeError("Adding different instances of a keyed plugin ("+o.key+")");n.plugins.push(o),n.pluginsByKey[o.key]=o,o.spec.state&&n.fields.push(new Vt(o.key,o.spec.state,o))})},J=function(e){this.config=e},xr={schema:{configurable:!0},plugins:{configurable:!0},tr:{configurable:!0}};xr.schema.get=function(){return this.config.schema};xr.plugins.get=function(){return this.config.plugins};J.prototype.apply=function(e){return this.applyTransaction(e).state};J.prototype.filterTransaction=function(e,t){t===void 0&&(t=-1);for(var n=0;n<this.config.plugins.length;n++)if(n!=t){var o=this.config.plugins[n];if(o.spec.filterTransaction&&!o.spec.filterTransaction.call(o,e,this))return!1}return!0};J.prototype.applyTransaction=function(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};for(var t=[e],n=this.applyInner(e),o=null;;){for(var i=!1,s=0;s<this.config.plugins.length;s++){var a=this.config.plugins[s];if(a.spec.appendTransaction){var l=o?o[s].n:0,f=o?o[s].state:this,u=l<t.length&&a.spec.appendTransaction.call(a,l?t.slice(l):t,f,n);if(u&&n.filterTransaction(u,s)){if(u.setMeta("appendedTransaction",e),!o){o=[];for(var c=0;c<this.config.plugins.length;c++)o.push(c<s?{state:n,n:t.length}:{state:this,n:0})}t.push(u),n=n.applyInner(u),i=!0}o&&(o[s]={state:n,n:t.length})}}if(!i)return{state:n,transactions:t}}};J.prototype.applyInner=function(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");for(var t=new J(this.config),n=this.config.fields,o=0;o<n.length;o++){var i=n[o];t[i.name]=i.apply(e,this[i.name],this,t)}for(var s=0;s<qt.length;s++)qt[s](this,e,t);return t};xr.tr.get=function(){return new li(this)};J.create=function(e){for(var t=new xn(e.doc?e.doc.type.schema:e.schema,e.plugins),n=new J(t),o=0;o<t.fields.length;o++)n[t.fields[o].name]=t.fields[o].init(e,n);return n};J.prototype.reconfigure=function(e){for(var t=new xn(this.schema,e.plugins),n=t.fields,o=new J(t),i=0;i<n.length;i++){var s=n[i].name;o[s]=this.hasOwnProperty(s)?this[s]:n[i].init(e,o)}return o};J.prototype.toJSON=function(e){var t={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(t.storedMarks=this.storedMarks.map(function(s){return s.toJSON()})),e&&typeof e=="object")for(var n in e){if(n=="doc"||n=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");var o=e[n],i=o.spec.state;i&&i.toJSON&&(t[n]=i.toJSON.call(o,this[o.key]))}return t};J.fromJSON=function(e,t,n){if(!t)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");var o=new xn(e.schema,e.plugins),i=new J(o);return o.fields.forEach(function(s){if(s.name=="doc")i.doc=D.fromJSON(e.schema,t.doc);else if(s.name=="selection")i.selection=N.fromJSON(i.doc,t.selection);else if(s.name=="storedMarks")t.storedMarks&&(i.storedMarks=t.storedMarks.map(e.schema.markFromJSON));else{if(n)for(var a in n){var l=n[a],f=l.spec.state;if(l.key==s.name&&f&&f.fromJSON&&Object.prototype.hasOwnProperty.call(t,a)){i[s.name]=f.fromJSON.call(l,e,t[a],i);return}}i[s.name]=s.init(e,i)}}),i};J.addApplyListener=function(e){qt.push(e)};J.removeApplyListener=function(e){var t=qt.indexOf(e);t>-1&&qt.splice(t,1)};Object.defineProperties(J.prototype,xr);var qt=[];function ui(r,e,t){for(var n in r){var o=r[n];o instanceof Function?o=o.bind(e):n=="handleDOMEvents"&&(o=ui(o,e,{})),t[n]=o}return t}var W=function(e){this.props={},e.props&&ui(e.props,this,this.props),this.spec=e,this.key=e.key?e.key.key:ci("plugin")};W.prototype.getState=function(e){return e[this.key]};var On=Object.create(null);function ci(r){return r in On?r+"$"+ ++On[r]:(On[r]=0,r+"$")}var bt=function(e){e===void 0&&(e="key"),this.key=ci(e)};bt.prototype.get=function(e){return e.config.pluginsByKey[this.key]};bt.prototype.getState=function(e){return e[this.key]};var Br={};Ze(Br,{Decoration:()=>_,DecorationSet:()=>E,EditorView:()=>V,__endComposition:()=>Gt,__parseFromClipboard:()=>Jn,__serializeForClipboard:()=>Ln});var g={};typeof navigator!="undefined"&&typeof document!="undefined"&&(wr=/Edge\/(\d+)/.exec(navigator.userAgent),wn=/MSIE \d/.test(navigator.userAgent),Nr=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),Dr=g.ie=!!(wn||Nr||wr),g.ie_version=wn?document.documentMode||6:Nr?+Nr[1]:wr?+wr[1]:null,g.gecko=!Dr&&/gecko\/(\d+)/i.test(navigator.userAgent),g.gecko_version=g.gecko&&+(/Firefox\/(\d+)/.exec(navigator.userAgent)||[0,0])[1],Tr=!Dr&&/Chrome\/(\d+)/.exec(navigator.userAgent),g.chrome=!!Tr,g.chrome_version=Tr&&+Tr[1],g.safari=!Dr&&/Apple Computer/.test(navigator.vendor),g.ios=g.safari&&(/Mobile\/\w+/.test(navigator.userAgent)||navigator.maxTouchPoints>2),g.mac=g.ios||/Mac/.test(navigator.platform),g.android=/Android \d/.test(navigator.userAgent),g.webkit="webkitFontSmoothing"in document.documentElement.style,g.webkit_version=g.webkit&&+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]);var wr,wn,Nr,Dr,Tr,me=function(r){for(var e=0;;e++)if(r=r.previousSibling,!r)return e},Nn=function(r){var e=r.assignedSlot||r.parentNode;return e&&e.nodeType==11?e.host:e},pi=null,Be=function(r,e,t){var n=pi||(pi=document.createRange());return n.setEnd(r,t==null?r.nodeValue.length:t),n.setStart(r,e||0),n},Lt=function(r,e,t,n){return t&&(hi(r,e,t,n,-1)||hi(r,e,t,n,1))},al=/^(img|br|input|textarea|hr)$/i;function hi(r,e,t,n,o){for(;;){if(r==t&&e==n)return!0;if(e==(o<0?0:Ee(r))){var i=r.parentNode;if(!i||i.nodeType!=1||fl(r)||al.test(r.nodeName)||r.contentEditable=="false")return!1;e=me(r)+(o<0?0:1),r=i}else if(r.nodeType==1){if(r=r.childNodes[e+(o<0?-1:0)],r.contentEditable=="false")return!1;e=o<0?Ee(r):0}else return!1}}function Ee(r){return r.nodeType==3?r.nodeValue.length:r.childNodes.length}function ll(r,e,t){for(var n=e==0,o=e==Ee(r);n||o;){if(r==t)return!0;var i=me(r);if(r=r.parentNode,!r)return!1;n=n&&i==0,o=o&&i==Ee(r)}}function fl(r){for(var e,t=r;t&&!(e=t.pmViewDesc);t=t.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==r||e.contentDOM==r)}var Dn=function(r){var e=r.isCollapsed;return e&&g.chrome&&r.rangeCount&&!r.getRangeAt(0).collapsed&&(e=!1),e};function kt(r,e){var t=document.createEvent("Event");return t.initEvent("keydown",!0,!0),t.keyCode=r,t.key=t.code=e,t}function ul(r){return{left:0,right:r.documentElement.clientWidth,top:0,bottom:r.documentElement.clientHeight}}function He(r,e){return typeof r=="number"?r:r[e]}function cl(r){var e=r.getBoundingClientRect(),t=e.width/r.offsetWidth||1,n=e.height/r.offsetHeight||1;return{left:e.left,right:e.left+r.clientWidth*t,top:e.top,bottom:e.top+r.clientHeight*n}}function di(r,e,t){for(var n=r.someProp("scrollThreshold")||0,o=r.someProp("scrollMargin")||5,i=r.dom.ownerDocument,s=t||r.dom;s;s=Nn(s))if(s.nodeType==1){var a=s==i.body||s.nodeType!=1,l=a?ul(i):cl(s),f=0,u=0;if(e.top<l.top+He(n,"top")?u=-(l.top-e.top+He(o,"top")):e.bottom>l.bottom-He(n,"bottom")&&(u=e.bottom-l.bottom+He(o,"bottom")),e.left<l.left+He(n,"left")?f=-(l.left-e.left+He(o,"left")):e.right>l.right-He(n,"right")&&(f=e.right-l.right+He(o,"right")),f||u)if(a)i.defaultView.scrollBy(f,u);else{var c=s.scrollLeft,p=s.scrollTop;u&&(s.scrollTop+=u),f&&(s.scrollLeft+=f);var h=s.scrollLeft-c,d=s.scrollTop-p;e={left:e.left-h,top:e.top-d,right:e.right-h,bottom:e.bottom-d}}if(a)break}}function pl(r){for(var e=r.dom.getBoundingClientRect(),t=Math.max(0,e.top),n,o,i=(e.left+e.right)/2,s=t+1;s<Math.min(innerHeight,e.bottom);s+=5){var a=r.root.elementFromPoint(i,s);if(!(a==r.dom||!r.dom.contains(a))){var l=a.getBoundingClientRect();if(l.top>=t-20){n=a,o=l.top;break}}}return{refDOM:n,refTop:o,stack:mi(r.dom)}}function mi(r){for(var e=[],t=r.ownerDocument;r&&(e.push({dom:r,top:r.scrollTop,left:r.scrollLeft}),r!=t);r=Nn(r));return e}function hl(r){var e=r.refDOM,t=r.refTop,n=r.stack,o=e?e.getBoundingClientRect().top:0;vi(n,o==0?0:o-t)}function vi(r,e){for(var t=0;t<r.length;t++){var n=r[t],o=n.dom,i=n.top,s=n.left;o.scrollTop!=i+e&&(o.scrollTop=i+e),o.scrollLeft!=s&&(o.scrollLeft=s)}}var St=null;function dl(r){if(r.setActive)return r.setActive();if(St)return r.focus(St);var e=mi(r);r.focus(St==null?{get preventScroll(){return St={preventScroll:!0},!0}}:void 0),St||(St=!1,vi(e,0))}function gi(r,e){for(var t,n=2e8,o,i=0,s=e.top,a=e.top,l=r.firstChild,f=0;l;l=l.nextSibling,f++){var u=void 0;if(l.nodeType==1)u=l.getClientRects();else if(l.nodeType==3)u=Be(l).getClientRects();else continue;for(var c=0;c<u.length;c++){var p=u[c];if(p.top<=s&&p.bottom>=a){s=Math.max(p.bottom,s),a=Math.min(p.top,a);var h=p.left>e.left?p.left-e.left:p.right<e.left?e.left-p.right:0;if(h<n){t=l,n=h,o=h&&t.nodeType==3?{left:p.right<e.left?p.right:p.left,top:e.top}:e,l.nodeType==1&&h&&(i=f+(e.left>=(p.left+p.right)/2?1:0));continue}}!t&&(e.left>=p.right&&e.top>=p.top||e.left>=p.left&&e.top>=p.bottom)&&(i=f+1)}}return t&&t.nodeType==3?ml(t,o):!t||n&&t.nodeType==1?{node:r,offset:i}:gi(t,o)}function ml(r,e){for(var t=r.nodeValue.length,n=document.createRange(),o=0;o<t;o++){n.setEnd(r,o+1),n.setStart(r,o);var i=Ke(n,1);if(i.top!=i.bottom&&Tn(e,i))return{node:r,offset:o+(e.left>=(i.left+i.right)/2?1:0)}}return{node:r,offset:0}}function Tn(r,e){return r.left>=e.left-1&&r.left<=e.right+1&&r.top>=e.top-1&&r.top<=e.bottom+1}function vl(r,e){var t=r.parentNode;return t&&/^li$/i.test(t.nodeName)&&e.left<r.getBoundingClientRect().left?t:r}function gl(r,e,t){var n=gi(e,t),o=n.node,i=n.offset,s=-1;if(o.nodeType==1&&!o.firstChild){var a=o.getBoundingClientRect();s=a.left!=a.right&&t.left>(a.left+a.right)/2?1:-1}return r.docView.posFromDOM(o,i,s)}function yl(r,e,t,n){for(var o=-1,i=e;i!=r.dom;){var s=r.docView.nearestDesc(i,!0);if(!s)return null;if(s.node.isBlock&&s.parent){var a=s.dom.getBoundingClientRect();if(a.left>n.left||a.top>n.top)o=s.posBefore;else if(a.right<n.left||a.bottom<n.top)o=s.posAfter;else break}i=s.dom.parentNode}return o>-1?o:r.docView.posFromDOM(e,t)}function yi(r,e,t){var n=r.childNodes.length;if(n&&t.top<t.bottom)for(var o=Math.max(0,Math.min(n-1,Math.floor(n*(e.top-t.top)/(t.bottom-t.top))-2)),i=o;;){var s=r.childNodes[i];if(s.nodeType==1)for(var a=s.getClientRects(),l=0;l<a.length;l++){var f=a[l];if(Tn(e,f))return yi(s,e,f)}if((i=(i+1)%n)==o)break}return r}function bl(r,e){var t,n,o=r.dom.ownerDocument,i,s;if(o.caretPositionFromPoint)try{var a=o.caretPositionFromPoint(e.left,e.top);a&&(t=a,i=t.offsetNode,s=t.offset)}catch(b){}if(!i&&o.caretRangeFromPoint){var l=o.caretRangeFromPoint(e.left,e.top);l&&(n=l,i=n.startContainer,s=n.startOffset)}var f=(r.root.elementFromPoint?r.root:o).elementFromPoint(e.left,e.top+1),u;if(!f||!r.dom.contains(f.nodeType!=1?f.parentNode:f)){var c=r.dom.getBoundingClientRect();if(!Tn(e,c)||(f=yi(r.dom,e,c),!f))return null}if(g.safari)for(var p=f;i&&p;p=Nn(p))p.draggable&&(i=s=null);if(f=vl(f,e),i){if(g.gecko&&i.nodeType==1&&(s=Math.min(s,i.childNodes.length),s<i.childNodes.length)){var h=i.childNodes[s],d;h.nodeName=="IMG"&&(d=h.getBoundingClientRect()).right<=e.left&&d.bottom>e.top&&s++}i==r.dom&&s==i.childNodes.length-1&&i.lastChild.nodeType==1&&e.top>i.lastChild.getBoundingClientRect().bottom?u=r.state.doc.content.size:(s==0||i.nodeType!=1||i.childNodes[s-1].nodeName!="BR")&&(u=yl(r,i,s,e))}u==null&&(u=gl(r,f,e));var v=r.docView.nearestDesc(f,!0);return{pos:u,inside:v?v.posAtStart-v.border:-1}}function Ke(r,e){var t=r.getClientRects();return t.length?t[e<0?0:t.length-1]:r.getBoundingClientRect()}var kl=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function bi(r,e,t){var n=r.docView.domFromPos(e,t<0?-1:1),o=n.node,i=n.offset,s=g.webkit||g.gecko;if(o.nodeType==3)if(s&&(kl.test(o.nodeValue)||(t<0?!i:i==o.nodeValue.length))){var a=Ke(Be(o,i,i),t);if(g.gecko&&i&&/\s/.test(o.nodeValue[i-1])&&i<o.nodeValue.length){var l=Ke(Be(o,i-1,i-1),-1);if(l.top==a.top){var f=Ke(Be(o,i,i+1),-1);if(f.top!=a.top)return Jt(f,f.left<l.left)}}return a}else{var u=i,c=i,p=t<0?1:-1;return t<0&&!i?(c++,p=-1):t>=0&&i==o.nodeValue.length?(u--,p=1):t<0?u--:c++,Jt(Ke(Be(o,u,c),p),p<0)}if(!r.state.doc.resolve(e).parent.inlineContent){if(i&&(t<0||i==Ee(o))){var h=o.childNodes[i-1];if(h.nodeType==1)return En(h.getBoundingClientRect(),!1)}if(i<Ee(o)){var d=o.childNodes[i];if(d.nodeType==1)return En(d.getBoundingClientRect(),!0)}return En(o.getBoundingClientRect(),t>=0)}if(i&&(t<0||i==Ee(o))){var v=o.childNodes[i-1],b=v.nodeType==3?Be(v,Ee(v)-(s?0:1)):v.nodeType==1&&(v.nodeName!="BR"||!v.nextSibling)?v:null;if(b)return Jt(Ke(b,1),!1)}if(i<Ee(o)){for(var S=o.childNodes[i];S.pmViewDesc&&S.pmViewDesc.ignoreForCoords;)S=S.nextSibling;var y=S?S.nodeType==3?Be(S,0,s?0:1):S.nodeType==1?S:null:null;if(y)return Jt(Ke(y,-1),!0)}return Jt(Ke(o.nodeType==3?Be(o):o,-t),t>=0)}function Jt(r,e){if(r.width==0)return r;var t=e?r.left:r.right;return{top:r.top,bottom:r.bottom,left:t,right:t}}function En(r,e){if(r.height==0)return r;var t=e?r.top:r.bottom;return{top:t,bottom:t,left:r.left,right:r.right}}function ki(r,e,t){var n=r.state,o=r.root.activeElement;n!=e&&r.updateState(e),o!=r.dom&&r.focus();try{return t()}finally{n!=e&&r.updateState(n),o!=r.dom&&o&&o.focus()}}function Sl(r,e,t){var n=e.selection,o=t=="up"?n.$from:n.$to;return ki(r,e,function(){for(var i=r.docView.domFromPos(o.pos,t=="up"?-1:1),s=i.node;;){var a=r.docView.nearestDesc(s,!0);if(!a)break;if(a.node.isBlock){s=a.dom;break}s=a.dom.parentNode}for(var l=bi(r,o.pos,1),f=s.firstChild;f;f=f.nextSibling){var u=void 0;if(f.nodeType==1)u=f.getClientRects();else if(f.nodeType==3)u=Be(f,0,f.nodeValue.length).getClientRects();else continue;for(var c=0;c<u.length;c++){var p=u[c];if(p.bottom>p.top+1&&(t=="up"?l.top-p.top>(p.bottom-l.top)*2:p.bottom-l.bottom>(l.bottom-p.top)*2))return!1}}return!0})}var Ml=/[\u0590-\u08ac]/;function Cl(r,e,t){var n=e.selection,o=n.$head;if(!o.parent.isTextblock)return!1;var i=o.parentOffset,s=!i,a=i==o.parent.content.size,l=r.root.getSelection();return!Ml.test(o.parent.textContent)||!l.modify?t=="left"||t=="backward"?s:a:ki(r,e,function(){var f=l.getRangeAt(0),u=l.focusNode,c=l.focusOffset,p=l.caretBidiLevel;l.modify("move",t,"character");var h=o.depth?r.docView.domAfterPos(o.before()):r.dom,d=!h.contains(l.focusNode.nodeType==1?l.focusNode:l.focusNode.parentNode)||u==l.focusNode&&c==l.focusOffset;return l.removeAllRanges(),l.addRange(f),p!=null&&(l.caretBidiLevel=p),d})}var Si=null,Mi=null,Ci=!1;function xl(r,e,t){return Si==e&&Mi==t?Ci:(Si=e,Mi=t,Ci=t=="up"||t=="down"?Sl(r,e,t):Cl(r,e,t))}var we=0,xi=1,Wt=2,_e=3,A=function(e,t,n,o){this.parent=e,this.children=t,this.dom=n,n.pmViewDesc=this,this.contentDOM=o,this.dirty=we},Ie={size:{configurable:!0},border:{configurable:!0},posBefore:{configurable:!0},posAtStart:{configurable:!0},posAfter:{configurable:!0},posAtEnd:{configurable:!0},contentLost:{configurable:!0},domAtom:{configurable:!0},ignoreForCoords:{configurable:!0}};A.prototype.matchesWidget=function(){return!1};A.prototype.matchesMark=function(){return!1};A.prototype.matchesNode=function(){return!1};A.prototype.matchesHack=function(e){return!1};A.prototype.parseRule=function(){return null};A.prototype.stopEvent=function(){return!1};Ie.size.get=function(){for(var r=0,e=0;e<this.children.length;e++)r+=this.children[e].size;return r};Ie.border.get=function(){return 0};A.prototype.destroy=function(){this.parent=null,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=null);for(var e=0;e<this.children.length;e++)this.children[e].destroy()};A.prototype.posBeforeChild=function(e){for(var t=0,n=this.posAtStart;t<this.children.length;t++){var o=this.children[t];if(o==e)return n;n+=o.size}};Ie.posBefore.get=function(){return this.parent.posBeforeChild(this)};Ie.posAtStart.get=function(){return this.parent?this.parent.posBeforeChild(this)+this.border:0};Ie.posAfter.get=function(){return this.posBefore+this.size};Ie.posAtEnd.get=function(){return this.posAtStart+this.size-2*this.border};A.prototype.localPosFromDOM=function(e,t,n){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(n<0){var o,i;if(e==this.contentDOM)o=e.childNodes[t-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;o=e.previousSibling}for(;o&&!((i=o.pmViewDesc)&&i.parent==this);)o=o.previousSibling;return o?this.posBeforeChild(i)+i.size:this.posAtStart}else{var s,a;if(e==this.contentDOM)s=e.childNodes[t];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;s=e.nextSibling}for(;s&&!((a=s.pmViewDesc)&&a.parent==this);)s=s.nextSibling;return s?this.posBeforeChild(a):this.posAtEnd}var l;if(e==this.dom&&this.contentDOM)l=t>me(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))l=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(t==0)for(var f=e;;f=f.parentNode){if(f==this.dom){l=!1;break}if(f.parentNode.firstChild!=f)break}if(l==null&&t==e.childNodes.length)for(var u=e;;u=u.parentNode){if(u==this.dom){l=!0;break}if(u.parentNode.lastChild!=u)break}}return(l==null?n>0:l)?this.posAtEnd:this.posAtStart};A.prototype.nearestDesc=function(e,t){for(var n=!0,o=e;o;o=o.parentNode){var i=this.getDesc(o);if(i&&(!t||i.node))if(n&&i.nodeDOM&&!(i.nodeDOM.nodeType==1?i.nodeDOM.contains(e.nodeType==1?e:e.parentNode):i.nodeDOM==e))n=!1;else return i}};A.prototype.getDesc=function(e){for(var t=e.pmViewDesc,n=t;n;n=n.parent)if(n==this)return t};A.prototype.posFromDOM=function(e,t,n){for(var o=e;o;o=o.parentNode){var i=this.getDesc(o);if(i)return i.localPosFromDOM(e,t,n)}return-1};A.prototype.descAt=function(e){for(var t=0,n=0;t<this.children.length;t++){var o=this.children[t],i=n+o.size;if(n==e&&i!=n){for(;!o.border&&o.children.length;)o=o.children[0];return o}if(e<i)return o.descAt(e-n-o.border);n=i}};A.prototype.domFromPos=function(e,t){if(!this.contentDOM)return{node:this.dom,offset:0};for(var n=0,o=0,i=0;n<this.children.length;n++){var s=this.children[n],a=i+s.size;if(a>e||s instanceof Di){o=e-i;break}i=a}if(o)return this.children[n].domFromPos(o-this.children[n].border,t);for(var l=void 0;n&&!(l=this.children[n-1]).size&&l instanceof Oi&&l.widget.type.side>=0;n--);if(t<=0){for(var f,u=!0;f=n?this.children[n-1]:null,!(!f||f.dom.parentNode==this.contentDOM);n--,u=!1);return f&&t&&u&&!f.border&&!f.domAtom?f.domFromPos(f.size,t):{node:this.contentDOM,offset:f?me(f.dom)+1:0}}else{for(var c,p=!0;c=n<this.children.length?this.children[n]:null,!(!c||c.dom.parentNode==this.contentDOM);n++,p=!1);return c&&p&&!c.border&&!c.domAtom?c.domFromPos(0,t):{node:this.contentDOM,offset:c?me(c.dom):this.contentDOM.childNodes.length}}};A.prototype.parseRange=function(e,t,n){if(n===void 0&&(n=0),this.children.length==0)return{node:this.contentDOM,from:e,to:t,fromOffset:0,toOffset:this.contentDOM.childNodes.length};for(var o=-1,i=-1,s=n,a=0;;a++){var l=this.children[a],f=s+l.size;if(o==-1&&e<=f){var u=s+l.border;if(e>=u&&t<=f-l.border&&l.node&&l.contentDOM&&this.contentDOM.contains(l.contentDOM))return l.parseRange(e,t,u);e=s;for(var c=a;c>0;c--){var p=this.children[c-1];if(p.size&&p.dom.parentNode==this.contentDOM&&!p.emptyChildAt(1)){o=me(p.dom)+1;break}e-=p.size}o==-1&&(o=0)}if(o>-1&&(f>t||a==this.children.length-1)){t=f;for(var h=a+1;h<this.children.length;h++){var d=this.children[h];if(d.size&&d.dom.parentNode==this.contentDOM&&!d.emptyChildAt(-1)){i=me(d.dom);break}t+=d.size}i==-1&&(i=this.contentDOM.childNodes.length);break}s=f}return{node:this.contentDOM,from:e,to:t,fromOffset:o,toOffset:i}};A.prototype.emptyChildAt=function(e){if(this.border||!this.contentDOM||!this.children.length)return!1;var t=this.children[e<0?0:this.children.length-1];return t.size==0||t.emptyChildAt(e)};A.prototype.domAfterPos=function(e){var t=this.domFromPos(e,0),n=t.node,o=t.offset;if(n.nodeType!=1||o==n.childNodes.length)throw new RangeError("No node after pos "+e);return n.childNodes[o]};A.prototype.setSelection=function(e,t,n,o){for(var i=Math.min(e,t),s=Math.max(e,t),a=0,l=0;a<this.children.length;a++){var f=this.children[a],u=l+f.size;if(i>l&&s<u)return f.setSelection(e-l-f.border,t-l-f.border,n,o);l=u}var c=this.domFromPos(e,e?-1:1),p=t==e?c:this.domFromPos(t,t?-1:1),h=n.getSelection(),d=!1;if((g.gecko||g.safari)&&e==t){var v=c.node,b=c.offset;if(v.nodeType==3){if(d=b&&v.nodeValue[b-1]==`
`,d&&b==v.nodeValue.length)for(var S=v,y=void 0;S;S=S.parentNode){if(y=S.nextSibling){y.nodeName=="BR"&&(c=p={node:y.parentNode,offset:me(y)+1});break}var O=S.pmViewDesc;if(O&&O.node&&O.node.isBlock)break}}else{var M=v.childNodes[b-1];d=M&&(M.nodeName=="BR"||M.contentEditable=="false")}}if(g.gecko&&h.focusNode&&h.focusNode!=p.node&&h.focusNode.nodeType==1){var C=h.focusNode.childNodes[h.focusOffset];C&&C.contentEditable=="false"&&(o=!0)}if(!(!(o||d&&g.safari)&&Lt(c.node,c.offset,h.anchorNode,h.anchorOffset)&&Lt(p.node,p.offset,h.focusNode,h.focusOffset))){var T=!1;if((h.extend||e==t)&&!d){h.collapse(c.node,c.offset);try{e!=t&&h.extend(p.node,p.offset),T=!0}catch(H){if(!(H instanceof DOMException))throw H}}if(!T){if(e>t){var P=c;c=p,p=P}var F=document.createRange();F.setEnd(p.node,p.offset),F.setStart(c.node,c.offset),h.removeAllRanges(),h.addRange(F)}}};A.prototype.ignoreMutation=function(e){return!this.contentDOM&&e.type!="selection"};Ie.contentLost.get=function(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)};A.prototype.markDirty=function(e,t){for(var n=0,o=0;o<this.children.length;o++){var i=this.children[o],s=n+i.size;if(n==s?e<=s&&t>=n:e<s&&t>n){var a=n+i.border,l=s-i.border;if(e>=a&&t<=l){this.dirty=e==n||t==s?Wt:xi,e==a&&t==l&&(i.contentLost||i.dom.parentNode!=this.contentDOM)?i.dirty=_e:i.markDirty(e-a,t-a);return}else i.dirty=i.dom==i.contentDOM&&i.dom.parentNode==this.contentDOM&&!i.children.length?Wt:_e}n=s}this.dirty=Wt};A.prototype.markParentsDirty=function(){for(var e=1,t=this.parent;t;t=t.parent,e++){var n=e==1?Wt:xi;t.dirty<n&&(t.dirty=n)}};Ie.domAtom.get=function(){return!1};Ie.ignoreForCoords.get=function(){return!1};Object.defineProperties(A.prototype,Ie);var Ue=[],Oi=function(r){function e(n,o,i,s){var a,l=o.type.toDOM;if(typeof l=="function"&&(l=l(i,function(){if(!a)return s;if(a.parent)return a.parent.posBeforeChild(a)})),!o.type.spec.raw){if(l.nodeType!=1){var f=document.createElement("span");f.appendChild(l),l=f}l.contentEditable=!1,l.classList.add("ProseMirror-widget")}r.call(this,n,Ue,l,null),this.widget=o,a=this}r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e;var t={domAtom:{configurable:!0}};return e.prototype.matchesWidget=function(o){return this.dirty==we&&o.type.eq(this.widget.type)},e.prototype.parseRule=function(){return{ignore:!0}},e.prototype.stopEvent=function(o){var i=this.widget.spec.stopEvent;return i?i(o):!1},e.prototype.ignoreMutation=function(o){return o.type!="selection"||this.widget.spec.ignoreSelection},e.prototype.destroy=function(){this.widget.type.destroy(this.dom),r.prototype.destroy.call(this)},t.domAtom.get=function(){return!0},Object.defineProperties(e.prototype,t),e}(A),Ol=function(r){function e(n,o,i,s){r.call(this,n,Ue,o,null),this.textDOM=i,this.text=s}r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e;var t={size:{configurable:!0}};return t.size.get=function(){return this.text.length},e.prototype.localPosFromDOM=function(o,i){return o!=this.textDOM?this.posAtStart+(i?this.size:0):this.posAtStart+i},e.prototype.domFromPos=function(o){return{node:this.textDOM,offset:o}},e.prototype.ignoreMutation=function(o){return o.type==="characterData"&&o.target.nodeValue==o.oldValue},Object.defineProperties(e.prototype,t),e}(A),Er=function(r){function e(t,n,o,i){r.call(this,t,[],o,i),this.mark=n}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.create=function(n,o,i,s){var a=s.nodeViews[o.type.name],l=a&&a(o,s,i);return(!l||!l.dom)&&(l=L.renderSpec(document,o.type.spec.toDOM(o,i))),new e(n,o,l.dom,l.contentDOM||l.dom)},e.prototype.parseRule=function(){return this.dirty&_e||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}},e.prototype.matchesMark=function(n){return this.dirty!=_e&&this.mark.eq(n)},e.prototype.markDirty=function(n,o){if(r.prototype.markDirty.call(this,n,o),this.dirty!=we){for(var i=this.parent;!i.node;)i=i.parent;i.dirty<this.dirty&&(i.dirty=this.dirty),this.dirty=we}},e.prototype.slice=function(n,o,i){var s=e.create(this.parent,this.mark,!0,i),a=this.children,l=this.size;o<l&&(a=Rn(a,o,l,i)),n>0&&(a=Rn(a,0,n,i));for(var f=0;f<a.length;f++)a[f].parent=s;return s.children=a,s},e}(A),Ht=function(r){function e(n,o,i,s,a,l,f,u,c){r.call(this,n,o.isLeaf?Ue:[],a,l),this.nodeDOM=f,this.node=o,this.outerDeco=i,this.innerDeco=s,l&&this.updateChildren(u,c)}r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e;var t={size:{configurable:!0},border:{configurable:!0},domAtom:{configurable:!0}};return e.create=function(o,i,s,a,l,f){var u,c=l.nodeViews[i.type.name],p,h=c&&c(i,l,function(){if(!p)return f;if(p.parent)return p.parent.posBeforeChild(p)},s,a),d=h&&h.dom,v=h&&h.contentDOM;if(i.isText){if(!d)d=document.createTextNode(i.text);else if(d.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else d||(u=L.renderSpec(document,i.type.spec.toDOM(i)),d=u.dom,v=u.contentDOM);!v&&!i.isText&&d.nodeName!="BR"&&(d.hasAttribute("contenteditable")||(d.contentEditable=!1),i.type.spec.draggable&&(d.draggable=!0));var b=d;return d=Ii(d,s,i),h?p=new wl(o,i,s,a,d,v,b,h,l,f+1):i.isText?new Ni(o,i,s,a,d,b,l):new e(o,i,s,a,d,v,b,l,f+1)},e.prototype.parseRule=function(){var o=this;if(this.node.type.spec.reparseInView)return null;var i={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(i.preserveWhitespace="full"),!this.contentDOM)i.getContent=function(){return o.node.content};else if(!this.contentLost)i.contentElement=this.contentDOM;else{for(var s=this.children.length-1;s>=0;s--){var a=this.children[s];if(this.dom.contains(a.dom.parentNode)){i.contentElement=a.dom.parentNode;break}}i.contentElement||(i.getContent=function(){return m.empty})}return i},e.prototype.matchesNode=function(o,i,s){return this.dirty==we&&o.eq(this.node)&&An(i,this.outerDeco)&&s.eq(this.innerDeco)},t.size.get=function(){return this.node.nodeSize},t.border.get=function(){return this.node.isLeaf?0:1},e.prototype.updateChildren=function(o,i){var s=this,a=this.node.inlineContent,l=i,f=o.composing&&this.localCompositionInfo(o,i),u=f&&f.pos>-1?f:null,c=f&&f.pos<0,p=new ke(this,u&&u.node);El(this.node,this.innerDeco,function(h,d,v){h.spec.marks?p.syncToMarks(h.spec.marks,a,o):h.type.side>=0&&!v&&p.syncToMarks(d==s.node.childCount?w.none:s.node.child(d).marks,a,o),p.placeWidget(h,o,l)},function(h,d,v,b){p.syncToMarks(h.marks,a,o);var S;p.findNodeMatch(h,d,v,b)||c&&o.state.selection.from>l&&o.state.selection.to<l+h.nodeSize&&(S=p.findIndexWithChild(f.node))>-1&&p.updateNodeAt(h,d,v,S,o)||p.updateNextNode(h,d,v,o,b)||p.addNode(h,d,v,o,l),l+=h.nodeSize}),p.syncToMarks(Ue,a,o),this.node.isTextblock&&p.addTextblockHacks(),p.destroyRest(),(p.changed||this.dirty==Wt)&&(u&&this.protectLocalComposition(o,u),Ti(this.contentDOM,this.children,o),g.ios&&Il(this.dom))},e.prototype.localCompositionInfo=function(o,i){var s=o.state.selection,a=s.from,l=s.to;if(!(!(o.state.selection instanceof I)||a<i||l>i+this.node.content.size)){var f=o.root.getSelection(),u=Al(f.focusNode,f.focusOffset);if(!(!u||!this.dom.contains(u.parentNode)))if(this.node.inlineContent){var c=u.nodeValue,p=Rl(this.node.content,c,a-i,l-i);return p<0?null:{node:u,pos:p,text:c}}else return{node:u,pos:-1}}},e.prototype.protectLocalComposition=function(o,i){var s=i.node,a=i.pos,l=i.text;if(!this.getDesc(s)){for(var f=s;f.parentNode!=this.contentDOM;f=f.parentNode){for(;f.previousSibling;)f.parentNode.removeChild(f.previousSibling);for(;f.nextSibling;)f.parentNode.removeChild(f.nextSibling);f.pmViewDesc&&(f.pmViewDesc=null)}var u=new Ol(this,f,s,l);o.compositionNodes.push(u),this.children=Rn(this.children,a,a+l.length,o,u)}},e.prototype.update=function(o,i,s,a){return this.dirty==_e||!o.sameMarkup(this.node)?!1:(this.updateInner(o,i,s,a),!0)},e.prototype.updateInner=function(o,i,s,a){this.updateOuterDeco(i),this.node=o,this.innerDeco=s,this.contentDOM&&this.updateChildren(a,this.posAtStart),this.dirty=we},e.prototype.updateOuterDeco=function(o){if(!An(o,this.outerDeco)){var i=this.nodeDOM.nodeType!=1,s=this.dom;this.dom=Ei(this.dom,this.nodeDOM,In(this.outerDeco,this.node,i),In(o,this.node,i)),this.dom!=s&&(s.pmViewDesc=null,this.dom.pmViewDesc=this),this.outerDeco=o}},e.prototype.selectNode=function(){this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.dom.draggable=!0)},e.prototype.deselectNode=function(){this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.dom.removeAttribute("draggable")},t.domAtom.get=function(){return this.node.isAtom},Object.defineProperties(e.prototype,t),e}(A);function wi(r,e,t,n,o){return Ii(n,e,r),new Ht(null,r,e,t,n,n,n,o,0)}var Ni=function(r){function e(n,o,i,s,a,l,f){r.call(this,n,o,i,s,a,null,l,f)}r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e;var t={domAtom:{configurable:!0}};return e.prototype.parseRule=function(){for(var o=this.nodeDOM.parentNode;o&&o!=this.dom&&!o.pmIsDeco;)o=o.parentNode;return{skip:o||!0}},e.prototype.update=function(o,i,s,a){return this.dirty==_e||this.dirty!=we&&!this.inParent()||!o.sameMarkup(this.node)?!1:(this.updateOuterDeco(i),(this.dirty!=we||o.text!=this.node.text)&&o.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=o.text,a.trackWrites==this.nodeDOM&&(a.trackWrites=null)),this.node=o,this.dirty=we,!0)},e.prototype.inParent=function(){for(var o=this.parent.contentDOM,i=this.nodeDOM;i;i=i.parentNode)if(i==o)return!0;return!1},e.prototype.domFromPos=function(o){return{node:this.nodeDOM,offset:o}},e.prototype.localPosFromDOM=function(o,i,s){return o==this.nodeDOM?this.posAtStart+Math.min(i,this.node.text.length):r.prototype.localPosFromDOM.call(this,o,i,s)},e.prototype.ignoreMutation=function(o){return o.type!="characterData"&&o.type!="selection"},e.prototype.slice=function(o,i,s){var a=this.node.cut(o,i),l=document.createTextNode(a.text);return new e(this.parent,a,this.outerDeco,this.innerDeco,l,l,s)},e.prototype.markDirty=function(o,i){r.prototype.markDirty.call(this,o,i),this.dom!=this.nodeDOM&&(o==0||i==this.nodeDOM.nodeValue.length)&&(this.dirty=_e)},t.domAtom.get=function(){return!1},Object.defineProperties(e.prototype,t),e}(Ht),Di=function(r){function e(){r.apply(this,arguments)}r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e;var t={domAtom:{configurable:!0},ignoreForCoords:{configurable:!0}};return e.prototype.parseRule=function(){return{ignore:!0}},e.prototype.matchesHack=function(o){return this.dirty==we&&this.dom.nodeName==o},t.domAtom.get=function(){return!0},t.ignoreForCoords.get=function(){return this.dom.nodeName=="IMG"},Object.defineProperties(e.prototype,t),e}(A),wl=function(r){function e(t,n,o,i,s,a,l,f,u,c){r.call(this,t,n,o,i,s,a,l,u,c),this.spec=f}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.update=function(n,o,i,s){if(this.dirty==_e)return!1;if(this.spec.update){var a=this.spec.update(n,o,i);return a&&this.updateInner(n,o,i,s),a}else return!this.contentDOM&&!n.isLeaf?!1:r.prototype.update.call(this,n,o,i,s)},e.prototype.selectNode=function(){this.spec.selectNode?this.spec.selectNode():r.prototype.selectNode.call(this)},e.prototype.deselectNode=function(){this.spec.deselectNode?this.spec.deselectNode():r.prototype.deselectNode.call(this)},e.prototype.setSelection=function(n,o,i,s){this.spec.setSelection?this.spec.setSelection(n,o,i):r.prototype.setSelection.call(this,n,o,i,s)},e.prototype.destroy=function(){this.spec.destroy&&this.spec.destroy(),r.prototype.destroy.call(this)},e.prototype.stopEvent=function(n){return this.spec.stopEvent?this.spec.stopEvent(n):!1},e.prototype.ignoreMutation=function(n){return this.spec.ignoreMutation?this.spec.ignoreMutation(n):r.prototype.ignoreMutation.call(this,n)},e}(Ht);function Ti(r,e,t){for(var n=r.firstChild,o=!1,i=0;i<e.length;i++){var s=e[i],a=s.dom;if(a.parentNode==r){for(;a!=n;)n=Ai(n),o=!0;n=n.nextSibling}else o=!0,r.insertBefore(a,n);if(s instanceof Er){var l=n?n.previousSibling:r.lastChild;Ti(s.contentDOM,s.children,t),n=l?l.nextSibling:r.firstChild}}for(;n;)n=Ai(n),o=!0;o&&t.trackWrites==r&&(t.trackWrites=null)}function Kt(r){r&&(this.nodeName=r)}Kt.prototype=Object.create(null);var ot=[new Kt];function In(r,e,t){if(r.length==0)return ot;for(var n=t?ot[0]:new Kt,o=[n],i=0;i<r.length;i++){var s=r[i].type.attrs;if(!!s){s.nodeName&&o.push(n=new Kt(s.nodeName));for(var a in s){var l=s[a];l!=null&&(t&&o.length==1&&o.push(n=new Kt(e.isInline?"span":"div")),a=="class"?n.class=(n.class?n.class+" ":"")+l:a=="style"?n.style=(n.style?n.style+";":"")+l:a!="nodeName"&&(n[a]=l))}}}return o}function Ei(r,e,t,n){if(t==ot&&n==ot)return e;for(var o=e,i=0;i<n.length;i++){var s=n[i],a=t[i];if(i){var l=void 0;a&&a.nodeName==s.nodeName&&o!=r&&(l=o.parentNode)&&l.tagName.toLowerCase()==s.nodeName||(l=document.createElement(s.nodeName),l.pmIsDeco=!0,l.appendChild(o),a=ot[0]),o=l}Nl(o,a||ot[0],s)}return o}function Nl(r,e,t){for(var n in e)n!="class"&&n!="style"&&n!="nodeName"&&!(n in t)&&r.removeAttribute(n);for(var o in t)o!="class"&&o!="style"&&o!="nodeName"&&t[o]!=e[o]&&r.setAttribute(o,t[o]);if(e.class!=t.class){for(var i=e.class?e.class.split(" ").filter(Boolean):Ue,s=t.class?t.class.split(" ").filter(Boolean):Ue,a=0;a<i.length;a++)s.indexOf(i[a])==-1&&r.classList.remove(i[a]);for(var l=0;l<s.length;l++)i.indexOf(s[l])==-1&&r.classList.add(s[l]);r.classList.length==0&&r.removeAttribute("class")}if(e.style!=t.style){if(e.style)for(var f=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,u;u=f.exec(e.style);)r.style.removeProperty(u[1]);t.style&&(r.style.cssText+=t.style)}}function Ii(r,e,t){return Ei(r,r,ot,In(e,t,r.nodeType!=1))}function An(r,e){if(r.length!=e.length)return!1;for(var t=0;t<r.length;t++)if(!r[t].type.eq(e[t].type))return!1;return!0}function Ai(r){var e=r.nextSibling;return r.parentNode.removeChild(r),e}var ke=function(e,t){this.top=e,this.lock=t,this.index=0,this.stack=[],this.changed=!1,this.preMatch=Dl(e.node.content,e)};ke.prototype.destroyBetween=function(e,t){if(e!=t){for(var n=e;n<t;n++)this.top.children[n].destroy();this.top.children.splice(e,t-e),this.changed=!0}};ke.prototype.destroyRest=function(){this.destroyBetween(this.index,this.top.children.length)};ke.prototype.syncToMarks=function(e,t,n){for(var o=0,i=this.stack.length>>1,s=Math.min(i,e.length);o<s&&(o==i-1?this.top:this.stack[o+1<<1]).matchesMark(e[o])&&e[o].type.spec.spanning!==!1;)o++;for(;o<i;)this.destroyRest(),this.top.dirty=we,this.index=this.stack.pop(),this.top=this.stack.pop(),i--;for(;i<e.length;){this.stack.push(this.top,this.index+1);for(var a=-1,l=this.index;l<Math.min(this.index+3,this.top.children.length);l++)if(this.top.children[l].matchesMark(e[i])){a=l;break}if(a>-1)a>this.index&&(this.changed=!0,this.destroyBetween(this.index,a)),this.top=this.top.children[this.index];else{var f=Er.create(this.top,e[i],t,n);this.top.children.splice(this.index,0,f),this.top=f,this.changed=!0}this.index=0,i++}};ke.prototype.findNodeMatch=function(e,t,n,o){var i=-1,s;if(o>=this.preMatch.index&&(s=this.preMatch.matches[o-this.preMatch.index]).parent==this.top&&s.matchesNode(e,t,n))i=this.top.children.indexOf(s,this.index);else for(var a=this.index,l=Math.min(this.top.children.length,a+5);a<l;a++){var f=this.top.children[a];if(f.matchesNode(e,t,n)&&!this.preMatch.matched.has(f)){i=a;break}}return i<0?!1:(this.destroyBetween(this.index,i),this.index++,!0)};ke.prototype.updateNodeAt=function(e,t,n,o,i){var s=this.top.children[o];return s.update(e,t,n,i)?(this.destroyBetween(this.index,o),this.index=o+1,!0):!1};ke.prototype.findIndexWithChild=function(e){for(;;){var t=e.parentNode;if(!t)return-1;if(t==this.top.contentDOM){var n=e.pmViewDesc;if(n){for(var o=this.index;o<this.top.children.length;o++)if(this.top.children[o]==n)return o}return-1}e=t}};ke.prototype.updateNextNode=function(e,t,n,o,i){for(var s=this.index;s<this.top.children.length;s++){var a=this.top.children[s];if(a instanceof Ht){var l=this.preMatch.matched.get(a);if(l!=null&&l!=i)return!1;var f=a.dom,u=this.lock&&(f==this.lock||f.nodeType==1&&f.contains(this.lock.parentNode))&&!(e.isText&&a.node&&a.node.isText&&a.nodeDOM.nodeValue==e.text&&a.dirty!=_e&&An(t,a.outerDeco));if(!u&&a.update(e,t,n,o))return this.destroyBetween(this.index,s),a.dom!=f&&(this.changed=!0),this.index++,!0;break}}return!1};ke.prototype.addNode=function(e,t,n,o,i){this.top.children.splice(this.index++,0,Ht.create(this.top,e,t,n,o,i)),this.changed=!0};ke.prototype.placeWidget=function(e,t,n){var o=this.index<this.top.children.length?this.top.children[this.index]:null;if(o&&o.matchesWidget(e)&&(e==o.widget||!o.widget.type.toDOM.parentNode))this.index++;else{var i=new Oi(this.top,e,t,n);this.top.children.splice(this.index++,0,i),this.changed=!0}};ke.prototype.addTextblockHacks=function(){for(var e=this.top.children[this.index-1],t=this.top;e instanceof Er;)t=e,e=t.children[t.children.length-1];(!e||!(e instanceof Ni)||/\n$/.test(e.node.text))&&((g.safari||g.chrome)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",t),this.addHackNode("BR",this.top))};ke.prototype.addHackNode=function(e,t){if(t==this.top&&this.index<t.children.length&&t.children[this.index].matchesHack(e))this.index++;else{var n=document.createElement(e);e=="IMG"&&(n.className="ProseMirror-separator",n.alt=""),e=="BR"&&(n.className="ProseMirror-trailingBreak");var o=new Di(this.top,Ue,n,null);t!=this.top?t.children.push(o):t.children.splice(this.index++,0,o),this.changed=!0}};function Dl(r,e){var t=e,n=t.children.length,o=r.childCount,i=new Map,s=[];e:for(;o>0;){for(var a=void 0;;)if(n){var l=t.children[n-1];if(l instanceof Er)t=l,n=l.children.length;else{a=l,n--;break}}else{if(t==e)break e;n=t.parent.children.indexOf(t),t=t.parent}var f=a.node;if(!!f){if(f!=r.child(o-1))break;--o,i.set(a,o),s.push(a)}}return{index:o,matched:i,matches:s.reverse()}}function Tl(r,e){return r.type.side-e.type.side}function El(r,e,t,n){var o=e.locals(r),i=0;if(o.length==0){for(var s=0;s<r.childCount;s++){var a=r.child(s);n(a,o,e.forChild(i,a),s),i+=a.nodeSize}return}for(var l=0,f=[],u=null,c=0;;){if(l<o.length&&o[l].to==i){for(var p=o[l++],h=void 0;l<o.length&&o[l].to==i;)(h||(h=[p])).push(o[l++]);if(h){h.sort(Tl);for(var d=0;d<h.length;d++)t(h[d],c,!!u)}else t(p,c,!!u)}var v=void 0,b=void 0;if(u)b=-1,v=u,u=null;else if(c<r.childCount)b=c,v=r.child(c++);else break;for(var S=0;S<f.length;S++)f[S].to<=i&&f.splice(S--,1);for(;l<o.length&&o[l].from<=i&&o[l].to>i;)f.push(o[l++]);var y=i+v.nodeSize;if(v.isText){var O=y;l<o.length&&o[l].from<O&&(O=o[l].from);for(var M=0;M<f.length;M++)f[M].to<O&&(O=f[M].to);O<y&&(u=v.cut(O-i),v=v.cut(0,O-i),y=O,b=-1)}var C=f.length?v.isInline&&!v.isLeaf?f.filter(function(T){return!T.inline}):f.slice():Ue;n(v,C,e.forChild(i,v),b),i=y}}function Il(r){if(r.nodeName=="UL"||r.nodeName=="OL"){var e=r.style.cssText;r.style.cssText=e+"; list-style: square !important",window.getComputedStyle(r).listStyle,r.style.cssText=e}}function Al(r,e){for(;;){if(r.nodeType==3)return r;if(r.nodeType==1&&e>0){if(r.childNodes.length>e&&r.childNodes[e].nodeType==3)return r.childNodes[e];r=r.childNodes[e-1],e=Ee(r)}else if(r.nodeType==1&&e<r.childNodes.length)r=r.childNodes[e],e=0;else return null}}function Rl(r,e,t,n){for(var o=0,i=0;o<r.childCount&&i<=n;){var s=r.child(o++),a=i;if(i+=s.nodeSize,!!s.isText){for(var l=s.text;o<r.childCount;){var f=r.child(o++);if(i+=f.nodeSize,!f.isText)break;l+=f.text}if(i>=t){var u=a<n?l.lastIndexOf(e,n-a-1):-1;if(u>=0&&u+e.length+a>=t)return a+u;if(t==n&&l.length>=n+e.length-a&&l.slice(n-a,n-a+e.length)==e)return n}}}return-1}function Rn(r,e,t,n,o){for(var i=[],s=0,a=0;s<r.length;s++){var l=r[s],f=a,u=a+=l.size;f>=t||u<=e?i.push(l):(f<e&&i.push(l.slice(0,e-f,n)),o&&(i.push(o),o=null),u>t&&i.push(l.slice(t-f,l.size,n)))}return i}function Ri(r,e){var t=r.root.getSelection(),n=r.state.doc;if(!t.focusNode)return null;var o=r.docView.nearestDesc(t.focusNode),i=o&&o.size==0,s=r.docView.posFromDOM(t.focusNode,t.focusOffset);if(s<0)return null;var a=n.resolve(s),l,f;if(Dn(t)){for(l=a;o&&!o.node;)o=o.parent;if(o&&o.node.isAtom&&x.isSelectable(o.node)&&o.parent&&!(o.node.isInline&&ll(t.focusNode,t.focusOffset,o.dom))){var u=o.posBefore;f=new x(s==u?a:n.resolve(u))}}else{var c=r.docView.posFromDOM(t.anchorNode,t.anchorOffset);if(c<0)return null;l=n.resolve(c)}if(!f){var p=e=="pointer"||r.state.selection.head<a.pos&&!i?1:-1;f=zn(r,l,a,p)}return f}function Pi(r){return r.editable?r.hasFocus():Li(r)&&document.activeElement&&document.activeElement.contains(r.dom)}function Ge(r,e){var t=r.state.selection;if(_i(r,t),!!Pi(r)){if(!e&&r.mouseDown&&r.mouseDown.allowDefault&&g.chrome){var n=r.root.getSelection(),o=r.domObserver.currentSelection;if(n.anchorNode&&Lt(n.anchorNode,n.anchorOffset,o.anchorNode,o.anchorOffset)){r.mouseDown.delayedSelectionSync=!0,r.domObserver.setCurSelection();return}}if(r.domObserver.disconnectSelection(),r.cursorWrapper)zl(r);else{var i=t.anchor,s=t.head,a,l;zi&&!(t instanceof I)&&(t.$from.parent.inlineContent||(a=Fi(r,t.from)),!t.empty&&!t.$from.parent.inlineContent&&(l=Fi(r,t.to))),r.docView.setSelection(i,s,r.root,e),zi&&(a&&Bi(a),l&&Bi(l)),t.visible?r.dom.classList.remove("ProseMirror-hideselection"):(r.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&Pl(r))}r.domObserver.setCurSelection(),r.domObserver.connectSelection()}}var zi=g.safari||g.chrome&&g.chrome_version<63;function Fi(r,e){var t=r.docView.domFromPos(e,0),n=t.node,o=t.offset,i=o<n.childNodes.length?n.childNodes[o]:null,s=o?n.childNodes[o-1]:null;if(g.safari&&i&&i.contentEditable=="false")return Pn(i);if((!i||i.contentEditable=="false")&&(!s||s.contentEditable=="false")){if(i)return Pn(i);if(s)return Pn(s)}}function Pn(r){return r.contentEditable="true",g.safari&&r.draggable&&(r.draggable=!1,r.wasDraggable=!0),r}function Bi(r){r.contentEditable="false",r.wasDraggable&&(r.draggable=!0,r.wasDraggable=null)}function Pl(r){var e=r.dom.ownerDocument;e.removeEventListener("selectionchange",r.hideSelectionGuard);var t=r.root.getSelection(),n=t.anchorNode,o=t.anchorOffset;e.addEventListener("selectionchange",r.hideSelectionGuard=function(){(t.anchorNode!=n||t.anchorOffset!=o)&&(e.removeEventListener("selectionchange",r.hideSelectionGuard),setTimeout(function(){(!Pi(r)||r.state.selection.visible)&&r.dom.classList.remove("ProseMirror-hideselection")},20))})}function zl(r){var e=r.root.getSelection(),t=document.createRange(),n=r.cursorWrapper.dom,o=n.nodeName=="IMG";o?t.setEnd(n.parentNode,me(n)+1):t.setEnd(n,0),t.collapse(!1),e.removeAllRanges(),e.addRange(t),!o&&!r.state.selection.visible&&g.ie&&g.ie_version<=11&&(n.disabled=!0,n.disabled=!1)}function _i(r,e){if(e instanceof x){var t=r.docView.descAt(e.from);t!=r.lastSelectedViewDesc&&(Vi(r),t&&t.selectNode(),r.lastSelectedViewDesc=t)}else Vi(r)}function Vi(r){r.lastSelectedViewDesc&&(r.lastSelectedViewDesc.parent&&r.lastSelectedViewDesc.deselectNode(),r.lastSelectedViewDesc=null)}function zn(r,e,t,n){return r.someProp("createSelectionBetween",function(o){return o(r,e,t)})||I.between(e,t,n)}function qi(r){return r.editable&&r.root.activeElement!=r.dom?!1:Li(r)}function Li(r){var e=r.root.getSelection();if(!e.anchorNode)return!1;try{return r.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(r.editable||r.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch(t){return!1}}function Fl(r){var e=r.docView.domFromPos(r.state.selection.anchor,0),t=r.root.getSelection();return Lt(e.node,e.offset,t.anchorNode,t.anchorOffset)}function Fn(r,e){var t=r.selection,n=t.$anchor,o=t.$head,i=e>0?n.max(o):n.min(o),s=i.parent.inlineContent?i.depth?r.doc.resolve(e>0?i.after():i.before()):null:i;return s&&N.findFrom(s,e)}function it(r,e){return r.dispatch(r.state.tr.setSelection(e).scrollIntoView()),!0}function Ji(r,e,t){var n=r.state.selection;if(n instanceof I){if(!n.empty||t.indexOf("s")>-1)return!1;if(r.endOfTextblock(e>0?"right":"left")){var o=Fn(r.state,e);return o&&o instanceof x?it(r,o):!1}else if(!(g.mac&&t.indexOf("m")>-1)){var i=n.$head,s=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter,a;if(!s||s.isText)return!1;var l=e<0?i.pos-s.nodeSize:i.pos;return s.isAtom||(a=r.docView.descAt(l))&&!a.contentDOM?x.isSelectable(s)?it(r,new x(e<0?r.state.doc.resolve(i.pos-s.nodeSize):i)):g.webkit?it(r,new I(r.state.doc.resolve(e<0?l:l+s.nodeSize))):!1:!1}}else{if(n instanceof x&&n.node.isInline)return it(r,new I(e>0?n.$to:n.$from));var f=Fn(r.state,e);return f?it(r,f):!1}}function Ir(r){return r.nodeType==3?r.nodeValue.length:r.childNodes.length}function Ut(r){var e=r.pmViewDesc;return e&&e.size==0&&(r.nextSibling||r.nodeName!="BR")}function Bn(r){var e=r.root.getSelection(),t=e.focusNode,n=e.focusOffset;if(!!t){var o,i,s=!1;for(g.gecko&&t.nodeType==1&&n<Ir(t)&&Ut(t.childNodes[n])&&(s=!0);;)if(n>0){if(t.nodeType!=1)break;var a=t.childNodes[n-1];if(Ut(a))o=t,i=--n;else if(a.nodeType==3)t=a,n=t.nodeValue.length;else break}else{if(Wi(t))break;for(var l=t.previousSibling;l&&Ut(l);)o=t.parentNode,i=me(l),l=l.previousSibling;if(l)t=l,n=Ir(t);else{if(t=t.parentNode,t==r.dom)break;n=0}}s?Vn(r,e,t,n):o&&Vn(r,e,o,i)}}function _n(r){var e=r.root.getSelection(),t=e.focusNode,n=e.focusOffset;if(!!t){for(var o=Ir(t),i,s;;)if(n<o){if(t.nodeType!=1)break;var a=t.childNodes[n];if(Ut(a))i=t,s=++n;else break}else{if(Wi(t))break;for(var l=t.nextSibling;l&&Ut(l);)i=l.parentNode,s=me(l)+1,l=l.nextSibling;if(l)t=l,n=0,o=Ir(t);else{if(t=t.parentNode,t==r.dom)break;n=o=0}}i&&Vn(r,e,i,s)}}function Wi(r){var e=r.pmViewDesc;return e&&e.node&&e.node.isBlock}function Vn(r,e,t,n){if(Dn(e)){var o=document.createRange();o.setEnd(t,n),o.setStart(t,n),e.removeAllRanges(),e.addRange(o)}else e.extend&&e.extend(t,n);r.domObserver.setCurSelection();var i=r.state;setTimeout(function(){r.state==i&&Ge(r)},50)}function Hi(r,e,t){var n=r.state.selection;if(n instanceof I&&!n.empty||t.indexOf("s")>-1||g.mac&&t.indexOf("m")>-1)return!1;var o=n.$from,i=n.$to;if(!o.parent.inlineContent||r.endOfTextblock(e<0?"up":"down")){var s=Fn(r.state,e);if(s&&s instanceof x)return it(r,s)}if(!o.parent.inlineContent){var a=e<0?o:i,l=n instanceof be?N.near(a,e):N.findFrom(a,e);return l?it(r,l):!1}return!1}function Ki(r,e){if(!(r.state.selection instanceof I))return!0;var t=r.state.selection,n=t.$head,o=t.$anchor,i=t.empty;if(!n.sameParent(o))return!0;if(!i)return!1;if(r.endOfTextblock(e>0?"forward":"backward"))return!0;var s=!n.textOffset&&(e<0?n.nodeBefore:n.nodeAfter);if(s&&!s.isText){var a=r.state.tr;return e<0?a.delete(n.pos-s.nodeSize,n.pos):a.delete(n.pos,n.pos+s.nodeSize),r.dispatch(a),!0}return!1}function Ui(r,e,t){r.domObserver.stop(),e.contentEditable=t,r.domObserver.start()}function Bl(r){if(!(!g.safari||r.state.selection.$head.parentOffset>0)){var e=r.root.getSelection(),t=e.focusNode,n=e.focusOffset;if(t&&t.nodeType==1&&n==0&&t.firstChild&&t.firstChild.contentEditable=="false"){var o=t.firstChild;Ui(r,o,!0),setTimeout(function(){return Ui(r,o,!1)},20)}}}function _l(r){var e="";return r.ctrlKey&&(e+="c"),r.metaKey&&(e+="m"),r.altKey&&(e+="a"),r.shiftKey&&(e+="s"),e}function Vl(r,e){var t=e.keyCode,n=_l(e);return t==8||g.mac&&t==72&&n=="c"?Ki(r,-1)||Bn(r):t==46||g.mac&&t==68&&n=="c"?Ki(r,1)||_n(r):t==13||t==27?!0:t==37?Ji(r,-1,n)||Bn(r):t==39?Ji(r,1,n)||_n(r):t==38?Hi(r,-1,n)||Bn(r):t==40?Bl(r)||Hi(r,1,n)||_n(r):n==(g.mac?"m":"c")&&(t==66||t==73||t==89||t==90)}function ql(r,e,t){var n=r.docView.parseRange(e,t),o=n.node,i=n.fromOffset,s=n.toOffset,a=n.from,l=n.to,f=r.root.getSelection(),u=null,c=f.anchorNode;if(c&&r.dom.contains(c.nodeType==1?c:c.parentNode)&&(u=[{node:c,offset:f.anchorOffset}],Dn(f)||u.push({node:f.focusNode,offset:f.focusOffset})),g.chrome&&r.lastKeyCode===8)for(var p=s;p>i;p--){var h=o.childNodes[p-1],d=h.pmViewDesc;if(h.nodeName=="BR"&&!d){s=p;break}if(!d||d.size)break}var v=r.state.doc,b=r.someProp("domParser")||se.fromSchema(r.state.schema),S=v.resolve(a),y=null,O=b.parse(o,{topNode:S.parent,topMatch:S.parent.contentMatchAt(S.index()),topOpen:!0,from:i,to:s,preserveWhitespace:S.parent.type.whitespace=="pre"?"full":!0,editableContent:!0,findPositions:u,ruleFromNode:Ll,context:S});if(u&&u[0].pos!=null){var M=u[0].pos,C=u[1]&&u[1].pos;C==null&&(C=M),y={anchor:M+a,head:C+a}}return{doc:O,sel:y,from:a,to:l}}function Ll(r){var e=r.pmViewDesc;if(e)return e.parseRule();if(r.nodeName=="BR"&&r.parentNode){if(g.safari&&/^(ul|ol)$/i.test(r.parentNode.nodeName)){var t=document.createElement("div");return t.appendChild(document.createElement("li")),{skip:t}}else if(r.parentNode.lastChild==r||g.safari&&/^(tr|table)$/i.test(r.parentNode.nodeName))return{ignore:!0}}else if(r.nodeName=="IMG"&&r.getAttribute("mark-placeholder"))return{ignore:!0}}function Jl(r,e,t,n,o){if(e<0){var i=r.lastSelectionTime>Date.now()-50?r.lastSelectionOrigin:null,s=Ri(r,i);if(s&&!r.state.selection.eq(s)){var a=r.state.tr.setSelection(s);i=="pointer"?a.setMeta("pointer",!0):i=="key"&&a.scrollIntoView(),r.dispatch(a)}return}var l=r.state.doc.resolve(e),f=l.sharedDepth(t);e=l.before(f+1),t=r.state.doc.resolve(t).after(f+1);var u=r.state.selection,c=ql(r,e,t);if(g.chrome&&r.cursorWrapper&&c.sel&&c.sel.anchor==r.cursorWrapper.deco.from){var p=r.cursorWrapper.deco.type.toDOM.nextSibling,h=p&&p.nodeValue?p.nodeValue.length:1;c.sel={anchor:c.sel.anchor+h,head:c.sel.anchor+h}}var d=r.state.doc,v=d.slice(c.from,c.to),b,S;r.lastKeyCode===8&&Date.now()-100<r.lastKeyCodeTime?(b=r.state.selection.to,S="end"):(b=r.state.selection.from,S="start"),r.lastKeyCode=null;var y=Kl(v.content,c.doc.content,c.from,b,S);if((g.ios&&r.lastIOSEnter>Date.now()-225||g.android)&&o.some(function(q){return q.nodeName=="DIV"||q.nodeName=="P"})&&(!y||y.endA>=y.endB)&&r.someProp("handleKeyDown",function(q){return q(r,kt(13,"Enter"))})){r.lastIOSEnter=0;return}if(!y)if(n&&u instanceof I&&!u.empty&&u.$head.sameParent(u.$anchor)&&!r.composing&&!(c.sel&&c.sel.anchor!=c.sel.head))y={start:u.from,endA:u.to,endB:u.to};else{if(c.sel){var O=Gi(r,r.state.doc,c.sel);O&&!O.eq(r.state.selection)&&r.dispatch(r.state.tr.setSelection(O))}return}r.domChangeCount++,r.state.selection.from<r.state.selection.to&&y.start==y.endB&&r.state.selection instanceof I&&(y.start>r.state.selection.from&&y.start<=r.state.selection.from+2&&r.state.selection.from>=c.from?y.start=r.state.selection.from:y.endA<r.state.selection.to&&y.endA>=r.state.selection.to-2&&r.state.selection.to<=c.to&&(y.endB+=r.state.selection.to-y.endA,y.endA=r.state.selection.to)),g.ie&&g.ie_version<=11&&y.endB==y.start+1&&y.endA==y.start&&y.start>c.from&&c.doc.textBetween(y.start-c.from-1,y.start-c.from+1)==" \xA0"&&(y.start--,y.endA--,y.endB--);var M=c.doc.resolveNoCache(y.start-c.from),C=c.doc.resolveNoCache(y.endB-c.from),T=M.sameParent(C)&&M.parent.inlineContent,P;if((g.ios&&r.lastIOSEnter>Date.now()-225&&(!T||o.some(function(q){return q.nodeName=="DIV"||q.nodeName=="P"}))||!T&&M.pos<c.doc.content.size&&(P=N.findFrom(c.doc.resolve(M.pos+1),1,!0))&&P.head==C.pos)&&r.someProp("handleKeyDown",function(q){return q(r,kt(13,"Enter"))})){r.lastIOSEnter=0;return}if(r.state.selection.anchor>y.start&&Hl(d,y.start,y.endA,M,C)&&r.someProp("handleKeyDown",function(q){return q(r,kt(8,"Backspace"))})){g.android&&g.chrome&&r.domObserver.suppressSelectionUpdates();return}g.chrome&&g.android&&y.toB==y.from&&(r.lastAndroidDelete=Date.now()),g.android&&!T&&M.start()!=C.start()&&C.parentOffset==0&&M.depth==C.depth&&c.sel&&c.sel.anchor==c.sel.head&&c.sel.head==y.endA&&(y.endB-=2,C=c.doc.resolveNoCache(y.endB-c.from),setTimeout(function(){r.someProp("handleKeyDown",function(q){return q(r,kt(13,"Enter"))})},20));var F=y.start,H=y.endA,K,Pe,Ce,xe;if(T){if(M.pos==C.pos)g.ie&&g.ie_version<=11&&M.parentOffset==0&&(r.domObserver.suppressSelectionUpdates(),setTimeout(function(){return Ge(r)},20)),K=r.state.tr.delete(F,H),Pe=d.resolve(y.start).marksAcross(d.resolve(y.endA));else if(y.endA==y.endB&&(xe=d.resolve(y.start))&&(Ce=Wl(M.parent.content.cut(M.parentOffset,C.parentOffset),xe.parent.content.cut(xe.parentOffset,y.endA-xe.start()))))K=r.state.tr,Ce.type=="add"?K.addMark(F,H,Ce.mark):K.removeMark(F,H,Ce.mark);else if(M.parent.child(M.index()).isText&&M.index()==C.index()-(C.textOffset?0:1)){var fr=M.parent.textBetween(M.parentOffset,C.parentOffset);if(r.someProp("handleTextInput",function(q){return q(r,F,H,fr)}))return;K=r.state.tr.insertText(fr,F,H)}}if(K||(K=r.state.tr.replace(F,H,c.doc.slice(y.start-c.from,y.endB-c.from))),c.sel){var ie=Gi(r,K.doc,c.sel);ie&&!(g.chrome&&g.android&&r.composing&&ie.empty&&(y.start!=y.endB||r.lastAndroidDelete<Date.now()-100)&&(ie.head==F||ie.head==K.mapping.map(H)-1)||g.ie&&ie.empty&&ie.head==F)&&K.setSelection(ie)}Pe&&K.ensureMarks(Pe),r.dispatch(K.scrollIntoView())}function Gi(r,e,t){return Math.max(t.anchor,t.head)>e.content.size?null:zn(r,e.resolve(t.anchor),e.resolve(t.head))}function Wl(r,e){for(var t=r.firstChild.marks,n=e.firstChild.marks,o=t,i=n,s,a,l,f=0;f<n.length;f++)o=n[f].removeFromSet(o);for(var u=0;u<t.length;u++)i=t[u].removeFromSet(i);if(o.length==1&&i.length==0)a=o[0],s="add",l=function(h){return h.mark(a.addToSet(h.marks))};else if(o.length==0&&i.length==1)a=i[0],s="remove",l=function(h){return h.mark(a.removeFromSet(h.marks))};else return null;for(var c=[],p=0;p<e.childCount;p++)c.push(l(e.child(p)));if(m.from(c).eq(r))return{mark:a,type:s}}function Hl(r,e,t,n,o){if(!n.parent.isTextblock||t-e<=o.pos-n.pos||qn(n,!0,!1)<o.pos)return!1;var i=r.resolve(e);if(i.parentOffset<i.parent.content.size||!i.parent.isTextblock)return!1;var s=r.resolve(qn(i,!0,!0));return!s.parent.isTextblock||s.pos>t||qn(s,!0,!1)<t?!1:n.parent.content.cut(n.parentOffset).eq(s.parent.content)}function qn(r,e,t){for(var n=r.depth,o=e?r.end():r.pos;n>0&&(e||r.indexAfter(n)==r.node(n).childCount);)n--,o++,e=!1;if(t)for(var i=r.node(n).maybeChild(r.indexAfter(n));i&&!i.isLeaf;)i=i.firstChild,o++;return o}function Kl(r,e,t,n,o){var i=r.findDiffStart(e,t);if(i==null)return null;var s=r.findDiffEnd(e,t+r.size,t+e.size),a=s.a,l=s.b;if(o=="end"){var f=Math.max(0,i-Math.min(a,l));n-=a+f-i}if(a<i&&r.size<e.size){var u=n<=i&&n>=a?i-n:0;i-=u,l=i+(l-a),a=i}else if(l<i){var c=n<=i&&n>=l?i-n:0;i-=c,a=i+(a-l),l=i}return{start:i,endA:a,endB:l}}function Ln(r,e){for(var t=[],n=e.content,o=e.openStart,i=e.openEnd;o>1&&i>1&&n.childCount==1&&n.firstChild.childCount==1;){o--,i--;var s=n.firstChild;t.push(s.type.name,s.attrs!=s.type.defaultAttrs?s.attrs:null),n=s.content}var a=r.someProp("clipboardSerializer")||L.fromSchema(r.state.schema),l=es(),f=l.createElement("div");f.appendChild(a.serializeFragment(n,{document:l}));for(var u=f.firstChild,c;u&&u.nodeType==1&&(c=Zi[u.nodeName.toLowerCase()]);){for(var p=c.length-1;p>=0;p--){for(var h=l.createElement(c[p]);f.firstChild;)h.appendChild(f.firstChild);f.appendChild(h),c[p]!="tbody"&&(o++,i++)}u=f.firstChild}u&&u.nodeType==1&&u.setAttribute("data-pm-slice",o+" "+i+" "+JSON.stringify(t));var d=r.someProp("clipboardTextSerializer",function(v){return v(e)})||e.content.textBetween(0,e.content.size,`

`);return{dom:f,text:d}}function Jn(r,e,t,n,o){var i,s=o.parent.type.spec.code,a;if(!t&&!e)return null;var l=e&&(n||s||!t);if(l){if(r.someProp("transformPastedText",function(C){e=C(e,s||n)}),s)return e?new k(m.from(r.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0):k.empty;var f=r.someProp("clipboardTextParser",function(C){return C(e,o,n)});if(f)a=f;else{var u=o.marks(),c=r.state,p=c.schema,h=L.fromSchema(p);i=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(function(C){var T=i.appendChild(document.createElement("p"));C&&T.appendChild(h.serializeNode(p.text(C,u)))})}}else r.someProp("transformPastedHTML",function(C){t=C(t)}),i=jl(t),g.webkit&&Ql(i);var d=i&&i.querySelector("[data-pm-slice]"),v=d&&/^(\d+) (\d+) (.*)/.exec(d.getAttribute("data-pm-slice"));if(!a){var b=r.someProp("clipboardParser")||r.someProp("domParser")||se.fromSchema(r.state.schema);a=b.parseSlice(i,{preserveWhitespace:!!(l||v),context:o,ruleFromNode:function(T){if(T.nodeName=="BR"&&!T.nextSibling&&T.parentNode&&!Ul.test(T.parentNode.nodeName))return{ignore:!0}}})}if(v)a=Yl(Xi(a,+v[1],+v[2]),v[3]);else if(a=k.maxOpen(Gl(a.content,o),!0),a.openStart||a.openEnd){for(var S=0,y=0,O=a.content.firstChild;S<a.openStart&&!O.type.spec.isolating;S++,O=O.firstChild);for(var M=a.content.lastChild;y<a.openEnd&&!M.type.spec.isolating;y++,M=M.lastChild);a=Xi(a,S,y)}return r.someProp("transformPasted",function(C){a=C(a)}),a}var Ul=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function Gl(r,e){if(r.childCount<2)return r;for(var t=function(i){var s=e.node(i),a=s.contentMatchAt(e.index(i)),l=void 0,f=[];if(r.forEach(function(u){if(!!f){var c=a.findWrapping(u.type),p;if(!c)return f=null;if(p=f.length&&l.length&&Qi(c,l,u,f[f.length-1],0))f[f.length-1]=p;else{f.length&&(f[f.length-1]=Yi(f[f.length-1],l.length));var h=ji(u,c);f.push(h),a=a.matchType(h.type,h.attrs),l=c}}}),f)return{v:m.from(f)}},n=e.depth;n>=0;n--){var o=t(n);if(o)return o.v}return r}function ji(r,e,t){t===void 0&&(t=0);for(var n=e.length-1;n>=t;n--)r=e[n].create(null,m.from(r));return r}function Qi(r,e,t,n,o){if(o<r.length&&o<e.length&&r[o]==e[o]){var i=Qi(r,e,t,n.lastChild,o+1);if(i)return n.copy(n.content.replaceChild(n.childCount-1,i));var s=n.contentMatchAt(n.childCount);if(s.matchType(o==r.length-1?t.type:r[o+1]))return n.copy(n.content.append(m.from(ji(t,r,o+1))))}}function Yi(r,e){if(e==0)return r;var t=r.content.replaceChild(r.childCount-1,Yi(r.lastChild,e-1)),n=r.contentMatchAt(r.childCount).fillBefore(m.empty,!0);return r.copy(t.append(n))}function Wn(r,e,t,n,o,i){var s=e<0?r.firstChild:r.lastChild,a=s.content;return o<n-1&&(a=Wn(a,e,t,n,o+1,i)),o>=t&&(a=e<0?s.contentMatchAt(0).fillBefore(a,r.childCount>1||i<=o).append(a):a.append(s.contentMatchAt(s.childCount).fillBefore(m.empty,!0))),r.replaceChild(e<0?0:r.childCount-1,s.copy(a))}function Xi(r,e,t){return e<r.openStart&&(r=new k(Wn(r.content,-1,e,r.openStart,0,r.openEnd),e,r.openEnd)),t<r.openEnd&&(r=new k(Wn(r.content,1,t,r.openEnd,0,0),r.openStart,t)),r}var Zi={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]},$i=null;function es(){return $i||($i=document.implementation.createHTMLDocument("title"))}function jl(r){var e=/^(\s*<meta [^>]*>)*/.exec(r);e&&(r=r.slice(e[0].length));var t=es().createElement("div"),n=/<([a-z][^>\s]+)/i.exec(r),o;if((o=n&&Zi[n[1].toLowerCase()])&&(r=o.map(function(s){return"<"+s+">"}).join("")+r+o.map(function(s){return"</"+s+">"}).reverse().join("")),t.innerHTML=r,o)for(var i=0;i<o.length;i++)t=t.querySelector(o[i])||t;return t}function Ql(r){for(var e=r.querySelectorAll(g.chrome?"span:not([class]):not([style])":"span.Apple-converted-space"),t=0;t<e.length;t++){var n=e[t];n.childNodes.length==1&&n.textContent=="\xA0"&&n.parentNode&&n.parentNode.replaceChild(r.ownerDocument.createTextNode(" "),n)}}function Yl(r,e){if(!r.size)return r;var t=r.content.firstChild.type.schema,n;try{n=JSON.parse(e)}catch(f){return r}for(var o=r.content,i=r.openStart,s=r.openEnd,a=n.length-2;a>=0;a-=2){var l=t.nodes[n[a]];if(!l||l.hasRequiredAttrs())break;o=m.from(l.create(n[a+1],o)),i++,s++}return new k(o,i,s)}var Xl={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},Hn=g.ie&&g.ie_version<=11,Kn=function(){this.anchorNode=this.anchorOffset=this.focusNode=this.focusOffset=null};Kn.prototype.set=function(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset};Kn.prototype.eq=function(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset};var ve=function(e,t){var n=this;this.view=e,this.handleDOMChange=t,this.queue=[],this.flushingSoon=-1,this.observer=window.MutationObserver&&new window.MutationObserver(function(o){for(var i=0;i<o.length;i++)n.queue.push(o[i]);g.ie&&g.ie_version<=11&&o.some(function(s){return s.type=="childList"&&s.removedNodes.length||s.type=="characterData"&&s.oldValue.length>s.target.nodeValue.length})?n.flushSoon():n.flush()}),this.currentSelection=new Kn,Hn&&(this.onCharData=function(o){n.queue.push({target:o.target,type:"characterData",oldValue:o.prevValue}),n.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.suppressingSelectionUpdates=!1};ve.prototype.flushSoon=function(){var e=this;this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(function(){e.flushingSoon=-1,e.flush()},20))};ve.prototype.forceFlush=function(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())};ve.prototype.start=function(){this.observer&&this.observer.observe(this.view.dom,Xl),Hn&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()};ve.prototype.stop=function(){var e=this;if(this.observer){var t=this.observer.takeRecords();if(t.length){for(var n=0;n<t.length;n++)this.queue.push(t[n]);window.setTimeout(function(){return e.flush()},20)}this.observer.disconnect()}Hn&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()};ve.prototype.connectSelection=function(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)};ve.prototype.disconnectSelection=function(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)};ve.prototype.suppressSelectionUpdates=function(){var e=this;this.suppressingSelectionUpdates=!0,setTimeout(function(){return e.suppressingSelectionUpdates=!1},50)};ve.prototype.onSelectionChange=function(){if(!!qi(this.view)){if(this.suppressingSelectionUpdates)return Ge(this.view);if(g.ie&&g.ie_version<=11&&!this.view.state.selection.empty){var e=this.view.root.getSelection();if(e.focusNode&&Lt(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}};ve.prototype.setCurSelection=function(){this.currentSelection.set(this.view.root.getSelection())};ve.prototype.ignoreSelectionChange=function(e){if(e.rangeCount==0)return!0;var t=e.getRangeAt(0).commonAncestorContainer,n=this.view.docView.nearestDesc(t);if(n&&n.ignoreMutation({type:"selection",target:t.nodeType==3?t.parentNode:t}))return this.setCurSelection(),!0};ve.prototype.flush=function(){if(!(!this.view.docView||this.flushingSoon>-1)){var e=this.observer?this.observer.takeRecords():[];this.queue.length&&(e=this.queue.concat(e),this.queue.length=0);var t=this.view.root.getSelection(),n=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(t)&&qi(this.view)&&!this.ignoreSelectionChange(t),o=-1,i=-1,s=!1,a=[];if(this.view.editable)for(var l=0;l<e.length;l++){var f=this.registerMutation(e[l],a);f&&(o=o<0?f.from:Math.min(f.from,o),i=i<0?f.to:Math.max(f.to,i),f.typeOver&&(s=!0))}if(g.gecko&&a.length>1){var u=a.filter(function(h){return h.nodeName=="BR"});if(u.length==2){var c=u[0],p=u[1];c.parentNode&&c.parentNode.parentNode==p.parentNode?p.remove():c.remove()}}(o>-1||n)&&(o>-1&&(this.view.docView.markDirty(o,i),Zl(this.view)),this.handleDOMChange(o,i,s,a),this.view.docView&&this.view.docView.dirty?this.view.updateState(this.view.state):this.currentSelection.eq(t)||Ge(this.view),this.currentSelection.set(t))}};ve.prototype.registerMutation=function(e,t){if(t.indexOf(e.target)>-1)return null;var n=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(n==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!n||n.ignoreMutation(e))return null;if(e.type=="childList"){for(var o=0;o<e.addedNodes.length;o++)t.push(e.addedNodes[o]);if(n.contentDOM&&n.contentDOM!=n.dom&&!n.contentDOM.contains(e.target))return{from:n.posBefore,to:n.posAfter};var i=e.previousSibling,s=e.nextSibling;if(g.ie&&g.ie_version<=11&&e.addedNodes.length)for(var a=0;a<e.addedNodes.length;a++){var l=e.addedNodes[a],f=l.previousSibling,u=l.nextSibling;(!f||Array.prototype.indexOf.call(e.addedNodes,f)<0)&&(i=f),(!u||Array.prototype.indexOf.call(e.addedNodes,u)<0)&&(s=u)}var c=i&&i.parentNode==e.target?me(i)+1:0,p=n.localPosFromDOM(e.target,c,-1),h=s&&s.parentNode==e.target?me(s):e.target.childNodes.length,d=n.localPosFromDOM(e.target,h,1);return{from:p,to:d}}else return e.type=="attributes"?{from:n.posAtStart-n.border,to:n.posAtEnd+n.border}:{from:n.posAtStart,to:n.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}};var ts=!1;function Zl(r){ts||(ts=!0,getComputedStyle(r.dom).whiteSpace=="normal"&&console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."))}var ce={},le={};function $l(r){r.shiftKey=!1,r.mouseDown=null,r.lastKeyCode=null,r.lastKeyCodeTime=0,r.lastClick={time:0,x:0,y:0,type:""},r.lastSelectionOrigin=null,r.lastSelectionTime=0,r.lastIOSEnter=0,r.lastIOSEnterFallbackTimeout=null,r.lastAndroidDelete=0,r.composing=!1,r.composingTimeout=null,r.compositionNodes=[],r.compositionEndedAt=-2e8,r.domObserver=new ve(r,function(n,o,i,s){return Jl(r,n,o,i,s)}),r.domObserver.start(),r.domChangeCount=0,r.eventHandlers=Object.create(null);var e=function(n){var o=ce[n];r.dom.addEventListener(n,r.eventHandlers[n]=function(i){tf(r,i)&&!Gn(r,i)&&(r.editable||!(i.type in le))&&o(r,i)})};for(var t in ce)e(t);g.safari&&r.dom.addEventListener("input",function(){return null}),Un(r)}function st(r,e){r.lastSelectionOrigin=e,r.lastSelectionTime=Date.now()}function ef(r){r.domObserver.stop();for(var e in r.eventHandlers)r.dom.removeEventListener(e,r.eventHandlers[e]);clearTimeout(r.composingTimeout),clearTimeout(r.lastIOSEnterFallbackTimeout)}function Un(r){r.someProp("handleDOMEvents",function(e){for(var t in e)r.eventHandlers[t]||r.dom.addEventListener(t,r.eventHandlers[t]=function(n){return Gn(r,n)})})}function Gn(r,e){return r.someProp("handleDOMEvents",function(t){var n=t[e.type];return n?n(r,e)||e.defaultPrevented:!1})}function tf(r,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(var t=e.target;t!=r.dom;t=t.parentNode)if(!t||t.nodeType==11||t.pmViewDesc&&t.pmViewDesc.stopEvent(e))return!1;return!0}function rf(r,e){!Gn(r,e)&&ce[e.type]&&(r.editable||!(e.type in le))&&ce[e.type](r,e)}le.keydown=function(r,e){if(r.shiftKey=e.keyCode==16||e.shiftKey,!ns(r,e)&&(r.lastKeyCode=e.keyCode,r.lastKeyCodeTime=Date.now(),!(g.android&&g.chrome&&e.keyCode==13)))if(e.keyCode!=229&&r.domObserver.forceFlush(),g.ios&&e.keyCode==13&&!e.ctrlKey&&!e.altKey&&!e.metaKey){var t=Date.now();r.lastIOSEnter=t,r.lastIOSEnterFallbackTimeout=setTimeout(function(){r.lastIOSEnter==t&&(r.someProp("handleKeyDown",function(n){return n(r,kt(13,"Enter"))}),r.lastIOSEnter=0)},200)}else r.someProp("handleKeyDown",function(n){return n(r,e)})||Vl(r,e)?e.preventDefault():st(r,"key")};le.keyup=function(r,e){e.keyCode==16&&(r.shiftKey=!1)};le.keypress=function(r,e){if(!(ns(r,e)||!e.charCode||e.ctrlKey&&!e.altKey||g.mac&&e.metaKey)){if(r.someProp("handleKeyPress",function(o){return o(r,e)})){e.preventDefault();return}var t=r.state.selection;if(!(t instanceof I)||!t.$from.sameParent(t.$to)){var n=String.fromCharCode(e.charCode);r.someProp("handleTextInput",function(o){return o(r,t.$from.pos,t.$to.pos,n)})||r.dispatch(r.state.tr.insertText(n).scrollIntoView()),e.preventDefault()}}};function Ar(r){return{left:r.clientX,top:r.clientY}}function nf(r,e){var t=e.x-r.clientX,n=e.y-r.clientY;return t*t+n*n<100}function jn(r,e,t,n,o){if(n==-1)return!1;for(var i=r.state.doc.resolve(n),s=function(f){if(r.someProp(e,function(u){return f>i.depth?u(r,t,i.nodeAfter,i.before(f),o,!0):u(r,t,i.node(f),i.before(f),o,!1)}))return{v:!0}},a=i.depth+1;a>0;a--){var l=s(a);if(l)return l.v}return!1}function Mt(r,e,t){r.focused||r.focus();var n=r.state.tr.setSelection(e);t=="pointer"&&n.setMeta("pointer",!0),r.dispatch(n)}function of(r,e){if(e==-1)return!1;var t=r.state.doc.resolve(e),n=t.nodeAfter;return n&&n.isAtom&&x.isSelectable(n)?(Mt(r,new x(t),"pointer"),!0):!1}function sf(r,e){if(e==-1)return!1;var t=r.state.selection,n,o;t instanceof x&&(n=t.node);for(var i=r.state.doc.resolve(e),s=i.depth+1;s>0;s--){var a=s>i.depth?i.nodeAfter:i.node(s);if(x.isSelectable(a)){n&&t.$from.depth>0&&s>=t.$from.depth&&i.before(t.$from.depth+1)==t.$from.pos?o=i.before(t.$from.depth):o=i.before(s);break}}return o!=null?(Mt(r,x.create(r.state.doc,o),"pointer"),!0):!1}function af(r,e,t,n,o){return jn(r,"handleClickOn",e,t,n)||r.someProp("handleClick",function(i){return i(r,e,n)})||(o?sf(r,t):of(r,t))}function lf(r,e,t,n){return jn(r,"handleDoubleClickOn",e,t,n)||r.someProp("handleDoubleClick",function(o){return o(r,e,n)})}function ff(r,e,t,n){return jn(r,"handleTripleClickOn",e,t,n)||r.someProp("handleTripleClick",function(o){return o(r,e,n)})||uf(r,t,n)}function uf(r,e,t){if(t.button!=0)return!1;var n=r.state.doc;if(e==-1)return n.inlineContent?(Mt(r,I.create(n,0,n.content.size),"pointer"),!0):!1;for(var o=n.resolve(e),i=o.depth+1;i>0;i--){var s=i>o.depth?o.nodeAfter:o.node(i),a=o.before(i);if(s.inlineContent)Mt(r,I.create(n,a+1,a+1+s.content.size),"pointer");else if(x.isSelectable(s))Mt(r,x.create(n,a),"pointer");else continue;return!0}}function Qn(r){return Gt(r)}var rs=g.mac?"metaKey":"ctrlKey";ce.mousedown=function(r,e){r.shiftKey=e.shiftKey;var t=Qn(r),n=Date.now(),o="singleClick";n-r.lastClick.time<500&&nf(e,r.lastClick)&&!e[rs]&&(r.lastClick.type=="singleClick"?o="doubleClick":r.lastClick.type=="doubleClick"&&(o="tripleClick")),r.lastClick={time:n,x:e.clientX,y:e.clientY,type:o};var i=r.posAtCoords(Ar(e));!i||(o=="singleClick"?(r.mouseDown&&r.mouseDown.done(),r.mouseDown=new Rr(r,i,e,t)):(o=="doubleClick"?lf:ff)(r,i.pos,i.inside,e)?e.preventDefault():st(r,"pointer"))};var Rr=function(e,t,n,o){var i=this;this.view=e,this.startDoc=e.state.doc,this.pos=t,this.event=n,this.flushed=o,this.selectNode=n[rs],this.allowDefault=n.shiftKey,this.delayedSelectionSync=!1;var s,a;if(t.inside>-1)s=e.state.doc.nodeAt(t.inside),a=t.inside;else{var l=e.state.doc.resolve(t.pos);s=l.parent,a=l.depth?l.before():0}this.mightDrag=null;var f=o?null:n.target,u=f?e.docView.nearestDesc(f,!0):null;this.target=u?u.dom:null;var c=e.state,p=c.selection;(n.button==0&&s.type.spec.draggable&&s.type.spec.selectable!==!1||p instanceof x&&p.from<=a&&p.to>a)&&(this.mightDrag={node:s,pos:a,addAttr:this.target&&!this.target.draggable,setUneditable:this.target&&g.gecko&&!this.target.hasAttribute("contentEditable")}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(function(){i.view.mouseDown==i&&i.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),st(e,"pointer")};Rr.prototype.done=function(){var e=this;this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(function(){return Ge(e.view)}),this.view.mouseDown=null};Rr.prototype.up=function(e){if(this.done(),!!this.view.dom.contains(e.target.nodeType==3?e.target.parentNode:e.target)){var t=this.pos;this.view.state.doc!=this.startDoc&&(t=this.view.posAtCoords(Ar(e))),this.allowDefault||!t?st(this.view,"pointer"):af(this.view,t.pos,t.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||g.safari&&this.mightDrag&&!this.mightDrag.node.isAtom||g.chrome&&!(this.view.state.selection instanceof I)&&Math.min(Math.abs(t.pos-this.view.state.selection.from),Math.abs(t.pos-this.view.state.selection.to))<=2)?(Mt(this.view,N.near(this.view.state.doc.resolve(t.pos)),"pointer"),e.preventDefault()):st(this.view,"pointer")}};Rr.prototype.move=function(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0),st(this.view,"pointer"),e.buttons==0&&this.done()};ce.touchdown=function(r){Qn(r),st(r,"pointer")};ce.contextmenu=function(r){return Qn(r)};function ns(r,e){return r.composing?!0:g.safari&&Math.abs(e.timeStamp-r.compositionEndedAt)<500?(r.compositionEndedAt=-2e8,!0):!1}var cf=g.android?5e3:-1;le.compositionstart=le.compositionupdate=function(r){if(!r.composing){r.domObserver.flush();var e=r.state,t=e.selection.$from;if(e.selection.empty&&(e.storedMarks||!t.textOffset&&t.parentOffset&&t.nodeBefore.marks.some(function(a){return a.type.spec.inclusive===!1})))r.markCursor=r.state.storedMarks||t.marks(),Gt(r,!0),r.markCursor=null;else if(Gt(r),g.gecko&&e.selection.empty&&t.parentOffset&&!t.textOffset&&t.nodeBefore.marks.length)for(var n=r.root.getSelection(),o=n.focusNode,i=n.focusOffset;o&&o.nodeType==1&&i!=0;){var s=i<0?o.lastChild:o.childNodes[i-1];if(!s)break;if(s.nodeType==3){n.collapse(s,s.nodeValue.length);break}else o=s,i=-1}r.composing=!0}is(r,cf)};le.compositionend=function(r,e){r.composing&&(r.composing=!1,r.compositionEndedAt=e.timeStamp,is(r,20))};function is(r,e){clearTimeout(r.composingTimeout),e>-1&&(r.composingTimeout=setTimeout(function(){return Gt(r)},e))}function ss(r){for(r.composing&&(r.composing=!1,r.compositionEndedAt=pf());r.compositionNodes.length>0;)r.compositionNodes.pop().markParentsDirty()}function pf(){var r=document.createEvent("Event");return r.initEvent("event",!0,!0),r.timeStamp}function Gt(r,e){if(!(g.android&&r.domObserver.flushingSoon>=0)){if(r.domObserver.forceFlush(),ss(r),e||r.docView&&r.docView.dirty){var t=Ri(r);return t&&!t.eq(r.state.selection)?r.dispatch(r.state.tr.setSelection(t)):r.updateState(r.state),!0}return!1}}function hf(r,e){if(!!r.dom.parentNode){var t=r.dom.parentNode.appendChild(document.createElement("div"));t.appendChild(e),t.style.cssText="position: fixed; left: -10000px; top: 10px";var n=getSelection(),o=document.createRange();o.selectNodeContents(e),r.dom.blur(),n.removeAllRanges(),n.addRange(o),setTimeout(function(){t.parentNode&&t.parentNode.removeChild(t),r.focus()},50)}}var Ct=g.ie&&g.ie_version<15||g.ios&&g.webkit_version<604;ce.copy=le.cut=function(r,e){var t=r.state.selection,n=e.type=="cut";if(!t.empty){var o=Ct?null:e.clipboardData,i=t.content(),s=Ln(r,i),a=s.dom,l=s.text;o?(e.preventDefault(),o.clearData(),o.setData("text/html",a.innerHTML),o.setData("text/plain",l)):hf(r,a),n&&r.dispatch(r.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))}};function df(r){return r.openStart==0&&r.openEnd==0&&r.content.childCount==1?r.content.firstChild:null}function mf(r,e){if(!!r.dom.parentNode){var t=r.shiftKey||r.state.selection.$from.parent.type.spec.code,n=r.dom.parentNode.appendChild(document.createElement(t?"textarea":"div"));t||(n.contentEditable="true"),n.style.cssText="position: fixed; left: -10000px; top: 10px",n.focus(),setTimeout(function(){r.focus(),n.parentNode&&n.parentNode.removeChild(n),t?Yn(r,n.value,null,e):Yn(r,n.textContent,n.innerHTML,e)},50)}}function Yn(r,e,t,n){var o=Jn(r,e,t,r.shiftKey,r.state.selection.$from);if(r.someProp("handlePaste",function(a){return a(r,n,o||k.empty)}))return!0;if(!o)return!1;var i=df(o),s=i?r.state.tr.replaceSelectionWith(i,r.shiftKey):r.state.tr.replaceSelection(o);return r.dispatch(s.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}le.paste=function(r,e){if(!(r.composing&&!g.android)){var t=Ct?null:e.clipboardData;t&&Yn(r,t.getData("text/plain"),t.getData("text/html"),e)?e.preventDefault():mf(r,e)}};var vf=function(e,t){this.slice=e,this.move=t},as=g.mac?"altKey":"ctrlKey";ce.dragstart=function(r,e){var t=r.mouseDown;if(t&&t.done(),!!e.dataTransfer){var n=r.state.selection,o=n.empty?null:r.posAtCoords(Ar(e));if(!(o&&o.pos>=n.from&&o.pos<=(n instanceof x?n.to-1:n.to))){if(t&&t.mightDrag)r.dispatch(r.state.tr.setSelection(x.create(r.state.doc,t.mightDrag.pos)));else if(e.target&&e.target.nodeType==1){var i=r.docView.nearestDesc(e.target,!0);i&&i.node.type.spec.draggable&&i!=r.docView&&r.dispatch(r.state.tr.setSelection(x.create(r.state.doc,i.posBefore)))}}var s=r.state.selection.content(),a=Ln(r,s),l=a.dom,f=a.text;e.dataTransfer.clearData(),e.dataTransfer.setData(Ct?"Text":"text/html",l.innerHTML),e.dataTransfer.effectAllowed="copyMove",Ct||e.dataTransfer.setData("text/plain",f),r.dragging=new vf(s,!e[as])}};ce.dragend=function(r){var e=r.dragging;window.setTimeout(function(){r.dragging==e&&(r.dragging=null)},50)};le.dragover=le.dragenter=function(r,e){return e.preventDefault()};le.drop=function(r,e){var t=r.dragging;if(r.dragging=null,!!e.dataTransfer){var n=r.posAtCoords(Ar(e));if(!!n){var o=r.state.doc.resolve(n.pos);if(!!o){var i=t&&t.slice;i?r.someProp("transformPasted",function(d){i=d(i)}):i=Jn(r,e.dataTransfer.getData(Ct?"Text":"text/plain"),Ct?null:e.dataTransfer.getData("text/html"),!1,o);var s=t&&!e[as];if(r.someProp("handleDrop",function(d){return d(r,e,i||k.empty,s)})){e.preventDefault();return}if(!!i){e.preventDefault();var a=i?kr(r.state.doc,o.pos,i):o.pos;a==null&&(a=o.pos);var l=r.state.tr;s&&l.deleteSelection();var f=l.mapping.map(a),u=i.openStart==0&&i.openEnd==0&&i.content.childCount==1,c=l.doc;if(u?l.replaceRangeWith(f,f,i.content.firstChild):l.replaceRange(f,f,i),!l.doc.eq(c)){var p=l.doc.resolve(f);if(u&&x.isSelectable(i.content.firstChild)&&p.nodeAfter&&p.nodeAfter.sameMarkup(i.content.firstChild))l.setSelection(new x(p));else{var h=l.mapping.map(a);l.mapping.maps[l.mapping.maps.length-1].forEach(function(d,v,b,S){return h=S}),l.setSelection(zn(r,p,l.doc.resolve(h)))}r.focus(),r.dispatch(l.setMeta("uiEvent","drop"))}}}}}};ce.focus=function(r){r.focused||(r.domObserver.stop(),r.dom.classList.add("ProseMirror-focused"),r.domObserver.start(),r.focused=!0,setTimeout(function(){r.docView&&r.hasFocus()&&!r.domObserver.currentSelection.eq(r.root.getSelection())&&Ge(r)},20))};ce.blur=function(r,e){r.focused&&(r.domObserver.stop(),r.dom.classList.remove("ProseMirror-focused"),r.domObserver.start(),e.relatedTarget&&r.dom.contains(e.relatedTarget)&&r.domObserver.currentSelection.set({}),r.focused=!1)};ce.beforeinput=function(r,e){if(g.chrome&&g.android&&e.inputType=="deleteContentBackward"){r.domObserver.flushSoon();var t=r.domChangeCount;setTimeout(function(){if(r.domChangeCount==t&&(r.dom.blur(),r.focus(),!r.someProp("handleKeyDown",function(i){return i(r,kt(8,"Backspace"))}))){var n=r.state.selection,o=n.$cursor;o&&o.pos>0&&r.dispatch(r.state.tr.delete(o.pos-1,o.pos).scrollIntoView())}},50)}};for(var ls in le)ce[ls]=le[ls];function jt(r,e){if(r==e)return!0;for(var t in r)if(r[t]!==e[t])return!1;for(var n in e)if(!(n in r))return!1;return!0}var xt=function(e,t){this.spec=t||at,this.side=this.spec.side||0,this.toDOM=e};xt.prototype.map=function(e,t,n,o){var i=e.mapResult(t.from+o,this.side<0?-1:1),s=i.pos,a=i.deleted;return a?null:new _(s-n,s-n,this)};xt.prototype.valid=function(){return!0};xt.prototype.eq=function(e){return this==e||e instanceof xt&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&jt(this.spec,e.spec))};xt.prototype.destroy=function(e){this.spec.destroy&&this.spec.destroy(e)};var Ne=function(e,t){this.spec=t||at,this.attrs=e};Ne.prototype.map=function(e,t,n,o){var i=e.map(t.from+o,this.spec.inclusiveStart?-1:1)-n,s=e.map(t.to+o,this.spec.inclusiveEnd?1:-1)-n;return i>=s?null:new _(i,s,this)};Ne.prototype.valid=function(e,t){return t.from<t.to};Ne.prototype.eq=function(e){return this==e||e instanceof Ne&&jt(this.attrs,e.attrs)&&jt(this.spec,e.spec)};Ne.is=function(e){return e.type instanceof Ne};var Qt=function(e,t){this.spec=t||at,this.attrs=e};Qt.prototype.map=function(e,t,n,o){var i=e.mapResult(t.from+o,1);if(i.deleted)return null;var s=e.mapResult(t.to+o,-1);return s.deleted||s.pos<=i.pos?null:new _(i.pos-n,s.pos-n,this)};Qt.prototype.valid=function(e,t){var n=e.content.findIndex(t.from),o=n.index,i=n.offset,s;return i==t.from&&!(s=e.child(o)).isText&&i+s.nodeSize==t.to};Qt.prototype.eq=function(e){return this==e||e instanceof Qt&&jt(this.attrs,e.attrs)&&jt(this.spec,e.spec)};var _=function(e,t,n){this.from=e,this.to=t,this.type=n},Xn={spec:{configurable:!0},inline:{configurable:!0}};_.prototype.copy=function(e,t){return new _(e,t,this.type)};_.prototype.eq=function(e,t){return t===void 0&&(t=0),this.type.eq(e.type)&&this.from+t==e.from&&this.to+t==e.to};_.prototype.map=function(e,t,n){return this.type.map(e,this,t,n)};_.widget=function(e,t,n){return new _(e,e,new xt(t,n))};_.inline=function(e,t,n,o){return new _(e,t,new Ne(n,o))};_.node=function(e,t,n,o){return new _(e,t,new Qt(n,o))};Xn.spec.get=function(){return this.type.spec};Xn.inline.get=function(){return this.type instanceof Ne};Object.defineProperties(_.prototype,Xn);var Pr=[],at={},E=function(e,t){this.local=e&&e.length?e:Pr,this.children=t&&t.length?t:Pr};E.create=function(e,t){return t.length?zr(t,e,0,at):Q};E.prototype.find=function(e,t,n){var o=[];return this.findInner(e==null?0:e,t==null?1e9:t,o,0,n),o};E.prototype.findInner=function(e,t,n,o,i){for(var s=0;s<this.local.length;s++){var a=this.local[s];a.from<=t&&a.to>=e&&(!i||i(a.spec))&&n.push(a.copy(a.from+o,a.to+o))}for(var l=0;l<this.children.length;l+=3)if(this.children[l]<t&&this.children[l+1]>e){var f=this.children[l]+1;this.children[l+2].findInner(e-f,t-f,n,o+f,i)}};E.prototype.map=function(e,t,n){return this==Q||e.maps.length==0?this:this.mapInner(e,t,0,0,n||at)};E.prototype.mapInner=function(e,t,n,o,i){for(var s,a=0;a<this.local.length;a++){var l=this.local[a].map(e,n,o);l&&l.type.valid(t,l)?(s||(s=[])).push(l):i.onRemove&&i.onRemove(this.local[a].spec)}return this.children.length?gf(this.children,s,e,t,n,o,i):s?new E(s.sort(lt)):Q};E.prototype.add=function(e,t){return t.length?this==Q?E.create(e,t):this.addInner(e,t,0):this};E.prototype.addInner=function(e,t,n){var o=this,i,s=0;e.forEach(function(f,u){var c=u+n,p;if(!!(p=us(t,f,c))){for(i||(i=o.children.slice());s<i.length&&i[s]<u;)s+=3;i[s]==u?i[s+2]=i[s+2].addInner(f,p,c+1):i.splice(s,0,u,u+f.nodeSize,zr(p,f,c+1,at)),s+=3}});for(var a=fs(s?cs(t):t,-n),l=0;l<a.length;l++)a[l].type.valid(e,a[l])||a.splice(l--,1);return new E(a.length?this.local.concat(a).sort(lt):this.local,i||this.children)};E.prototype.remove=function(e){return e.length==0||this==Q?this:this.removeInner(e,0)};E.prototype.removeInner=function(e,t){for(var n=this.children,o=this.local,i=0;i<n.length;i+=3){for(var s=void 0,a=n[i]+t,l=n[i+1]+t,f=0,u=void 0;f<e.length;f++)(u=e[f])&&u.from>a&&u.to<l&&(e[f]=null,(s||(s=[])).push(u));if(!!s){n==this.children&&(n=this.children.slice());var c=n[i+2].removeInner(s,a+1);c!=Q?n[i+2]=c:(n.splice(i,3),i-=3)}}if(o.length){for(var p=0,h=void 0;p<e.length;p++)if(h=e[p])for(var d=0;d<o.length;d++)o[d].eq(h,t)&&(o==this.local&&(o=this.local.slice()),o.splice(d--,1))}return n==this.children&&o==this.local?this:o.length||n.length?new E(o,n):Q};E.prototype.forChild=function(e,t){if(this==Q)return this;if(t.isLeaf)return E.empty;for(var n,o,i=0;i<this.children.length;i+=3)if(this.children[i]>=e){this.children[i]==e&&(n=this.children[i+2]);break}for(var s=e+1,a=s+t.content.size,l=0;l<this.local.length;l++){var f=this.local[l];if(f.from<a&&f.to>s&&f.type instanceof Ne){var u=Math.max(s,f.from)-s,c=Math.min(a,f.to)-s;u<c&&(o||(o=[])).push(f.copy(u,c))}}if(o){var p=new E(o.sort(lt));return n?new Se([p,n]):p}return n||Q};E.prototype.eq=function(e){if(this==e)return!0;if(!(e instanceof E)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(var t=0;t<this.local.length;t++)if(!this.local[t].eq(e.local[t]))return!1;for(var n=0;n<this.children.length;n+=3)if(this.children[n]!=e.children[n]||this.children[n+1]!=e.children[n+1]||!this.children[n+2].eq(e.children[n+2]))return!1;return!0};E.prototype.locals=function(e){return Zn(this.localsInner(e))};E.prototype.localsInner=function(e){if(this==Q)return Pr;if(e.inlineContent||!this.local.some(Ne.is))return this.local;for(var t=[],n=0;n<this.local.length;n++)this.local[n].type instanceof Ne||t.push(this.local[n]);return t};var Q=new E;E.empty=Q;E.removeOverlap=Zn;var Se=function(e){this.members=e};Se.prototype.map=function(e,t){var n=this.members.map(function(o){return o.map(e,t,at)});return Se.from(n)};Se.prototype.forChild=function(e,t){if(t.isLeaf)return E.empty;for(var n=[],o=0;o<this.members.length;o++){var i=this.members[o].forChild(e,t);i!=Q&&(i instanceof Se?n=n.concat(i.members):n.push(i))}return Se.from(n)};Se.prototype.eq=function(e){if(!(e instanceof Se)||e.members.length!=this.members.length)return!1;for(var t=0;t<this.members.length;t++)if(!this.members[t].eq(e.members[t]))return!1;return!0};Se.prototype.locals=function(e){for(var t,n=!0,o=0;o<this.members.length;o++){var i=this.members[o].localsInner(e);if(!!i.length)if(!t)t=i;else{n&&(t=t.slice(),n=!1);for(var s=0;s<i.length;s++)t.push(i[s])}}return t?Zn(n?t:t.sort(lt)):Pr};Se.from=function(e){switch(e.length){case 0:return Q;case 1:return e[0];default:return new Se(e)}};function gf(r,e,t,n,o,i,s){for(var a=r.slice(),l=function(Pe,Ce,xe,fr){for(var ie=0;ie<a.length;ie+=3){var q=a[ie+1],nn=void 0;if(!(q<0||Pe>q+i)){var So=a[ie]+i;Ce>=So?a[ie+1]=Pe<=So?-2:-1:xe>=o&&(nn=fr-xe-(Ce-Pe))&&(a[ie]+=nn,a[ie+1]+=nn)}}},f=0;f<t.maps.length;f++)t.maps[f].forEach(l);for(var u=!1,c=0;c<a.length;c+=3)if(a[c+1]<0){if(a[c+1]==-2){u=!0,a[c+1]=-1;continue}var p=t.map(r[c]+i),h=p-o;if(h<0||h>=n.content.size){u=!0;continue}var d=t.map(r[c+1]+i,-1),v=d-o,b=n.content.findIndex(h),S=b.index,y=b.offset,O=n.maybeChild(S);if(O&&y==h&&y+O.nodeSize==v){var M=a[c+2].mapInner(t,O,p+1,r[c]+i+1,s);M!=Q?(a[c]=h,a[c+1]=v,a[c+2]=M):(a[c+1]=-2,u=!0)}else u=!0}if(u){var C=yf(a,r,e||[],t,o,i,s),T=zr(C,n,0,s);e=T.local;for(var P=0;P<a.length;P+=3)a[P+1]<0&&(a.splice(P,3),P-=3);for(var F=0,H=0;F<T.children.length;F+=3){for(var K=T.children[F];H<a.length&&a[H]<K;)H+=3;a.splice(H,0,T.children[F],T.children[F+1],T.children[F+2])}}return new E(e&&e.sort(lt),a)}function fs(r,e){if(!e||!r.length)return r;for(var t=[],n=0;n<r.length;n++){var o=r[n];t.push(new _(o.from+e,o.to+e,o.type))}return t}function yf(r,e,t,n,o,i,s){function a(f,u){for(var c=0;c<f.local.length;c++){var p=f.local[c].map(n,o,u);p?t.push(p):s.onRemove&&s.onRemove(f.local[c].spec)}for(var h=0;h<f.children.length;h+=3)a(f.children[h+2],f.children[h]+u+1)}for(var l=0;l<r.length;l+=3)r[l+1]==-1&&a(r[l+2],e[l]+i+1);return t}function us(r,e,t){if(e.isLeaf)return null;for(var n=t+e.nodeSize,o=null,i=0,s=void 0;i<r.length;i++)(s=r[i])&&s.from>t&&s.to<n&&((o||(o=[])).push(s),r[i]=null);return o}function cs(r){for(var e=[],t=0;t<r.length;t++)r[t]!=null&&e.push(r[t]);return e}function zr(r,e,t,n){var o=[],i=!1;e.forEach(function(l,f){var u=us(r,l,f+t);if(u){i=!0;var c=zr(u,l,t+f+1,n);c!=Q&&o.push(f,f+l.nodeSize,c)}});for(var s=fs(i?cs(r):r,-t).sort(lt),a=0;a<s.length;a++)s[a].type.valid(e,s[a])||(n.onRemove&&n.onRemove(s[a].spec),s.splice(a--,1));return s.length||o.length?new E(s,o):Q}function lt(r,e){return r.from-e.from||r.to-e.to}function Zn(r){for(var e=r,t=0;t<e.length-1;t++){var n=e[t];if(n.from!=n.to)for(var o=t+1;o<e.length;o++){var i=e[o];if(i.from==n.from){i.to!=n.to&&(e==r&&(e=r.slice()),e[o]=i.copy(i.from,n.to),ps(e,o+1,i.copy(n.to,i.to)));continue}else{i.from<n.to&&(e==r&&(e=r.slice()),e[t]=n.copy(n.from,i.from),ps(e,o,n.copy(i.from,n.to)));break}}}return e}function ps(r,e,t){for(;e<r.length&&lt(t,r[e])>0;)e++;r.splice(e,0,t)}function $n(r){var e=[];return r.someProp("decorations",function(t){var n=t(r.state);n&&n!=Q&&e.push(n)}),r.cursorWrapper&&e.push(E.create(r.state.doc,[r.cursorWrapper.deco])),Se.from(e)}var V=function(e,t){this._props=t,this.state=t.state,this.directPlugins=t.plugins||[],this.directPlugins.forEach(gs),this.dispatch=this.dispatch.bind(this),this._root=null,this.focused=!1,this.trackWrites=null,this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):e.apply?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=ms(this),this.markCursor=null,this.cursorWrapper=null,ds(this),this.nodeViews=vs(this),this.docView=wi(this.state.doc,hs(this),$n(this),this.dom,this),this.lastSelectedViewDesc=null,this.dragging=null,$l(this),this.prevDirectPlugins=[],this.pluginViews=[],this.updatePluginViews()},Fr={props:{configurable:!0},root:{configurable:!0},isDestroyed:{configurable:!0}};Fr.props.get=function(){if(this._props.state!=this.state){var r=this._props;this._props={};for(var e in r)this._props[e]=r[e];this._props.state=this.state}return this._props};V.prototype.update=function(e){e.handleDOMEvents!=this._props.handleDOMEvents&&Un(this),this._props=e,e.plugins&&(e.plugins.forEach(gs),this.directPlugins=e.plugins),this.updateStateInner(e.state,!0)};V.prototype.setProps=function(e){var t={};for(var n in this._props)t[n]=this._props[n];t.state=this.state;for(var o in e)t[o]=e[o];this.update(t)};V.prototype.updateState=function(e){this.updateStateInner(e,this.state.plugins!=e.plugins)};V.prototype.updateStateInner=function(e,t){var n=this,o=this.state,i=!1,s=!1;if(e.storedMarks&&this.composing&&(ss(this),s=!0),this.state=e,t){var a=vs(this);kf(a,this.nodeViews)&&(this.nodeViews=a,i=!0),Un(this)}this.editable=ms(this),ds(this);var l=$n(this),f=hs(this),u=t?"reset":e.scrollToSelection>o.scrollToSelection?"to selection":"preserve",c=i||!this.docView.matchesNode(e.doc,f,l);(c||!e.selection.eq(o.selection))&&(s=!0);var p=u=="preserve"&&s&&this.dom.style.overflowAnchor==null&&pl(this);if(s){this.domObserver.stop();var h=c&&(g.ie||g.chrome)&&!this.composing&&!o.selection.empty&&!e.selection.empty&&bf(o.selection,e.selection);if(c){var d=g.chrome?this.trackWrites=this.root.getSelection().focusNode:null;(i||!this.docView.update(e.doc,f,l,this))&&(this.docView.updateOuterDeco([]),this.docView.destroy(),this.docView=wi(e.doc,f,l,this.dom,this)),d&&!this.trackWrites&&(h=!0)}h||!(this.mouseDown&&this.domObserver.currentSelection.eq(this.root.getSelection())&&Fl(this))?Ge(this,h):(_i(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}if(this.updatePluginViews(o),u=="reset")this.dom.scrollTop=0;else if(u=="to selection"){var v=this.root.getSelection().focusNode;this.someProp("handleScrollToSelection",function(b){return b(n)})||(e.selection instanceof x?di(this,this.docView.domAfterPos(e.selection.from).getBoundingClientRect(),v):di(this,this.coordsAtPos(e.selection.head,1),v))}else p&&hl(p)};V.prototype.destroyPluginViews=function(){for(var e;e=this.pluginViews.pop();)e.destroy&&e.destroy()};V.prototype.updatePluginViews=function(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(var t=0;t<this.directPlugins.length;t++){var n=this.directPlugins[t];n.spec.view&&this.pluginViews.push(n.spec.view(this))}for(var o=0;o<this.state.plugins.length;o++){var i=this.state.plugins[o];i.spec.view&&this.pluginViews.push(i.spec.view(this))}}else for(var s=0;s<this.pluginViews.length;s++){var a=this.pluginViews[s];a.update&&a.update(this,e)}};V.prototype.someProp=function(e,t){var n=this._props&&this._props[e],o;if(n!=null&&(o=t?t(n):n))return o;for(var i=0;i<this.directPlugins.length;i++){var s=this.directPlugins[i].props[e];if(s!=null&&(o=t?t(s):s))return o}var a=this.state.plugins;if(a)for(var l=0;l<a.length;l++){var f=a[l].props[e];if(f!=null&&(o=t?t(f):f))return o}};V.prototype.hasFocus=function(){return this.root.activeElement==this.dom};V.prototype.focus=function(){this.domObserver.stop(),this.editable&&dl(this.dom),Ge(this),this.domObserver.start()};Fr.root.get=function(){var r=this._root;if(r==null){for(var e=this.dom.parentNode;e;e=e.parentNode)if(e.nodeType==9||e.nodeType==11&&e.host)return e.getSelection||(Object.getPrototypeOf(e).getSelection=function(){return document.getSelection()}),this._root=e}return r||document};V.prototype.posAtCoords=function(e){return bl(this,e)};V.prototype.coordsAtPos=function(e,t){return t===void 0&&(t=1),bi(this,e,t)};V.prototype.domAtPos=function(e,t){return t===void 0&&(t=0),this.docView.domFromPos(e,t)};V.prototype.nodeDOM=function(e){var t=this.docView.descAt(e);return t?t.nodeDOM:null};V.prototype.posAtDOM=function(e,t,n){n===void 0&&(n=-1);var o=this.docView.posFromDOM(e,t,n);if(o==null)throw new RangeError("DOM position not inside the editor");return o};V.prototype.endOfTextblock=function(e,t){return xl(this,t||this.state,e)};V.prototype.destroy=function(){!this.docView||(ef(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],$n(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null)};Fr.isDestroyed.get=function(){return this.docView==null};V.prototype.dispatchEvent=function(e){return rf(this,e)};V.prototype.dispatch=function(e){var t=this._props.dispatchTransaction;t?t.call(this,e):this.updateState(this.state.apply(e))};Object.defineProperties(V.prototype,Fr);function hs(r){var e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(r.editable),e.translate="no",r.someProp("attributes",function(t){if(typeof t=="function"&&(t=t(r.state)),t)for(var n in t)n=="class"&&(e.class+=" "+t[n]),n=="style"?e.style=(e.style?e.style+";":"")+t[n]:!e[n]&&n!="contenteditable"&&n!="nodeName"&&(e[n]=String(t[n]))}),[_.node(0,r.state.doc.content.size,e)]}function ds(r){if(r.markCursor){var e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),r.cursorWrapper={dom:e,deco:_.widget(r.state.selection.head,e,{raw:!0,marks:r.markCursor})}}else r.cursorWrapper=null}function ms(r){return!r.someProp("editable",function(e){return e(r.state)===!1})}function bf(r,e){var t=Math.min(r.$anchor.sharedDepth(r.head),e.$anchor.sharedDepth(e.head));return r.$anchor.start(t)!=e.$anchor.start(t)}function vs(r){var e={};return r.someProp("nodeViews",function(t){for(var n in t)Object.prototype.hasOwnProperty.call(e,n)||(e[n]=t[n])}),e}function kf(r,e){var t=0,n=0;for(var o in r){if(r[o]!=e[o])return!0;t++}for(var i in e)n++;return t!=n}function gs(r){if(r.spec.state||r.spec.filterTransaction||r.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var Yt=new W({state:{init(){return E.empty},apply(r,e){e=e.map(r.mapping,r.doc);let t=r.getMeta(this);if(t&&t.add){let n=document.createElement("placeholder"),o=_.widget(t.add.pos,n,{id:t.add.id});e=e.add(r.doc,[o])}else t&&t.remove&&(e=e.remove(e.find(null,null,n=>n.id==t.remove.id)));return e}},props:{decorations(r){return this.getState(r)}}});function _r(r,{nodeType:e}){let t={},n=r.editorView.state.tr;n.selection.empty||n.deleteSelection(),r.editorNode.addEventListener("replacePlaceholder",function(i){eo(r,i)}),n.setMeta(Yt,{add:{id:t,pos:n.selection.from}}),r.editorView.dispatch(n);let o={detail:{nodeType:e,id:t,tr:n}};r.editorNode.dispatchEvent(new CustomEvent("insertPlaceholder",o))}function eo(r,{detail:e}){let t=Mf(r.editorView.state,e.id);t!=null&&Sf({node:e.callback(r.editorView.state.schema.nodes),id:e.id,pos:t,exEditorView:r})}function Sf({exEditorView:r,id:e,pos:t,node:n}){r.editorView.dispatch(r.editorView.state.tr.replaceWith(t,t,n).setMeta(Yt,{remove:{id:e}}))}function Mf(r,e){let n=Yt.getState(r).find(null,null,o=>o.id==e);return n.length?n[0].from:null}var Vr={};Ze(Vr,{marks:()=>Ot,nodes:()=>Ve,schema:()=>If});var Cf=["p",0],xf=["blockquote",0],Of=["hr"],wf=["pre",["code",0]],Nf=["br"],Ve={doc:{content:"block+"},paragraph:{content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM:function(){return Cf}},blockquote:{content:"block+",group:"block",defining:!0,parseDOM:[{tag:"blockquote"}],toDOM:function(){return xf}},horizontal_rule:{group:"block",parseDOM:[{tag:"hr"}],toDOM:function(){return Of}},heading:{attrs:{level:{default:1}},content:"inline*",group:"block",defining:!0,parseDOM:[{tag:"h1",attrs:{level:1}},{tag:"h2",attrs:{level:2}},{tag:"h3",attrs:{level:3}},{tag:"h4",attrs:{level:4}},{tag:"h5",attrs:{level:5}},{tag:"h6",attrs:{level:6}}],toDOM:function(e){return["h"+e.attrs.level,0]}},code_block:{content:"text*",marks:"",group:"block",code:!0,defining:!0,parseDOM:[{tag:"pre",preserveWhitespace:"full"}],toDOM:function(){return wf}},text:{group:"inline"},image:{inline:!0,attrs:{src:{},alt:{default:null},title:{default:null}},group:"inline",draggable:!0,parseDOM:[{tag:"img[src]",getAttrs:function(e){return{src:e.getAttribute("src"),title:e.getAttribute("title"),alt:e.getAttribute("alt")}}}],toDOM:function(e){var t=e.attrs,n=t.src,o=t.alt,i=t.title;return["img",{src:n,alt:o,title:i}]}},hard_break:{inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM:function(){return Nf}}},Df=["em",0],Tf=["strong",0],Ef=["code",0],Ot={link:{attrs:{href:{},title:{default:null}},inclusive:!1,parseDOM:[{tag:"a[href]",getAttrs:function(e){return{href:e.getAttribute("href"),title:e.getAttribute("title")}}}],toDOM:function(e){var t=e.attrs,n=t.href,o=t.title;return["a",{href:n,title:o},0]}},em:{parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style=italic"}],toDOM:function(){return Df}},strong:{parseDOM:[{tag:"strong"},{tag:"b",getAttrs:function(r){return r.style.fontWeight!="normal"&&null}},{style:"font-weight",getAttrs:function(r){return/^(bold(er)?|[5-9]\d{2,})$/.test(r)&&null}}],toDOM:function(){return Tf}},code:{parseDOM:[{tag:"code"}],toDOM:function(){return Ef}}},If=new Oe({nodes:Ve,marks:Ot});var Kr={};Ze(Kr,{cmdItem:()=>fo,generateColorsMenu:()=>uo,generateFontFamilyMenu:()=>co,generateHTMLItem:()=>js,generateHeadingItem:()=>Us,generateMarkItem:()=>Tt,generateMediaMenu:()=>Qs,generateMultiMarkItem:()=>po,generateParagraphItem:()=>Gs,markActive:()=>Xs,markItem:()=>Ys,menuHelper:()=>Et,multiMarkItem:()=>Hr});function fe(){var r=arguments[0];typeof r=="string"&&(r=document.createElement(r));var e=1,t=arguments[1];if(t&&typeof t=="object"&&t.nodeType==null&&!Array.isArray(t)){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var o=t[n];typeof o=="string"?r.setAttribute(n,o):o!=null&&(r[n]=o)}e++}for(;e<arguments.length;e++)ys(r,arguments[e]);return r}function ys(r,e){if(typeof e=="string")r.appendChild(document.createTextNode(e));else if(e!=null)if(e.nodeType!=null)r.appendChild(e);else if(Array.isArray(e))for(var t=0;t<e.length;t++)ys(r,e[t]);else throw new RangeError("Unsupported child node: "+e)}function bs(r,e){return r.selection.empty?!1:(e&&e(r.tr.deleteSelection().scrollIntoView()),!0)}function Af(r,e,t){var n=r.selection,o=n.$cursor;if(!o||(t?!t.endOfTextblock("backward",r):o.parentOffset>0))return!1;var i=ks(o);if(!i){var s=o.blockRange(),a=s&&rt(s);return a==null?!1:(e&&e(r.tr.lift(s,a).scrollIntoView()),!0)}var l=i.nodeBefore;if(!l.type.spec.isolating&&Cs(r,i,e))return!0;if(o.parent.content.size==0&&(wt(l,"end")||x.isSelectable(l))){var f=Sr(r.doc,o.before(),o.after(),k.empty);if(f.slice.size<f.to-f.from){if(e){var u=r.tr.step(f);u.setSelection(wt(l,"end")?N.findFrom(u.doc.resolve(u.mapping.map(i.pos,-1)),-1):x.create(u.doc,i.pos-l.nodeSize)),e(u.scrollIntoView())}return!0}}return l.isAtom&&i.depth==o.depth-1?(e&&e(r.tr.delete(i.pos-l.nodeSize,i.pos).scrollIntoView()),!0):!1}function wt(r,e,t){for(;r;r=e=="start"?r.firstChild:r.lastChild){if(r.isTextblock)return!0;if(t&&r.childCount!=1)return!1}return!1}function Rf(r,e,t){var n=r.selection,o=n.$head,i=n.empty,s=o;if(!i)return!1;if(o.parent.isTextblock){if(t?!t.endOfTextblock("backward",r):o.parentOffset>0)return!1;s=ks(o)}var a=s&&s.nodeBefore;return!a||!x.isSelectable(a)?!1:(e&&e(r.tr.setSelection(x.create(r.doc,s.pos-a.nodeSize)).scrollIntoView()),!0)}function ks(r){if(!r.parent.type.spec.isolating)for(var e=r.depth-1;e>=0;e--){if(r.index(e)>0)return r.doc.resolve(r.before(e+1));if(r.node(e).type.spec.isolating)break}return null}function Pf(r,e,t){var n=r.selection,o=n.$cursor;if(!o||(t?!t.endOfTextblock("forward",r):o.parentOffset<o.parent.content.size))return!1;var i=Ss(o);if(!i)return!1;var s=i.nodeAfter;if(Cs(r,i,e))return!0;if(o.parent.content.size==0&&(wt(s,"start")||x.isSelectable(s))){var a=Sr(r.doc,o.before(),o.after(),k.empty);if(a.slice.size<a.to-a.from){if(e){var l=r.tr.step(a);l.setSelection(wt(s,"start")?N.findFrom(l.doc.resolve(l.mapping.map(i.pos)),1):x.create(l.doc,l.mapping.map(i.pos))),e(l.scrollIntoView())}return!0}}return s.isAtom&&i.depth==o.depth-1?(e&&e(r.tr.delete(i.pos,i.pos+s.nodeSize).scrollIntoView()),!0):!1}function zf(r,e,t){var n=r.selection,o=n.$head,i=n.empty,s=o;if(!i)return!1;if(o.parent.isTextblock){if(t?!t.endOfTextblock("forward",r):o.parentOffset<o.parent.content.size)return!1;s=Ss(o)}var a=s&&s.nodeAfter;return!a||!x.isSelectable(a)?!1:(e&&e(r.tr.setSelection(x.create(r.doc,s.pos)).scrollIntoView()),!0)}function Ss(r){if(!r.parent.type.spec.isolating)for(var e=r.depth-1;e>=0;e--){var t=r.node(e);if(r.index(e)+1<t.childCount)return r.doc.resolve(r.after(e+1));if(t.type.spec.isolating)break}return null}function Xt(r,e){var t=r.selection,n=t instanceof x,o;if(n){if(t.node.isTextblock||!nt(r.doc,t.from))return!1;o=t.from}else if(o=yn(r.doc,t.from,-1),o==null)return!1;if(e){var i=r.tr.join(o);n&&i.setSelection(x.create(i.doc,o-r.doc.resolve(o).nodeBefore.nodeSize)),e(i.scrollIntoView())}return!0}function Ms(r,e){var t=r.selection,n;if(t instanceof x){if(t.node.isTextblock||!nt(r.doc,t.to))return!1;n=t.to}else if(n=yn(r.doc,t.to,1),n==null)return!1;return e&&e(r.tr.join(n).scrollIntoView()),!0}function Zt(r,e){var t=r.selection,n=t.$from,o=t.$to,i=n.blockRange(o),s=i&&rt(i);return s==null?!1:(e&&e(r.tr.lift(i,s).scrollIntoView()),!0)}function Ff(r,e){var t=r.selection,n=t.$head,o=t.$anchor;return!n.parent.type.spec.code||!n.sameParent(o)?!1:(e&&e(r.tr.insertText(`
`).scrollIntoView()),!0)}function to(r){for(var e=0;e<r.edgeCount;e++){var t=r.edge(e),n=t.type;if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}function $t(r,e){var t=r.selection,n=t.$head,o=t.$anchor;if(!n.parent.type.spec.code||!n.sameParent(o))return!1;var i=n.node(-1),s=n.indexAfter(-1),a=to(i.contentMatchAt(s));if(!i.canReplaceWith(s,s,a))return!1;if(e){var l=n.after(),f=r.tr.replaceWith(l,l,a.createAndFill());f.setSelection(N.near(f.doc.resolve(l),1)),e(f.scrollIntoView())}return!0}function Bf(r,e){var t=r.selection,n=t.$from,o=t.$to;if(t instanceof be||n.parent.inlineContent||o.parent.inlineContent)return!1;var i=to(o.parent.contentMatchAt(o.indexAfter()));if(!i||!i.isTextblock)return!1;if(e){var s=(!n.parentOffset&&o.index()<o.parent.childCount?n:o).pos,a=r.tr.insert(s,i.createAndFill());a.setSelection(I.create(a.doc,s+1)),e(a.scrollIntoView())}return!0}function _f(r,e){var t=r.selection,n=t.$cursor;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){var o=n.before();if(Je(r.doc,o))return e&&e(r.tr.split(o).scrollIntoView()),!0}var i=n.blockRange(),s=i&&rt(i);return s==null?!1:(e&&e(r.tr.lift(i,s).scrollIntoView()),!0)}function Vf(r,e){var t=r.selection,n=t.$from,o=t.$to;if(r.selection instanceof x&&r.selection.node.isBlock)return!n.parentOffset||!Je(r.doc,n.pos)?!1:(e&&e(r.tr.split(n.pos).scrollIntoView()),!0);if(!n.parent.isBlock)return!1;if(e){var i=o.parentOffset==o.parent.content.size,s=r.tr;(r.selection instanceof I||r.selection instanceof be)&&s.deleteSelection();var a=n.depth==0?null:to(n.node(-1).contentMatchAt(n.indexAfter(-1))),l=i&&a?[{type:a}]:null,f=Je(s.doc,s.mapping.map(n.pos),1,l);if(!l&&!f&&Je(s.doc,s.mapping.map(n.pos),1,a&&[{type:a}])&&(l=[{type:a}],f=!0),f&&(s.split(s.mapping.map(n.pos),1,l),!i&&!n.parentOffset&&n.parent.type!=a)){var u=s.mapping.map(n.before()),c=s.doc.resolve(u);n.node(-1).canReplaceWith(c.index(),c.index()+1,a)&&s.setNodeMarkup(s.mapping.map(n.before()),a)}e(s.scrollIntoView())}return!0}function er(r,e){var t=r.selection,n=t.$from,o=t.to,i,s=n.sharedDepth(o);return s==0?!1:(i=n.before(s),e&&e(r.tr.setSelection(x.create(r.doc,i))),!0)}function qf(r,e){return e&&e(r.tr.setSelection(new be(r.doc))),!0}function Lf(r,e,t){var n=e.nodeBefore,o=e.nodeAfter,i=e.index();return!n||!o||!n.type.compatibleContent(o.type)?!1:!n.content.size&&e.parent.canReplace(i-1,i)?(t&&t(r.tr.delete(e.pos-n.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(i,i+1)||!(o.isTextblock||nt(r.doc,e.pos))?!1:(t&&t(r.tr.clearIncompatible(e.pos,n.type,n.contentMatchAt(n.childCount)).join(e.pos).scrollIntoView()),!0)}function Cs(r,e,t){var n=e.nodeBefore,o=e.nodeAfter,i,s;if(n.type.spec.isolating||o.type.spec.isolating)return!1;if(Lf(r,e,t))return!0;var a=e.parent.canReplace(e.index(),e.index()+1);if(a&&(i=(s=n.contentMatchAt(n.childCount)).findWrapping(o.type))&&s.matchType(i[0]||o.type).validEnd){if(t){for(var l=e.pos+o.nodeSize,f=m.empty,u=i.length-1;u>=0;u--)f=m.from(i[u].create(null,f));f=m.from(n.copy(f));var c=r.tr.step(new oe(e.pos-1,l,e.pos,l,new k(f,1,0),i.length,!0)),p=l+2*i.length;nt(c.doc,p)&&c.join(p),t(c.scrollIntoView())}return!0}var h=N.findFrom(e,1),d=h&&h.$from.blockRange(h.$to),v=d&&rt(d);if(v!=null&&v>=e.depth)return t&&t(r.tr.lift(d,v).scrollIntoView()),!0;if(a&&wt(o,"start",!0)&&wt(n,"end")){for(var b=n,S=[];S.push(b),!b.isTextblock;)b=b.lastChild;for(var y=o,O=1;!y.isTextblock;y=y.firstChild)O++;if(b.canReplace(b.childCount,b.childCount,y.content)){if(t){for(var M=m.empty,C=S.length-1;C>=0;C--)M=m.from(S[C].copy(M));var T=r.tr.step(new oe(e.pos-S.length,e.pos+o.nodeSize,e.pos+O,e.pos+o.nodeSize-O,new k(M,S.length,0),0,!0));t(T.scrollIntoView())}return!0}}return!1}function xs(r){return function(e,t){for(var n=e.selection,o=r<0?n.$from:n.$to,i=o.depth;o.node(i).isInline;){if(!i)return!1;i--}return o.node(i).isTextblock?(t&&t(e.tr.setSelection(I.create(e.doc,r<0?o.start(i):o.end(i)))),!0):!1}}var Jf=xs(-1),Wf=xs(1);function tr(r,e){return function(t,n){var o=t.selection,i=o.$from,s=o.$to,a=i.blockRange(s),l=a&&gt(a,r,e);return l?(n&&n(t.tr.wrap(a,l).scrollIntoView()),!0):!1}}function Nt(r,e){return function(t,n){var o=t.selection,i=o.from,s=o.to,a=!1;return t.doc.nodesBetween(i,s,function(l,f){if(a)return!1;if(!(!l.isTextblock||l.hasMarkup(r,e)))if(l.type==r)a=!0;else{var u=t.doc.resolve(f),c=u.index();a=u.parent.canReplaceWith(c,c+1,r)}}),a?(n&&n(t.tr.setBlockType(i,s,r,e).scrollIntoView()),!0):!1}}function Hf(r,e,t){for(var n=function(s){var a=e[s],l=a.$from,f=a.$to,u=l.depth==0?r.type.allowsMarkType(t):!1;if(r.nodesBetween(l.pos,f.pos,function(c){if(u)return!1;u=c.inlineContent&&c.type.allowsMarkType(t)}),u)return{v:!0}},o=0;o<e.length;o++){var i=n(o);if(i)return i.v}return!1}function De(r,e){return function(t,n){var o=t.selection,i=o.empty,s=o.$cursor,a=o.ranges;if(i&&!s||!Hf(t.doc,a,r))return!1;if(n)if(s)r.isInSet(t.storedMarks||s.marks())?n(t.tr.removeStoredMark(r)):n(t.tr.addStoredMark(r.create(e)));else{for(var l=!1,f=t.tr,u=0;!l&&u<a.length;u++){var c=a[u],p=c.$from,h=c.$to;l=t.doc.rangeHasMark(p.pos,h.pos,r)}for(var d=0;d<a.length;d++){var v=a[d],b=v.$from,S=v.$to;if(l)f.removeMark(b.pos,S.pos,r);else{var y=b.pos,O=S.pos,M=b.nodeAfter,C=S.nodeBefore,T=M&&M.isText?/^\s*/.exec(M.text)[0].length:0,P=C&&C.isText?/\s*$/.exec(C.text)[0].length:0;y+T<O&&(y+=T,O-=P),f.addMark(y,O,r.create(e))}}n(f.scrollIntoView())}return!0}}function ft(){for(var r=[],e=arguments.length;e--;)r[e]=arguments[e];return function(t,n,o){for(var i=0;i<r.length;i++)if(r[i](t,n,o))return!0;return!1}}var ro=ft(bs,Af,Rf),Os=ft(bs,Pf,zf),qe={Enter:ft(Ff,Bf,_f,Vf),"Mod-Enter":$t,Backspace:ro,"Mod-Backspace":ro,"Shift-Backspace":ro,Delete:Os,"Mod-Delete":Os,"Mod-a":qf},ws={"Ctrl-h":qe.Backspace,"Alt-Backspace":qe["Mod-Backspace"],"Ctrl-d":qe.Delete,"Ctrl-Alt-Backspace":qe["Mod-Delete"],"Alt-Delete":qe["Mod-Delete"],"Alt-d":qe["Mod-Delete"],"Ctrl-a":Jf,"Ctrl-e":Wf};for(var Ns in qe)ws[Ns]=qe[Ns];var Kf=typeof navigator!="undefined"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os!="undefined"?os.platform()=="darwin":!1,rr=Kf?ws:qe;var qr=200,Y=function(){};Y.prototype.append=function(e){return e.length?(e=Y.from(e),!this.length&&e||e.length<qr&&this.leafAppend(e)||this.length<qr&&e.leafPrepend(this)||this.appendInner(e)):this};Y.prototype.prepend=function(e){return e.length?Y.from(e).append(this):this};Y.prototype.appendInner=function(e){return new Uf(this,e)};Y.prototype.slice=function(e,t){return e===void 0&&(e=0),t===void 0&&(t=this.length),e>=t?Y.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,t))};Y.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};Y.prototype.forEach=function(e,t,n){t===void 0&&(t=0),n===void 0&&(n=this.length),t<=n?this.forEachInner(e,t,n,0):this.forEachInvertedInner(e,t,n,0)};Y.prototype.map=function(e,t,n){t===void 0&&(t=0),n===void 0&&(n=this.length);var o=[];return this.forEach(function(i,s){return o.push(e(i,s))},t,n),o};Y.from=function(e){return e instanceof Y?e:e&&e.length?new Ds(e):Y.empty};var Ds=function(r){function e(n){r.call(this),this.values=n}r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e;var t={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(o,i){return o==0&&i==this.length?this:new e(this.values.slice(o,i))},e.prototype.getInner=function(o){return this.values[o]},e.prototype.forEachInner=function(o,i,s,a){for(var l=i;l<s;l++)if(o(this.values[l],a+l)===!1)return!1},e.prototype.forEachInvertedInner=function(o,i,s,a){for(var l=i-1;l>=s;l--)if(o(this.values[l],a+l)===!1)return!1},e.prototype.leafAppend=function(o){if(this.length+o.length<=qr)return new e(this.values.concat(o.flatten()))},e.prototype.leafPrepend=function(o){if(this.length+o.length<=qr)return new e(o.flatten().concat(this.values))},t.length.get=function(){return this.values.length},t.depth.get=function(){return 0},Object.defineProperties(e.prototype,t),e}(Y);Y.empty=new Ds([]);var Uf=function(r){function e(t,n){r.call(this),this.left=t,this.right=n,this.length=t.length+n.length,this.depth=Math.max(t.depth,n.depth)+1}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(n){return n<this.left.length?this.left.get(n):this.right.get(n-this.left.length)},e.prototype.forEachInner=function(n,o,i,s){var a=this.left.length;if(o<a&&this.left.forEachInner(n,o,Math.min(i,a),s)===!1||i>a&&this.right.forEachInner(n,Math.max(o-a,0),Math.min(this.length,i)-a,s+a)===!1)return!1},e.prototype.forEachInvertedInner=function(n,o,i,s){var a=this.left.length;if(o>a&&this.right.forEachInvertedInner(n,o-a,Math.max(i,a)-a,s+a)===!1||i<a&&this.left.forEachInvertedInner(n,Math.min(o,a),i,s)===!1)return!1},e.prototype.sliceInner=function(n,o){if(n==0&&o==this.length)return this;var i=this.left.length;return o<=i?this.left.slice(n,o):n>=i?this.right.slice(n-i,o-i):this.left.slice(n,i).append(this.right.slice(0,o-i))},e.prototype.leafAppend=function(n){var o=this.right.leafAppend(n);if(o)return new e(this.left,o)},e.prototype.leafPrepend=function(n){var o=this.left.leafPrepend(n);if(o)return new e(o,this.right)},e.prototype.appendInner=function(n){return this.left.depth>=Math.max(this.right.depth,n.depth)+1?new e(this.left,new e(this.right,n)):new e(this,n)},e}(Y),Gf=Y,no=Gf;var jf=500,X=function(e,t){this.items=e,this.eventCount=t};X.prototype.popEvent=function(e,t){var n=this;if(this.eventCount==0)return null;for(var o=this.items.length;;o--){var i=this.items.get(o-1);if(i.selection){--o;break}}var s,a;t&&(s=this.remapping(o,this.items.length),a=s.maps.length);var l=e.tr,f,u,c=[],p=[];return this.items.forEach(function(h,d){if(!h.step){s||(s=n.remapping(o,d+1),a=s.maps.length),a--,p.push(h);return}if(s){p.push(new Ae(h.map));var v=h.step.map(s.slice(a)),b;v&&l.maybeStep(v).doc&&(b=l.mapping.maps[l.mapping.maps.length-1],c.push(new Ae(b,null,null,c.length+p.length))),a--,b&&s.appendMap(b,a)}else l.maybeStep(h.step);if(h.selection)return f=s?h.selection.map(s.slice(a)):h.selection,u=new X(n.items.slice(0,o).append(p.reverse().concat(c)),n.eventCount-1),!1},this.items.length,0),{remaining:u,transform:l,selection:f}};X.prototype.addTransform=function(e,t,n,o){for(var i=[],s=this.eventCount,a=this.items,l=!o&&a.length?a.get(a.length-1):null,f=0;f<e.steps.length;f++){var u=e.steps[f].invert(e.docs[f]),c=new Ae(e.mapping.maps[f],u,t),p=void 0;(p=l&&l.merge(c))&&(c=p,f?i.pop():a=a.slice(0,a.length-1)),i.push(c),t&&(s++,t=null),o||(l=c)}var h=s-n.depth;return h>Yf&&(a=Qf(a,h),s-=h),new X(a.append(i),s)};X.prototype.remapping=function(e,t){var n=new j;return this.items.forEach(function(o,i){var s=o.mirrorOffset!=null&&i-o.mirrorOffset>=e?n.maps.length-o.mirrorOffset:null;n.appendMap(o.map,s)},e,t),n};X.prototype.addMaps=function(e){return this.eventCount==0?this:new X(this.items.append(e.map(function(t){return new Ae(t)})),this.eventCount)};X.prototype.rebased=function(e,t){if(!this.eventCount)return this;var n=[],o=Math.max(0,this.items.length-t),i=e.mapping,s=e.steps.length,a=this.eventCount;this.items.forEach(function(h){h.selection&&a--},o);var l=t;this.items.forEach(function(h){var d=i.getMirror(--l);if(d!=null){s=Math.min(s,d);var v=i.maps[d];if(h.step){var b=e.steps[d].invert(e.docs[d]),S=h.selection&&h.selection.map(i.slice(l+1,d));S&&a++,n.push(new Ae(v,b,S))}else n.push(new Ae(v))}},o);for(var f=[],u=t;u<s;u++)f.push(new Ae(i.maps[u]));var c=this.items.slice(0,o).append(f).append(n),p=new X(c,a);return p.emptyItemCount()>jf&&(p=p.compress(this.items.length-n.length)),p};X.prototype.emptyItemCount=function(){var e=0;return this.items.forEach(function(t){t.step||e++}),e};X.prototype.compress=function(e){e===void 0&&(e=this.items.length);var t=this.remapping(0,e),n=t.maps.length,o=[],i=0;return this.items.forEach(function(s,a){if(a>=e)o.push(s),s.selection&&i++;else if(s.step){var l=s.step.map(t.slice(n)),f=l&&l.getMap();if(n--,f&&t.appendMap(f,n),l){var u=s.selection&&s.selection.map(t.slice(n));u&&i++;var c=new Ae(f.invert(),l,u),p,h=o.length-1;(p=o.length&&o[h].merge(c))?o[h]=p:o.push(c)}}else s.map&&n--},this.items.length,0),new X(no.from(o.reverse()),i)};X.empty=new X(no.empty,0);function Qf(r,e){var t;return r.forEach(function(n,o){if(n.selection&&e--==0)return t=o,!1}),r.slice(t)}var Ae=function(e,t,n,o){this.map=e,this.step=t,this.selection=n,this.mirrorOffset=o};Ae.prototype.merge=function(e){if(this.step&&e.step&&!e.selection){var t=e.step.merge(this.step);if(t)return new Ae(t.getMap().invert(),t,this.selection)}};var je=function(e,t,n,o){this.done=e,this.undone=t,this.prevRanges=n,this.prevTime=o},Yf=20;function Xf(r,e,t,n){var o=t.getMeta(Qe),i;if(o)return o.historyState;t.getMeta($f)&&(r=new je(r.done,r.undone,null,0));var s=t.getMeta("appendedTransaction");if(t.steps.length==0)return r;if(s&&s.getMeta(Qe))return s.getMeta(Qe).redo?new je(r.done.addTransform(t,null,n,Lr(e)),r.undone,Ts(t.mapping.maps[t.steps.length-1]),r.prevTime):new je(r.done,r.undone.addTransform(t,null,n,Lr(e)),null,r.prevTime);if(t.getMeta("addToHistory")!==!1&&!(s&&s.getMeta("addToHistory")===!1)){var a=r.prevTime==0||!s&&(r.prevTime<(t.time||0)-n.newGroupDelay||!Zf(t,r.prevRanges)),l=s?oo(r.prevRanges,t.mapping):Ts(t.mapping.maps[t.steps.length-1]);return new je(r.done.addTransform(t,a?e.selection.getBookmark():null,n,Lr(e)),X.empty,l,t.time)}else return(i=t.getMeta("rebased"))?new je(r.done.rebased(t,i),r.undone.rebased(t,i),oo(r.prevRanges,t.mapping),r.prevTime):new je(r.done.addMaps(t.mapping.maps),r.undone.addMaps(t.mapping.maps),oo(r.prevRanges,t.mapping),r.prevTime)}function Zf(r,e){if(!e)return!1;if(!r.docChanged)return!0;var t=!1;return r.mapping.maps[0].forEach(function(n,o){for(var i=0;i<e.length;i+=2)n<=e[i+1]&&o>=e[i]&&(t=!0)}),t}function Ts(r){var e=[];return r.forEach(function(t,n,o,i){return e.push(o,i)}),e}function oo(r,e){if(!r)return null;for(var t=[],n=0;n<r.length;n+=2){var o=e.map(r[n],1),i=e.map(r[n+1],-1);o<=i&&t.push(o,i)}return t}function Es(r,e,t,n){var o=Lr(e),i=Qe.get(e).spec.config,s=(n?r.undone:r.done).popEvent(e,o);if(!!s){var a=s.selection.resolve(s.transform.doc),l=(n?r.done:r.undone).addTransform(s.transform,e.selection.getBookmark(),i,o),f=new je(n?l:s.remaining,n?s.remaining:l,null,0);t(s.transform.setSelection(a).setMeta(Qe,{redo:n,historyState:f}).scrollIntoView())}}var io=!1,Is=null;function Lr(r){var e=r.plugins;if(Is!=e){io=!1,Is=e;for(var t=0;t<e.length;t++)if(e[t].spec.historyPreserveItems){io=!0;break}}return io}var Qe=new bt("history"),$f=new bt("closeHistory");function As(r){return r={depth:r&&r.depth||100,newGroupDelay:r&&r.newGroupDelay||500},new W({key:Qe,state:{init:function(){return new je(X.empty,X.empty,null,0)},apply:function(t,n,o){return Xf(n,o,t,r)}},config:r,props:{handleDOMEvents:{beforeinput:function(t,n){var o=n.inputType=="historyUndo"?Dt(t.state,t.dispatch):n.inputType=="historyRedo"?ut(t.state,t.dispatch):!1;return o&&n.preventDefault(),o}}}})}function Dt(r,e){var t=Qe.getState(r);return!t||t.done.eventCount==0?!1:(e&&Es(t,r,e,!1),!0)}function ut(r,e){var t=Qe.getState(r);return!t||t.undone.eventCount==0?!1:(e&&Es(t,r,e,!0),!0)}var nr="http://www.w3.org/2000/svg",eu="http://www.w3.org/1999/xlink",so="ProseMirror-icon";function tu(r){for(var e=0,t=0;t<r.length;t++)e=(e<<5)-e+r.charCodeAt(t)|0;return e}function ru(r){var e=document.createElement("div");if(e.className=so,r.path){var t="pm-icon-"+tu(r.path).toString(16);document.getElementById(t)||nu(t,r);var n=e.appendChild(document.createElementNS(nr,"svg"));n.style.width=r.width/r.height+"em";var o=n.appendChild(document.createElementNS(nr,"use"));o.setAttributeNS(eu,"href",/([^#]*)/.exec(document.location)[1]+"#"+t)}else r.dom?e.appendChild(r.dom.cloneNode(!0)):(e.appendChild(document.createElement("span")).textContent=r.text||"",r.css&&(e.firstChild.style.cssText=r.css));return e}function nu(r,e){var t=document.getElementById(so+"-collection");t||(t=document.createElementNS(nr,"svg"),t.id=so+"-collection",t.style.display="none",document.body.insertBefore(t,document.body.firstChild));var n=document.createElementNS(nr,"symbol");n.id=r,n.setAttribute("viewBox","0 0 "+e.width+" "+e.height);var o=n.appendChild(document.createElementNS(nr,"path"));o.setAttribute("d",e.path),t.appendChild(n)}var pe="ProseMirror-menu",Z=function(e){this.spec=e};Z.prototype.render=function(e){var t=this.spec,n=t.render?t.render(e):t.icon?ru(t.icon):t.label?fe("div",null,or(e,t.label)):null;if(!n)throw new RangeError("MenuItem without icon or label property");if(t.title){var o=typeof t.title=="function"?t.title(e.state):t.title;n.setAttribute("title",or(e,o))}t.class&&n.classList.add(t.class),t.css&&(n.style.cssText+=t.css),n.addEventListener("mousedown",function(s){s.preventDefault(),n.classList.contains(pe+"-disabled")||t.run(e.state,e.dispatch,e,s)});function i(s){if(t.select){var a=t.select(s);if(n.style.display=a?"":"none",!a)return!1}var l=!0;if(t.enable&&(l=t.enable(s)||!1,lo(n,pe+"-disabled",!l)),t.active){var f=l&&t.active(s)||!1;lo(n,pe+"-active",f)}return!0}return{dom:n,update:i}};function or(r,e){return r._props.translate?r._props.translate(e):e}var ir={time:0,node:null};function Rs(r){ir.time=Date.now(),ir.node=r.target}function Ps(r){return Date.now()-100<ir.time&&ir.node&&r.contains(ir.node)}var Ye=function(e,t){this.options=t||{},this.content=Array.isArray(e)?e:[e]};Ye.prototype.render=function(e){var t=this,n=zs(this.content,e),o=fe("div",{class:pe+"-dropdown "+(this.options.class||""),style:this.options.css},or(e,this.options.label));this.options.title&&o.setAttribute("title",or(e,this.options.title));var i=fe("div",{class:pe+"-dropdown-wrap"},o),s=null,a=null,l=function(){s&&s.close()&&(s=null,window.removeEventListener("mousedown",a))};o.addEventListener("mousedown",function(u){u.preventDefault(),Rs(u),s?l():(s=t.expand(i,n.dom),window.addEventListener("mousedown",a=function(){Ps(i)||l()}))});function f(u){var c=n.update(u);return i.style.display=c?"":"none",c}return{dom:i,update:f}};Ye.prototype.expand=function(e,t){var n=fe("div",{class:pe+"-dropdown-menu "+(this.options.class||"")},t),o=!1;function i(){if(!o)return o=!0,e.removeChild(n),!0}return e.appendChild(n),{close:i,node:n}};function zs(r,e){for(var t=[],n=[],o=0;o<r.length;o++){var i=r[o].render(e),s=i.dom,a=i.update;t.push(fe("div",{class:pe+"-dropdown-item"},s)),n.push(a)}return{dom:t,update:Fs(n,t)}}function Fs(r,e){return function(t){for(var n=!1,o=0;o<r.length;o++){var i=r[o](t);e[o].style.display=i?"":"none",i&&(n=!0)}return n}}var ao=function(e,t){this.options=t||{},this.content=Array.isArray(e)?e:[e]};ao.prototype.render=function(e){var t=zs(this.content,e),n=fe("div",{class:pe+"-submenu-label"},or(e,this.options.label)),o=fe("div",{class:pe+"-submenu-wrap"},n,fe("div",{class:pe+"-submenu"},t.dom)),i=null;n.addEventListener("mousedown",function(a){a.preventDefault(),Rs(a),lo(o,pe+"-submenu-wrap-active"),i||window.addEventListener("mousedown",i=function(){Ps(o)||(o.classList.remove(pe+"-submenu-wrap-active"),window.removeEventListener("mousedown",i),i=null)})});function s(a){var l=t.update(a);return o.style.display=l?"":"none",l}return{dom:o,update:s}};function ou(r,e){for(var t=document.createDocumentFragment(),n=[],o=[],i=0;i<e.length;i++){for(var s=e[i],a=[],l=[],f=0;f<s.length;f++){var u=s[f].render(r),c=u.dom,p=u.update,h=fe("span",{class:pe+"item"},c);t.appendChild(h),l.push(h),a.push(p)}a.length&&(n.push(Fs(a,l)),i<e.length-1&&o.push(t.appendChild(iu())))}function d(v){for(var b=!1,S=!1,y=0;y<n.length;y++){var O=n[y](v);y&&(o[y-1].style.display=S&&O?"":"none"),S=O,O&&(b=!0)}return b}return{dom:t,update:d}}function iu(){return fe("span",{class:pe+"separator"})}var ue={join:{width:800,height:900,path:"M0 75h800v125h-800z M0 825h800v-125h-800z M250 400h100v-100h100v100h100v100h-100v100h-100v-100h-100z"},lift:{width:1024,height:1024,path:"M219 310v329q0 7-5 12t-12 5q-8 0-13-5l-164-164q-5-5-5-13t5-13l164-164q5-5 13-5 7 0 12 5t5 12zM1024 749v109q0 7-5 12t-12 5h-987q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h987q7 0 12 5t5 12zM1024 530v109q0 7-5 12t-12 5h-621q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h621q7 0 12 5t5 12zM1024 310v109q0 7-5 12t-12 5h-621q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h621q7 0 12 5t5 12zM1024 91v109q0 7-5 12t-12 5h-987q-7 0-12-5t-5-12v-109q0-7 5-12t12-5h987q7 0 12 5t5 12z"},selectParentNode:{text:"\u2B1A",css:"font-weight: bold"},undo:{width:1024,height:1024,path:"M761 1024c113-206 132-520-313-509v253l-384-384 384-384v248c534-13 594 472 313 775z"},redo:{width:1024,height:1024,path:"M576 248v-248l384 384-384 384v-253c-446-10-427 303-313 509-280-303-221-789 313-775z"},strong:{width:805,height:1024,path:"M317 869q42 18 80 18 214 0 214-191 0-65-23-102-15-25-35-42t-38-26-46-14-48-6-54-1q-41 0-57 5 0 30-0 90t-0 90q0 4-0 38t-0 55 2 47 6 38zM309 442q24 4 62 4 46 0 81-7t62-25 42-51 14-81q0-40-16-70t-45-46-61-24-70-8q-28 0-74 7 0 28 2 86t2 86q0 15-0 45t-0 45q0 26 0 39zM0 950l1-53q8-2 48-9t60-15q4-6 7-15t4-19 3-18 1-21 0-19v-37q0-561-12-585-2-4-12-8t-25-6-28-4-27-2-17-1l-2-47q56-1 194-6t213-5q13 0 39 0t38 0q40 0 78 7t73 24 61 40 42 59 16 78q0 29-9 54t-22 41-36 32-41 25-48 22q88 20 146 76t58 141q0 57-20 102t-53 74-78 48-93 27-100 8q-25 0-75-1t-75-1q-60 0-175 6t-132 6z"},em:{width:585,height:1024,path:"M0 949l9-48q3-1 46-12t63-21q16-20 23-57 0-4 35-165t65-310 29-169v-14q-13-7-31-10t-39-4-33-3l10-58q18 1 68 3t85 4 68 1q27 0 56-1t69-4 56-3q-2 22-10 50-17 5-58 16t-62 19q-4 10-8 24t-5 22-4 26-3 24q-15 84-50 239t-44 203q-1 5-7 33t-11 51-9 47-3 32l0 10q9 2 105 17-1 25-9 56-6 0-18 0t-18 0q-16 0-49-5t-49-5q-78-1-117-1-29 0-81 5t-69 6z"},code:{width:896,height:1024,path:"M608 192l-96 96 224 224-224 224 96 96 288-320-288-320zM288 192l-288 320 288 320 96-96-224-224 224-224-96-96z"},link:{width:951,height:1024,path:"M832 694q0-22-16-38l-118-118q-16-16-38-16-24 0-41 18 1 1 10 10t12 12 8 10 7 14 2 15q0 22-16 38t-38 16q-8 0-15-2t-14-7-10-8-12-12-10-10q-18 17-18 41 0 22 16 38l117 118q15 15 38 15 22 0 38-14l84-83q16-16 16-38zM430 292q0-22-16-38l-117-118q-16-16-38-16-22 0-38 15l-84 83q-16 16-16 38 0 22 16 38l118 118q15 15 38 15 24 0 41-17-1-1-10-10t-12-12-8-10-7-14-2-15q0-22 16-38t38-16q8 0 15 2t14 7 10 8 12 12 10 10q18-17 18-41zM941 694q0 68-48 116l-84 83q-47 47-116 47-69 0-116-48l-117-118q-47-47-47-116 0-70 50-119l-50-50q-49 50-118 50-68 0-116-48l-118-118q-48-48-48-116t48-116l84-83q47-47 116-47 69 0 116 48l117 118q47 47 47 116 0 70-50 119l50 50q49-50 118-50 68 0 116 48l118 118q48 48 48 116z"},bulletList:{width:768,height:896,path:"M0 512h128v-128h-128v128zM0 256h128v-128h-128v128zM0 768h128v-128h-128v128zM256 512h512v-128h-512v128zM256 256h512v-128h-512v128zM256 768h512v-128h-512v128z"},orderedList:{width:768,height:896,path:"M320 512h448v-128h-448v128zM320 768h448v-128h-448v128zM320 128v128h448v-128h-448zM79 384h78v-256h-36l-85 23v50l43-2v185zM189 590c0-36-12-78-96-78-33 0-64 6-83 16l1 66c21-10 42-15 67-15s32 11 32 28c0 26-30 58-110 112v50h192v-67l-91 2c49-30 87-66 87-113l1-1z"},blockquote:{width:640,height:896,path:"M0 448v256h256v-256h-128c0 0 0-128 128-128v-128c0 0-256 0-256 256zM640 320v-128c0 0-256 0-256 256v256h256v-256h-128c0 0 0-128 128-128z"}},Bs=new Z({title:"Join with above block",run:Xt,select:function(r){return Xt(r)},icon:ue.join}),_s=new Z({title:"Lift out of enclosing block",run:Zt,select:function(r){return Zt(r)},icon:ue.lift}),Vs=new Z({title:"Select parent node",run:er,select:function(r){return er(r)},icon:ue.selectParentNode}),qs=new Z({title:"Undo last change",run:Dt,enable:function(r){return Dt(r)},icon:ue.undo}),Ls=new Z({title:"Redo last undone change",run:ut,enable:function(r){return ut(r)},icon:ue.redo});function Js(r,e){var t={run:function(i,s){return tr(r,e.attrs)(i,s)},select:function(i){return tr(r,e.attrs instanceof Function?null:e.attrs)(i)}};for(var n in e)t[n]=e[n];return new Z(t)}function ct(r,e){var t=Nt(r,e.attrs),n={run:t,enable:function(s){return t(s)},active:function(s){var a=s.selection,l=a.$from,f=a.to,u=a.node;return u?u.hasMarkup(r,e.attrs):f<=l.end()&&l.parent.hasMarkup(r,e.attrs)}};for(var o in e)n[o]=e[o];return new Z(n)}function lo(r,e,t){t?r.classList.add(e):r.classList.remove(e)}var Jr="ProseMirror-menubar";function su(){if(typeof navigator=="undefined")return!1;var r=navigator.userAgent;return!/Edge\/\d/.test(r)&&/AppleWebKit/.test(r)&&/Mobile\/\w+/.test(r)}function Ws(r){return new W({view:function(t){return new sr(t,r)}})}var sr=function(e,t){var n=this;this.editorView=e,this.options=t,this.wrapper=fe("div",{class:Jr+"-wrapper"}),this.menu=this.wrapper.appendChild(fe("div",{class:Jr})),this.menu.className=Jr,this.spacer=null,e.dom.parentNode.replaceChild(this.wrapper,e.dom),this.wrapper.appendChild(e.dom),this.maxHeight=0,this.widthForMaxHeight=0,this.floating=!1;var o=ou(this.editorView,this.options.content),i=o.dom,s=o.update;if(this.contentUpdate=s,this.menu.appendChild(i),this.update(),t.floating&&!su()){this.updateFloat();var a=fu(this.wrapper);this.scrollFunc=function(l){var f=n.editorView.root;(f.body||f).contains(n.wrapper)?n.updateFloat(l.target.getBoundingClientRect&&l.target):a.forEach(function(u){return u.removeEventListener("scroll",n.scrollFunc)})},a.forEach(function(l){return l.addEventListener("scroll",n.scrollFunc)})}};sr.prototype.update=function(){this.contentUpdate(this.editorView.state),this.floating?this.updateScrollCursor():(this.menu.offsetWidth!=this.widthForMaxHeight&&(this.widthForMaxHeight=this.menu.offsetWidth,this.maxHeight=0),this.menu.offsetHeight>this.maxHeight&&(this.maxHeight=this.menu.offsetHeight,this.menu.style.minHeight=this.maxHeight+"px"))};sr.prototype.updateScrollCursor=function(){var e=this.editorView.root.getSelection();if(!!e.focusNode){var t=e.getRangeAt(0).getClientRects(),n=t[au(e)?0:t.length-1];if(!!n){var o=this.menu.getBoundingClientRect();if(n.top<o.bottom&&n.bottom>o.top){var i=lu(this.wrapper);i&&(i.scrollTop-=o.bottom-n.top)}}}};sr.prototype.updateFloat=function(e){var t=this.wrapper,n=t.getBoundingClientRect(),o=e?Math.max(0,e.getBoundingClientRect().top):0;if(this.floating)if(n.top>=o||n.bottom<this.menu.offsetHeight+10)this.floating=!1,this.menu.style.position=this.menu.style.left=this.menu.style.top=this.menu.style.width="",this.menu.style.display="",this.spacer.parentNode.removeChild(this.spacer),this.spacer=null;else{var i=(t.offsetWidth-t.clientWidth)/2;this.menu.style.left=n.left+i+"px",this.menu.style.display=n.top>window.innerHeight?"none":"",e&&(this.menu.style.top=o+"px")}else if(n.top<o&&n.bottom>=this.menu.offsetHeight+10){this.floating=!0;var s=this.menu.getBoundingClientRect();this.menu.style.left=s.left+"px",this.menu.style.width=s.width+"px",e&&(this.menu.style.top=o+"px"),this.menu.style.position="fixed",this.spacer=fe("div",{class:Jr+"-spacer",style:"height: "+s.height+"px"}),t.insertBefore(this.spacer,this.menu)}};sr.prototype.destroy=function(){this.wrapper.parentNode&&this.wrapper.parentNode.replaceChild(this.editorView.dom,this.wrapper)};function au(r){return r.anchorNode==r.focusNode?r.anchorOffset>r.focusOffset:r.anchorNode.compareDocumentPosition(r.focusNode)==Node.DOCUMENT_POSITION_FOLLOWING}function lu(r){for(var e=r.parentNode;e;e=e.parentNode)if(e.scrollHeight>e.clientHeight)return e}function fu(r){for(var e=[window],t=r.parentNode;t;t=t.parentNode)e.push(t);return e}var Wr=he(ee({},ue),{strikethrough:{width:22,height:22,path:"M15.6 8.5c-.5-.7-1-1.1-1.3-1.3c-.6-.4-1.3-.6-2-.6c-2.7 0-2.8 1.7-2.8 2.1c0 1.6 1.8 2 3.2 2.3c4.4.9 4.6 2.8 4.6 3.9c0 1.4-.7 4.1-5 4.1A6.2 6.2 0 017 16.4l1.5-1.1c.4.6 1.6 2 3.7 2c1.6 0 2.5-.4 3-1.2c.4-.8.3-2-.8-2.6c-.7-.4-1.6-.7-2.9-1c-1-.2-3.9-.8-3.9-3.6C7.6 6 10.3 5 12.4 5c2.9 0 4.2 1.6 4.7 2.4l-1.5 1.1zM5 11h14a1 1 0 010 2H5a1 1 0 010-2z"},underline:{width:22,height:20,path:"M16 5c.6 0 1 .4 1 1v5.5a4 4 0 01-.4 1.8l-1 1.4a5.3 5.3 0 01-5.5 1a5 5 0 01-1.6-1c-.5-.4-.8-.9-1.1-1.4a4 4 0 01-.4-1.8V6c0-.6.4-1 1-1s1 .4 1 1v5.5c0 .3 0 .6.2 1l.6.7a3.3 3.3 0 002.2.8a3.4 3.4 0 002.2-.8c.3-.2.4-.5.6-.8l.2-.9V6c0-.6.4-1 1-1zM8 17h8c.6 0 1 .4 1 1s-.4 1-1 1H8a1 1 0 010-2z"}});function Hs(r,e){return function(t,n){let{empty:o,$cursor:i,ranges:s}=t.selection;if(o&&!i)return!1;if(n)if(i)r.isInSet(t.storedMarks||i.marks())&&n(t.tr.removeStoredMark(r)),e&&n(t.tr.addStoredMark(r.create(e)));else{let a=!1,l=t.tr;for(let f=0;!a&&f<s.length;f++){let{$from:u,$to:c}=s[f];a=t.doc.rangeHasMark(u.pos,c.pos,r)}for(let f=0;f<s.length;f++){let{$from:u,$to:c}=s[f],p=u.pos,h=c.pos,d=u.nodeAfter,v=c.nodeBefore,b=d&&d.isText?/^\s*/.exec(d.text)[0].length:0,S=v&&v.isText?/\s*$/.exec(v.text)[0].length:0;p+b<h&&(p+=b,h-=S),e?l.addMark(p,h,r.create(e)):l.removeMark(p,h,r)}n(l.scrollIntoView())}return!0}}var Ks=(r,e)=>{let t={};return r.map(n=>{e[n.type]&&(t[n.type]=he(ee({},e[n.type]),{config:n}))}),t};function uu({name:r,spec:{title:e}}){return e||r}var Us=r=>r.nodes.heading?r.nodes.heading.spec.config.values.map(e=>ct(r.nodes.heading,{title:"Header "+e,label:"Header "+e,attrs:{level:e}})):[],Gs=r=>r.nodes.paragraph?[ct(r.nodes.paragraph,{title:"paragraph",label:"paragraph"})]:[],js=r=>r.nodes.html?[new Z({title:"Insert HTML code",label:"HTML",enable(){return!0},run(e,t,n){n.dom.parentNode.parentNode.dispatchEvent(new CustomEvent("exProsemirrorInsertPlaceholder",{detail:{nodeType:"html"}}))}})]:[],Qs=r=>r.nodes.image?[new Z({title:"Insert image",label:"Image",enable(){return!0},run(e,t,n){n.dom.parentNode.parentNode.dispatchEvent(new CustomEvent("exProsemirrorInsertPlaceholder",{detail:{nodeType:"image"}}))}})]:[],Tt=r=>e=>{if(!e.marks[r])return[];let t=e.marks[r],n=t.spec.icon||Wr[r];return[Ys(e.marks[r],{title:uu(t),icon:n})]};function Ys(r,e){let t={active(n){return Xs(n,r)},enable:!0};for(let n in e)t[n]=e[n];return fo(De(r),t)}function fo(r,e){let t={label:e.title,run:r};for(let n in e)t[n]=e[n];return(!e.enable||e.enable===!0)&&!e.select&&(t[e.enable?"enable":"select"]=n=>r(n)),new Z(t)}function Xs(r,e){let{from:t,$from:n,to:o,empty:i}=r.selection;return i?e.isInSet(r.storedMarks||n.marks()):r.doc.rangeHasMark(t,o,e)}var uo=r=>{let e=po(r,"color");return[new Ye(e,{label:"Color"})]},co=r=>{let e=po(r,"font_family");return[new Ye(e,{label:"Font"})]},po=(r,e)=>{if(!r.marks[e])return[];let t=[Hr(r.marks[e],{title:"default"})],n=r.marks[e].spec.config.values;if(Array.isArray(n))for(let o of n){let i=[];i[e]=o,t.push(Hr(r.marks[e],{title:o},i))}else for(let[o,i]of Object.entries(n)){let s=[];s[e]=i,t.push(Hr(r.marks[e],{title:o},s))}return t};function Hr(r,e,t){return fo(Hs(r,t),ee({enable:!0},e))}var Et={generateParagraphItem:Gs,generateHeadingItem:Us,generateHTMLItem:js,generateMediaMenu:Qs};var Zs={strong:he(ee({},Ot.strong),{generateMenuItem:Tt("strong")}),em:he(ee({},Ot.em),{generateMenuItem:Tt("em")}),link:ee({},Ot.link),strikethrough:{toDOM(){return["del",0]},parseDOM:[{tag:"del"}],generateMenuItem:Tt("strikethrough")},underline:{toDOM(){return["span",{style:"text-decoration: underline"},0]},parseDOM:[{tag:"span"}],generateMenuItem:Tt("underline")},color:{title:"Color",label:"Color",attrs:{color:{}},toDOM(r){return["span",{style:"color: "+r.attrs.color},0]},parseDOM:[{tag:"span",getAttrs(r){return{color:r.style.color}}}],generateMenuItem:uo},font_family:{title:"Font",label:"Font",attrs:{font_family:{}},toDOM(r){return["span",{style:"font-family: "+r.attrs.font_family},0]},parseDOM:[{tag:"span",getAttrs(r){return{font_family:r.style["font-family"]}}}],generateMenuItem:co}},Ur=({marksSelection:r,marks:e})=>Ks(r,e);function cu(r,e){return e?{content:"block?"}:r.doc}var $s=(r,e,t)=>{let n={text:e.text,doc:cu(e,t)};return r.map(o=>{e[o.type]&&(n[o.type]=he(ee({},e[o.type]),{config:o}))}),n};var pu=he(ee({},Ve.paragraph),{generateMenuItem:Et.generateParagraphItem}),hu=he(ee({},Ve.heading),{generateMenuItem:Et.generateHeadingItem}),du={inline:!0,attrs:{html:{default:null}},group:"inline",draggable:!1,parseDOM:[{tag:"div[html]",getAttrs(r){return{html:r.getAttribute("html")}}}],toDOM(r){let{html:e}=r.attrs,t=document.createElement("div");return t.innerHTML=e,t},generateMenuItem:Et.generateHTMLItem},mu=he(ee({},Ve.image),{inline:!1,group:"block",generateMenuItem:Et.generateMediaMenu}),ea={doc:Ve.doc,text:Ve.text,hard_break:Ve.hard_break,paragraph:pu,heading:hu,image:mu,html:du},Gr=({blocksSelection:r,blocks:e,inline:t})=>$s(r,e,t);var pt=r=>new Oe({nodes:Gr(r),marks:Ur(r)});var It=class{constructor(e,t){this.editorNode=e,this.target=e.dataset.target+"_plain",this.editorView=new V(e,{state:this.initializeEditorState(t),dispatchTransaction:n=>{this.dispatchTransaction(n)}}),this.addListeners()}initializeEditorState({blocks:e,marks:t,plugins:n}){let o={marksSelection:JSON.parse(this.editorNode.dataset.marks),blocksSelection:JSON.parse(this.editorNode.dataset.blocks),inline:JSON.parse(this.editorNode.dataset.inline),blocks:e,marks:t},i=pt(o);return n=n(i).map((s,a)=>(s.key.startsWith("plugin$")&&(s.key="plugin$"+a),s)),J.create({doc:this.getDoc(i),plugins:n})}getDoc(e){let t=document.querySelector(this.target).value;if(t.length>0)try{return e.nodeFromJSON(JSON.parse(t))}catch(n){return se.fromSchema(e).parse("")}else return se.fromSchema(e).parse("")}addListeners(){let e=this;this.editorNode.addEventListener("exProsemirrorInsertPlaceholder",({detail:t})=>{_r(e,{nodeType:t.nodeType})})}dispatchTransaction(e){let t=this.editorView.state.apply(e),n=t.doc.toJSON(),o=document.querySelector(this.target);o.value=JSON.stringify(n),o.dispatchEvent(new CustomEvent("change",{detail:JSON.parse(o.value)})),this.editorView.updateState(t)}};var tn={};Ze(tn,{buildInputRules:()=>Ma,buildKeymap:()=>Sa,buildMenuItems:()=>ba,exampleSetup:()=>en});var Le={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",229:"q"},jr={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"',229:"Q"},ta=typeof navigator!="undefined"&&/Chrome\/(\d+)/.exec(navigator.userAgent),vu=typeof navigator!="undefined"&&/Apple Computer/.test(navigator.vendor),gu=typeof navigator!="undefined"&&/Gecko\/\d+/.test(navigator.userAgent),ra=typeof navigator!="undefined"&&/Mac/.test(navigator.platform),yu=typeof navigator!="undefined"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),bu=ta&&(ra||+ta[1]<57)||gu&&ra;for(var $=0;$<10;$++)Le[48+$]=Le[96+$]=String($);for(var $=1;$<=24;$++)Le[$+111]="F"+$;for(var $=65;$<=90;$++)Le[$]=String.fromCharCode($+32),jr[$]=String.fromCharCode($);for(var ho in Le)jr.hasOwnProperty(ho)||(jr[ho]=Le[ho]);function na(r){var e=bu&&(r.ctrlKey||r.altKey||r.metaKey)||(vu||yu)&&r.shiftKey&&r.key&&r.key.length==1,t=!e&&r.key||(r.shiftKey?jr:Le)[r.keyCode]||r.key||"Unidentified";return t=="Esc"&&(t="Escape"),t=="Del"&&(t="Delete"),t=="Left"&&(t="ArrowLeft"),t=="Up"&&(t="ArrowUp"),t=="Right"&&(t="ArrowRight"),t=="Down"&&(t="ArrowDown"),t}var ku=typeof navigator!="undefined"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):!1;function Su(r){var e=r.split(/-(?!$)/),t=e[e.length-1];t=="Space"&&(t=" ");for(var n,o,i,s,a=0;a<e.length-1;a++){var l=e[a];if(/^(cmd|meta|m)$/i.test(l))s=!0;else if(/^a(lt)?$/i.test(l))n=!0;else if(/^(c|ctrl|control)$/i.test(l))o=!0;else if(/^s(hift)?$/i.test(l))i=!0;else if(/^mod$/i.test(l))ku?s=!0:o=!0;else throw new Error("Unrecognized modifier name: "+l)}return n&&(t="Alt-"+t),o&&(t="Ctrl-"+t),s&&(t="Meta-"+t),i&&(t="Shift-"+t),t}function Mu(r){var e=Object.create(null);for(var t in r)e[Su(t)]=r[t];return e}function mo(r,e,t){return e.altKey&&(r="Alt-"+r),e.ctrlKey&&(r="Ctrl-"+r),e.metaKey&&(r="Meta-"+r),t!==!1&&e.shiftKey&&(r="Shift-"+r),r}function At(r){return new W({props:{handleKeyDown:vo(r)}})}function vo(r){var e=Mu(r);return function(t,n){var o=na(n),i=o.length==1&&o!=" ",s,a=e[mo(o,n,!i)];if(a&&a(t.state,t.dispatch,t))return!0;if(i&&(n.shiftKey||n.altKey||n.metaKey||o.charCodeAt(0)>127)&&(s=Le[n.keyCode])&&s!=o){var l=e[mo(s,n,!0)];if(l&&l(t.state,t.dispatch,t))return!0}else if(i&&n.shiftKey){var f=e[mo(o,n,!0)];if(f&&f(t.state,t.dispatch,t))return!0}return!1}}function oa(r){return r===void 0&&(r={}),new W({view:function(t){return new Re(t,r)}})}var Re=function(e,t){var n=this;this.editorView=e,this.width=t.width||1,this.color=t.color||"black",this.class=t.class,this.cursorPos=null,this.element=null,this.timeout=null,this.handlers=["dragover","dragend","drop","dragleave"].map(function(o){var i=function(s){return n[o](s)};return e.dom.addEventListener(o,i),{name:o,handler:i}})};Re.prototype.destroy=function(){var e=this;this.handlers.forEach(function(t){var n=t.name,o=t.handler;return e.editorView.dom.removeEventListener(n,o)})};Re.prototype.update=function(e,t){this.cursorPos!=null&&t.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())};Re.prototype.setCursor=function(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())};Re.prototype.updateOverlay=function(){var e=this.editorView.state.doc.resolve(this.cursorPos),t;if(!e.parent.inlineContent){var n=e.nodeBefore,o=e.nodeAfter;if(n||o){var i=this.editorView.nodeDOM(this.cursorPos-(n?n.nodeSize:0)).getBoundingClientRect(),s=n?i.bottom:i.top;n&&o&&(s=(s+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),t={left:i.left,right:i.right,top:s-this.width/2,bottom:s+this.width/2}}}if(!t){var a=this.editorView.coordsAtPos(this.cursorPos);t={left:a.left-this.width/2,right:a.left+this.width/2,top:a.top,bottom:a.bottom}}var l=this.editorView.dom.offsetParent;this.element||(this.element=l.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none; background-color: "+this.color);var f,u;if(!l||l==document.body&&getComputedStyle(l).position=="static")f=-pageXOffset,u=-pageYOffset;else{var c=l.getBoundingClientRect();f=c.left-l.scrollLeft,u=c.top-l.scrollTop}this.element.style.left=t.left-f+"px",this.element.style.top=t.top-u+"px",this.element.style.width=t.right-t.left+"px",this.element.style.height=t.bottom-t.top+"px"};Re.prototype.scheduleRemoval=function(e){var t=this;clearTimeout(this.timeout),this.timeout=setTimeout(function(){return t.setCursor(null)},e)};Re.prototype.dragover=function(e){if(!!this.editorView.editable){var t=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),n=t&&t.inside>=0&&this.editorView.state.doc.nodeAt(t.inside),o=n&&n.type.spec.disableDropCursor,i=typeof o=="function"?o(this.editorView,t):o;if(t&&!i){var s=t.pos;if(this.editorView.dragging&&this.editorView.dragging.slice&&(s=kr(this.editorView.state.doc,s,this.editorView.dragging.slice),s==null))return this.setCursor(null);this.setCursor(s),this.scheduleRemoval(5e3)}}};Re.prototype.dragend=function(){this.scheduleRemoval(20)};Re.prototype.drop=function(){this.scheduleRemoval(20)};Re.prototype.dragleave=function(e){(e.target==this.editorView.dom||!this.editorView.dom.contains(e.relatedTarget))&&this.setCursor(null)};var Me=function(r){function e(t){r.call(this,t,t)}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.map=function(n,o){var i=n.resolve(o.map(this.head));return e.valid(i)?new e(i):r.near(i)},e.prototype.content=function(){return k.empty},e.prototype.eq=function(n){return n instanceof e&&n.head==this.head},e.prototype.toJSON=function(){return{type:"gapcursor",pos:this.head}},e.fromJSON=function(n,o){if(typeof o.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new e(n.resolve(o.pos))},e.prototype.getBookmark=function(){return new Qr(this.anchor)},e.valid=function(n){var o=n.parent;if(o.isTextblock||!Cu(n)||!xu(n))return!1;var i=o.type.spec.allowGapCursor;if(i!=null)return i;var s=o.contentMatchAt(n.index()).defaultType;return s&&s.isTextblock},e.findFrom=function(n,o,i){e:for(;;){if(!i&&e.valid(n))return n;for(var s=n.pos,a=null,l=n.depth;;l--){var f=n.node(l);if(o>0?n.indexAfter(l)<f.childCount:n.index(l)>0){a=f.child(o>0?n.indexAfter(l):n.index(l)-1);break}else if(l==0)return null;s+=o;var u=n.doc.resolve(s);if(e.valid(u))return u}for(;;){var c=o>0?a.firstChild:a.lastChild;if(!c){if(a.isAtom&&!a.isText&&!x.isSelectable(a)){n=n.doc.resolve(s+a.nodeSize*o),i=!1;continue e}break}a=c,s+=o;var p=n.doc.resolve(s);if(e.valid(p))return p}return null}},e}(N);Me.prototype.visible=!1;N.jsonID("gapcursor",Me);var Qr=function(e){this.pos=e};Qr.prototype.map=function(e){return new Qr(e.map(this.pos))};Qr.prototype.resolve=function(e){var t=e.resolve(this.pos);return Me.valid(t)?new Me(t):N.near(t)};function Cu(r){for(var e=r.depth;e>=0;e--){var t=r.index(e),n=r.node(e);if(t==0){if(n.type.spec.isolating)return!0;continue}for(var o=n.child(t-1);;o=o.lastChild){if(o.childCount==0&&!o.inlineContent||o.isAtom||o.type.spec.isolating)return!0;if(o.inlineContent)return!1}}return!0}function xu(r){for(var e=r.depth;e>=0;e--){var t=r.indexAfter(e),n=r.node(e);if(t==n.childCount){if(n.type.spec.isolating)return!0;continue}for(var o=n.child(t);;o=o.firstChild){if(o.childCount==0&&!o.inlineContent||o.isAtom||o.type.spec.isolating)return!0;if(o.inlineContent)return!1}}return!0}var ia=function(){return new W({props:{decorations:Du,createSelectionBetween:function(e,t,n){if(t.pos==n.pos&&Me.valid(n))return new Me(n)},handleClick:wu,handleKeyDown:Ou,handleDOMEvents:{beforeinput:Nu}}})},Ou=vo({ArrowLeft:Yr("horiz",-1),ArrowRight:Yr("horiz",1),ArrowUp:Yr("vert",-1),ArrowDown:Yr("vert",1)});function Yr(r,e){var t=r=="vert"?e>0?"down":"up":e>0?"right":"left";return function(n,o,i){var s=n.selection,a=e>0?s.$to:s.$from,l=s.empty;if(s instanceof I){if(!i.endOfTextblock(t)||a.depth==0)return!1;l=!1,a=n.doc.resolve(e>0?a.after():a.before())}var f=Me.findFrom(a,e,l);return f?(o&&o(n.tr.setSelection(new Me(f))),!0):!1}}function wu(r,e,t){if(!r.editable)return!1;var n=r.state.doc.resolve(e);if(!Me.valid(n))return!1;var o=r.posAtCoords({left:t.clientX,top:t.clientY}),i=o.inside;return i>-1&&x.isSelectable(r.state.doc.nodeAt(i))?!1:(r.dispatch(r.state.tr.setSelection(new Me(n))),!0)}function Nu(r,e){if(e.inputType!="insertCompositionText"||!(r.state.selection instanceof Me))return!1;var t=r.state.selection,n=t.$from,o=n.parent.contentMatchAt(n.index()).findWrapping(r.state.schema.nodes.text);if(!o)return!1;for(var i=m.empty,s=o.length-1;s>=0;s--)i=m.from(o[s].createAndFill(null,i));var a=r.state.tr.replace(n.pos,n.pos,new k(i,0,0));return a.setSelection(I.near(a.doc.resolve(n.pos+1))),r.dispatch(a),!1}function Du(r){if(!(r.selection instanceof Me))return null;var e=document.createElement("div");return e.className="ProseMirror-gapcursor",E.create(r.doc,[_.widget(r.selection.head,e,{key:"gapcursor"})])}function Xr(r,e){return function(t,n){var o=t.selection,i=o.$from,s=o.$to,a=i.blockRange(s),l=!1,f=a;if(!a)return!1;if(a.depth>=2&&i.node(a.depth-1).type.compatibleContent(r)&&a.startIndex==0){if(i.index(a.depth-1)==0)return!1;var u=t.doc.resolve(a.start-2);f=new tt(u,u,a.depth),a.endIndex<a.parent.childCount&&(a=new tt(i,t.doc.resolve(s.end(a.depth)),a.depth)),l=!0}var c=gt(f,r,e,a);return c?(n&&n(Tu(t.tr,a,c,l,r).scrollIntoView()),!0):!1}}function Tu(r,e,t,n,o){for(var i=m.empty,s=t.length-1;s>=0;s--)i=m.from(t[s].type.create(t[s].attrs,i));r.step(new oe(e.start-(n?2:0),e.end,e.start,e.end,new k(i,0,0),t.length,!0));for(var a=0,l=0;l<t.length;l++)t[l].type==o&&(a=l+1);for(var f=t.length-a,u=e.start+t.length-(n?2:0),c=e.parent,p=e.startIndex,h=e.endIndex,d=!0;p<h;p++,d=!1)!d&&Je(r.doc,u,f)&&(r.split(u,f),u+=2*f),u+=c.child(p).nodeSize;return r}function sa(r){return function(e,t){var n=e.selection,o=n.$from,i=n.$to,s=n.node;if(s&&s.isBlock||o.depth<2||!o.sameParent(i))return!1;var a=o.node(-1);if(a.type!=r)return!1;if(o.parent.content.size==0&&o.node(-1).childCount==o.indexAfter(-1)){if(o.depth==2||o.node(-3).type!=r||o.index(-2)!=o.node(-2).childCount-1)return!1;if(t){for(var l=m.empty,f=o.index(-1)?1:o.index(-2)?2:3,u=o.depth-f;u>=o.depth-3;u--)l=m.from(o.node(u).copy(l));var c=o.indexAfter(-1)<o.node(-2).childCount?1:o.indexAfter(-2)<o.node(-3).childCount?2:3;l=l.append(m.from(r.createAndFill()));var p=o.before(o.depth-(f-1)),h=e.tr.replace(p,o.after(-c),new k(l,4-f,0)),d=-1;h.doc.nodesBetween(p,h.doc.content.size,function(y,O){if(d>-1)return!1;y.isTextblock&&y.content.size==0&&(d=O+1)}),d>-1&&h.setSelection(e.selection.constructor.near(h.doc.resolve(d))),t(h.scrollIntoView())}return!0}var v=i.pos==o.end()?a.contentMatchAt(0).defaultType:null,b=e.tr.delete(o.pos,i.pos),S=v&&[null,{type:v}];return Je(b.doc,o.pos,2,S)?(t&&t(b.split(o.pos,2,S).scrollIntoView()),!0):!1}}function aa(r){return function(e,t){var n=e.selection,o=n.$from,i=n.$to,s=o.blockRange(i,function(a){return a.childCount&&a.firstChild.type==r});return s?t?o.node(s.depth-1).type==r?Eu(e,t,r,s):Iu(e,t,s):!0:!1}}function Eu(r,e,t,n){var o=r.tr,i=n.end,s=n.$to.end(n.depth);return i<s&&(o.step(new oe(i-1,s,i,s,new k(m.from(t.create(null,n.parent.copy())),1,0),1,!0)),n=new tt(o.doc.resolve(n.$from.pos),o.doc.resolve(s),n.depth)),e(o.lift(n,rt(n)).scrollIntoView()),!0}function Iu(r,e,t){for(var n=r.tr,o=t.parent,i=t.end,s=t.endIndex-1,a=t.startIndex;s>a;s--)i-=o.child(s).nodeSize,n.delete(i-1,i+1);var l=n.doc.resolve(t.start),f=l.nodeAfter;if(n.mapping.map(t.end)!=t.start+l.nodeAfter.nodeSize)return!1;var u=t.startIndex==0,c=t.endIndex==o.childCount,p=l.node(-1),h=l.index(-1);if(!p.canReplace(h+(u?0:1),h+1,f.content.append(c?m.empty:m.from(o))))return!1;var d=l.pos,v=d+f.nodeSize;return n.step(new oe(d-(u?1:0),v+(c?1:0),d+1,v-1,new k((u?m.empty:m.from(o.copy(m.empty))).append(c?m.empty:m.from(o.copy(m.empty))),u?0:1,c?0:1),u?0:1)),e(n.scrollIntoView()),!0}function la(r){return function(e,t){var n=e.selection,o=n.$from,i=n.$to,s=o.blockRange(i,function(v){return v.childCount&&v.firstChild.type==r});if(!s)return!1;var a=s.startIndex;if(a==0)return!1;var l=s.parent,f=l.child(a-1);if(f.type!=r)return!1;if(t){var u=f.lastChild&&f.lastChild.type==l.type,c=m.from(u?r.create():null),p=new k(m.from(r.create(null,m.from(l.type.create(null,c)))),u?3:1,0),h=s.start,d=s.end;t(e.tr.step(new oe(h-(u?3:1),d,h,d,p,1,!0)).scrollIntoView())}return!0}}var Xe=function(e,t){this.match=e,this.handler=typeof t=="string"?Au(t):t};function Au(r){return function(e,t,n,o){var i=r;if(t[1]){var s=t[0].lastIndexOf(t[1]);i+=t[0].slice(s+t[1].length),n+=s;var a=n-o;a>0&&(i=t[0].slice(s-a,s)+i,n=o)}return e.tr.insertText(i,n,o)}}var Ru=500;function fa(r){var e=r.rules,t=new W({state:{init:function(){return null},apply:function(o,i){var s=o.getMeta(this);return s||(o.selectionSet||o.docChanged?null:i)}},props:{handleTextInput:function(o,i,s,a){return ua(o,i,s,a,e,t)},handleDOMEvents:{compositionend:function(n){setTimeout(function(){var o=n.state.selection,i=o.$cursor;i&&ua(n,i.pos,i.pos,"",e,t)})}}},isInputRules:!0});return t}function ua(r,e,t,n,o,i){if(r.composing)return!1;var s=r.state,a=s.doc.resolve(e);if(a.parent.type.spec.code)return!1;for(var l=a.parent.textBetween(Math.max(0,a.parentOffset-Ru),a.parentOffset,null,"\uFFFC")+n,f=0;f<o.length;f++){var u=o[f].match.exec(l),c=u&&o[f].handler(s,u,e-(u[0].length-n.length),t);if(!!c)return r.dispatch(c.setMeta(i,{transform:c,from:e,to:t,text:n})),!0}return!1}function ca(r,e){for(var t=r.plugins,n=0;n<t.length;n++){var o=t[n],i=void 0;if(o.spec.isInputRules&&(i=o.getState(r))){if(e){for(var s=r.tr,a=i.transform,l=a.steps.length-1;l>=0;l--)s.step(a.steps[l].invert(a.docs[l]));if(i.text){var f=s.doc.resolve(i.from).marks();s.replaceWith(i.from,i.to,r.schema.text(i.text,f))}else s.delete(i.from,i.to);e(s)}return!0}}return!1}var pa=new Xe(/--$/,"\u2014"),ha=new Xe(/\.\.\.$/,"\u2026"),Pu=new Xe(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(")$/,"\u201C"),zu=new Xe(/"$/,"\u201D"),Fu=new Xe(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(')$/,"\u2018"),Bu=new Xe(/'$/,"\u2019"),da=[Pu,zu,Fu,Bu];function Zr(r,e,t,n){return new Xe(r,function(o,i,s,a){var l=t instanceof Function?t(i):t,f=o.tr.delete(s,a),u=f.doc.resolve(s),c=u.blockRange(),p=c&&gt(c,e,l);if(!p)return null;f.wrap(c,p);var h=f.doc.resolve(s-1).nodeBefore;return h&&h.type==e&&nt(f.doc,s-1)&&(!n||n(i,h))&&f.join(s-1),f})}function go(r,e,t){return new Xe(r,function(n,o,i,s){var a=n.doc.resolve(i),l=t instanceof Function?t(o):t;return a.node(-1).canReplaceWith(a.index(-1),a.indexAfter(-1),e)?n.tr.delete(i,s).setBlockType(i,i,e,l):null})}var $r="ProseMirror-prompt";function ma(r){var e=document.body.appendChild(document.createElement("div"));e.className=$r;var t=function(h){e.contains(h.target)||n()};setTimeout(function(){return window.addEventListener("mousedown",t)},50);var n=function(){window.removeEventListener("mousedown",t),e.parentNode&&e.parentNode.removeChild(e)},o=[];for(var i in r.fields)o.push(r.fields[i].render());var s=document.createElement("button");s.type="submit",s.className=$r+"-submit",s.textContent="OK";var a=document.createElement("button");a.type="button",a.className=$r+"-cancel",a.textContent="Cancel",a.addEventListener("click",n);var l=e.appendChild(document.createElement("form"));r.title&&(l.appendChild(document.createElement("h5")).textContent=r.title),o.forEach(function(h){l.appendChild(document.createElement("div")).appendChild(h)});var f=l.appendChild(document.createElement("div"));f.className=$r+"-buttons",f.appendChild(s),f.appendChild(document.createTextNode(" ")),f.appendChild(a);var u=e.getBoundingClientRect();e.style.top=(window.innerHeight-u.height)/2+"px",e.style.left=(window.innerWidth-u.width)/2+"px";var c=function(){var h=_u(r.fields,o);h&&(n(),r.callback(h))};l.addEventListener("submit",function(h){h.preventDefault(),c()}),l.addEventListener("keydown",function(h){h.keyCode==27?(h.preventDefault(),n()):h.keyCode==13&&!(h.ctrlKey||h.metaKey||h.shiftKey)?(h.preventDefault(),c()):h.keyCode==9&&window.setTimeout(function(){e.contains(document.activeElement)||n()},500)});var p=l.elements[0];p&&p.focus()}function _u(r,e){var t=Object.create(null),n=0;for(var o in r){var i=r[o],s=e[n++],a=i.read(s),l=i.validate(a);if(l)return Vu(s,l),null;t[o]=i.clean(a)}return t}function Vu(r,e){var t=r.parentNode,n=t.appendChild(document.createElement("div"));n.style.left=r.offsetLeft+r.offsetWidth+2+"px",n.style.top=r.offsetTop-5+"px",n.className="ProseMirror-invalid",n.textContent=e,setTimeout(function(){return t.removeChild(n)},1500)}var ar=function(e){this.options=e};ar.prototype.read=function(e){return e.value};ar.prototype.validateType=function(e){};ar.prototype.validate=function(e){return!e&&this.options.required?"Required field":this.validateType(e)||this.options.validate&&this.options.validate(e)};ar.prototype.clean=function(e){return this.options.clean?this.options.clean(e):e};var lr=function(r){function e(){r.apply(this,arguments)}return r&&(e.__proto__=r),e.prototype=Object.create(r&&r.prototype),e.prototype.constructor=e,e.prototype.render=function(){var n=document.createElement("input");return n.type="text",n.placeholder=this.options.label,n.value=this.options.value||"",n.autocomplete="off",n},e}(ar);function va(r,e){for(var t=r.selection.$from,n=t.depth;n>=0;n--){var o=t.index(n);if(t.node(n).canReplaceWith(o,o,e))return!0}return!1}function qu(r){return new Z({title:"Insert image",label:"Image",enable:function(t){return va(t,r)},run:function(t,n,o){var i=t.selection,s=i.from,a=i.to,l=null;t.selection instanceof x&&t.selection.node.type==r&&(l=t.selection.node.attrs),ma({title:"Insert image",fields:{src:new lr({label:"Location",required:!0,value:l&&l.src}),title:new lr({label:"Title",value:l&&l.title}),alt:new lr({label:"Description",value:l?l.alt:t.doc.textBetween(s,a," ")})},callback:function(u){o.dispatch(o.state.tr.replaceSelectionWith(r.createAndFill(u))),o.focus()}})}})}function ga(r,e){var t={label:e.title,run:r};for(var n in e)t[n]=e[n];return(!e.enable||e.enable===!0)&&!e.select&&(t[e.enable?"enable":"select"]=function(o){return r(o)}),new Z(t)}function yo(r,e){var t=r.selection,n=t.from,o=t.$from,i=t.to,s=t.empty;return s?e.isInSet(r.storedMarks||o.marks()):r.doc.rangeHasMark(n,i,e)}function bo(r,e){var t={active:function(i){return yo(i,r)},enable:!0};for(var n in e)t[n]=e[n];return ga(De(r),t)}function Lu(r){return new Z({title:"Add or remove link",icon:ue.link,active:function(t){return yo(t,r)},enable:function(t){return!t.selection.empty},run:function(t,n,o){if(yo(t,r))return De(r)(t,n),!0;ma({title:"Create a link",fields:{href:new lr({label:"Link target",required:!0}),title:new lr({label:"Title"})},callback:function(s){De(r,s)(o.state,o.dispatch),o.focus()}})}})}function ya(r,e){return ga(Xr(r,e.attrs),e)}function ba(r){var e={},t;if((t=r.marks.strong)&&(e.toggleStrong=bo(t,{title:"Toggle strong style",icon:ue.strong})),(t=r.marks.em)&&(e.toggleEm=bo(t,{title:"Toggle emphasis",icon:ue.em})),(t=r.marks.code)&&(e.toggleCode=bo(t,{title:"Toggle code font",icon:ue.code})),(t=r.marks.link)&&(e.toggleLink=Lu(t)),(t=r.nodes.image)&&(e.insertImage=qu(t)),(t=r.nodes.bullet_list)&&(e.wrapBulletList=ya(t,{title:"Wrap in bullet list",icon:ue.bulletList})),(t=r.nodes.ordered_list)&&(e.wrapOrderedList=ya(t,{title:"Wrap in ordered list",icon:ue.orderedList})),(t=r.nodes.blockquote)&&(e.wrapBlockQuote=Js(t,{title:"Wrap in block quote",icon:ue.blockquote})),(t=r.nodes.paragraph)&&(e.makeParagraph=ct(t,{title:"Change to paragraph",label:"Plain"})),(t=r.nodes.code_block)&&(e.makeCodeBlock=ct(t,{title:"Change to code block",label:"Code"})),t=r.nodes.heading)for(var n=1;n<=10;n++)e["makeHead"+n]=ct(t,{title:"Change to heading "+n,label:"Level "+n,attrs:{level:n}});if(t=r.nodes.horizontal_rule){var o=t;e.insertHorizontalRule=new Z({title:"Insert horizontal rule",label:"Horizontal rule",enable:function(a){return va(a,o)},run:function(a,l){l(a.tr.replaceSelectionWith(o.create()))}})}var i=function(s){return s.filter(function(a){return a})};return e.insertMenu=new Ye(i([e.insertImage,e.insertHorizontalRule]),{label:"Insert"}),e.typeMenu=new Ye(i([e.makeParagraph,e.makeCodeBlock,e.makeHead1&&new ao(i([e.makeHead1,e.makeHead2,e.makeHead3,e.makeHead4,e.makeHead5,e.makeHead6]),{label:"Heading"})]),{label:"Type..."}),e.inlineMenu=[i([e.toggleStrong,e.toggleEm,e.toggleCode,e.toggleLink])],e.blockMenu=[i([e.wrapBulletList,e.wrapOrderedList,e.wrapBlockQuote,Bs,_s,Vs])],e.fullMenu=e.inlineMenu.concat([[e.insertMenu,e.typeMenu]],[[qs,Ls]],e.blockMenu),e}var ka=typeof navigator!="undefined"?/Mac/.test(navigator.platform):!1;function Sa(r,e){var t={},n;function o(f,u){if(e){var c=e[f];if(c===!1)return;c&&(f=c)}t[f]=u}if(o("Mod-z",Dt),o("Shift-Mod-z",ut),o("Backspace",ca),ka||o("Mod-y",ut),o("Alt-ArrowUp",Xt),o("Alt-ArrowDown",Ms),o("Mod-BracketLeft",Zt),o("Escape",er),(n=r.marks.strong)&&(o("Mod-b",De(n)),o("Mod-B",De(n))),(n=r.marks.em)&&(o("Mod-i",De(n)),o("Mod-I",De(n))),(n=r.marks.code)&&o("Mod-`",De(n)),(n=r.nodes.bullet_list)&&o("Shift-Ctrl-8",Xr(n)),(n=r.nodes.ordered_list)&&o("Shift-Ctrl-9",Xr(n)),(n=r.nodes.blockquote)&&o("Ctrl->",tr(n)),n=r.nodes.hard_break){var i=n,s=ft($t,function(f,u){return u(f.tr.replaceSelectionWith(i.create()).scrollIntoView()),!0});o("Mod-Enter",s),o("Shift-Enter",s),ka&&o("Ctrl-Enter",s)}if((n=r.nodes.list_item)&&(o("Enter",sa(n)),o("Mod-[",aa(n)),o("Mod-]",la(n))),(n=r.nodes.paragraph)&&o("Shift-Ctrl-0",Nt(n)),(n=r.nodes.code_block)&&o("Shift-Ctrl-\\",Nt(n)),n=r.nodes.heading)for(var a=1;a<=6;a++)o("Shift-Ctrl-"+a,Nt(n,{level:a}));if(n=r.nodes.horizontal_rule){var l=n;o("Mod-_",function(f,u){return u(f.tr.replaceSelectionWith(l.create()).scrollIntoView()),!0})}return t}function Ju(r){return Zr(/^\s*>\s$/,r)}function Wu(r){return Zr(/^(\d+)\.\s$/,r,function(e){return{order:+e[1]}},function(e,t){return t.childCount+t.attrs.order==+e[1]})}function Hu(r){return Zr(/^\s*([-+*])\s$/,r)}function Ku(r){return go(/^```$/,r)}function Uu(r,e){return go(new RegExp("^(#{1,"+e+"})\\s$"),r,function(t){return{level:t[1].length}})}function Ma(r){var e=da.concat(ha,pa),t;return(t=r.nodes.blockquote)&&e.push(Ju(t)),(t=r.nodes.ordered_list)&&e.push(Wu(t)),(t=r.nodes.bullet_list)&&e.push(Hu(t)),(t=r.nodes.code_block)&&e.push(Ku(t)),(t=r.nodes.heading)&&e.push(Uu(t,6)),fa({rules:e})}function en(r){var e=[Ma(r.schema),At(Sa(r.schema,r.mapKeys)),At(rr),oa(),ia()];return r.menuBar!==!1&&e.push(Ws({floating:r.floatingMenu!==!1,content:r.menuContent||ba(r.schema).fullMenu})),r.history!==!1&&e.push(As()),e.concat(new W({props:{attributes:{class:"ProseMirror-example-setup-style"}}}))}var ko={};ko.MountProseMirror={mounted(){rn.init(this.el,{schemaFunc:pt,pluginFunc:en})},updated(){rn.init(this.el,{schemaFunc:pt,pluginFunc:en})}};function Gu(r,e){let t=r.schema.nodes.hard_break;e(r.tr.replaceSelectionWith(t.create()).scrollIntoView())}var Ca={"Shift-Enter":ft($t,Gu)};var ju=document.querySelectorAll(".ex-prosemirror"),xa=class{setBlocks(e){return this.blocks=e,this}setMarks(e){return this.marks=e,this}setPlugins(e){return this.plugins=e,this}initAll(){Array.from(ju).forEach(e=>{this.init(e)})}init(e){if(e instanceof HTMLElement){e.innerHTML="";let t=this.plugins||[];return new It(e,{blocks:this.blocks,marks:this.marks,plugins:t})}return null}},rn=new xa;return Qu;})();
